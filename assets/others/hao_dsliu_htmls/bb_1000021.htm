<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：Decrypting SSL/TLS sessions with Wireshark - Reloaded</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>Decrypting SSL/TLS sessions with Wireshark - Reloaded</h2>
<p align="right">发布时间：2015-12-30 18:07
<br>分类名称：SSL</p><br>
<p style="background: white;"   ><span style="color:navy; font-size:13pt;"   >From: http://blogs.technet.com/b/nettracer/archive/2013/10/12/decrypting-ssl-tls-sessions-with-wireshark-reloaded.aspx
</span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >Hi there,</span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >In a previous blog post of mine, I went through the steps of decrypting SSL/TLS traffic by using wireshark and openssl tools. In this blog post, I wanted to talk about the same procedure again because it got even easier to decrypt encrypted traffic with Wireshark since then.&nbsp;</span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >Here are the steps to export a certificate with private key included and using that certificate to decrypt SSL/TLS session in Wireshark:</span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt; background-color:yellow;"   ><strong>=&gt; Exporting the certificate with its private key:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>The certificate could be exported by using certificates mmc on Windows:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/0451.pic1.jpg"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img0.ph.126.net_X867biCAEbtYl0EwpwRLYQ==_6630092498887036818.jpg"   alt=""   border="0"   /></a></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/6177.pic2.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img0.ph.126.net_k9O52x_yZVJxMZtGbOMHTg==_6630384968980027152.jpg"   alt=""   border="0"   /></a>
</span></p><p style="background: white;"   ><a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/4024.pic40.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img2.ph.126.net_LWwXsWNV5S32_ffazhh4Sw==_6630457536747462272.jpg"   alt=""   border="0"   /></a><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></p><p style="background: white;"   ><a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/2055.pic41.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img2.ph.126.net_2NOg1IilDb9RPWcG5Cof2Q==_6630610368864529010.jpg"   alt=""   border="0"   /></a><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></p><p style="background: white;"   ><a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/5661.pic42.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img1.ph.126.net_xrZGL--nDMhNOOPvD2-XSA==_6630479526980011843.jpg"   alt=""   border="0"   /></a><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></p><p style="background: white;"   ><span style="color:#2a2a2a;"   ><span style="font-family:Segoe UI; font-size:9pt;"   >&nbsp;</span><span style="color:navy;"   ><span style="font-size:13pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/2134.pic6.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img2.ph.126.net_VG7tE5JoD8pELS2-BK5zeQ==_6630820375585425335.jpg"   alt=""   border="0"   /></a></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/5040.pic7.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img2.ph.126.net_E2n-egVz9MlTWoTLcIJkpw==_6630058414026574520.jpg"   alt=""   border="0"   /></a></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/7823.pic8.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img2.ph.126.net_wX-3tfZkrDWrig0JMM9OAA==_6631418509911133316.jpg"   alt=""   border="0"   /></a>
</span></p><p style="background: white;"   >&nbsp;&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>The exported certificate (with private key included) is c:\servercert.pfx</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt; background-color:yellow;"   ><strong>=&gt; Capturing a network trace where an SSL/TLS session is established:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>&nbsp;- To start capturing network traffic:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/1588.pic9.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img0.ph.126.net_rC5SoCmCl8icQpOMfGSBDg==_6630874251655194423.jpg"   alt=""   border="0"   /></a></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>- Reproduce the issue</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>- To stop capturing network traffic:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/8156.pi10.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img2.ph.126.net_pbQEcobBQvzlhF0Kl12A1w==_6630121086189357815.jpg"   alt=""   border="0"   /></a></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt; background-color:yellow;"   ><strong>=&gt; Decrypting the SSL/TLS session by using Wireshark and the given certificate with private key:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/5125.pic11.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img2.ph.126.net_4dRFizE3iAiYmOEEbqkqeg==_6630722519050355078.jpg"   alt=""   border="0"   /></a></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/5315.pic12.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img1.ph.126.net_c3jL3b3_WbKPLUqJoXr2Eg==_6631417410399505558.jpg"   alt=""   border="0"   /></a>
</span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/1667.pic13.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img2.ph.126.net_iUfKp3lt58aPXNnbvHUKXw==_6631417410399505559.jpg"   alt=""   border="0"   /></a></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>&nbsp;- In the below example</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>Server IP is 10.2.2.2 and TCP port is 443.</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>Note: The password shown below is the one that you assigned while exporting the server certificate:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/3463.pic14.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img2.ph.126.net_68HoAGe24LgqqTEOxHeIhw==_6631282170469281080.jpg"   alt=""   border="0"   /></a></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/4478.pic15.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img1.ph.126.net_2zoC3FCqoisNXbxRrltFyQ==_6630402561166071550.jpg"   alt=""   border="0"   /></a>
</span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/2465.pic16.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img0.ph.126.net_atayKvnuy-PeJSUzgIISbw==_6631218398794872945.jpg"   alt=""   border="0"   /></a></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>Once the certificate is applied to Wireshark, then an appropriate Wireshark filter (the filter is "http" in this example) could be applied to see the traffic in clear text:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/5584.pic17.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img0.ph.126.net_QAOaawC3rmG0oQrJEenlcA==_6630411357259091061.jpg"   alt=""   border="0"   /></a><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>The problem with decrypted SSL/TLS sessions is that you cannot save the network trace in an unencrypted format (best to my knowledge that's also something Wireshark dev's to do list) for later analysis or for sharing with someone external to your company, so if you want to save the output in clear text, you might want to print the packets to a text file. But it would also be good to expand all relevant protocol headers before doing so so that the text file will include all application layer protocol header lines expanded. You can see an example below for HTTP protocol:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>We expand "Hypertext Transfer Protocol" and "Line-based text data: text/html" lines:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/1563.pic18.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img1.ph.126.net_3YwBNZVw-Dp62n6Izmo5sg==_6630411357259091065.jpg"   alt=""   border="0"   /></a><span style="color:navy;"   ><span style="font-size:13pt;"   >&nbsp;</span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/1106.pic19.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img2.ph.126.net_uqNilEQf80Wdd_do3_saXQ==_6630725817585238376.jpg"   alt=""   border="0"   /></a>
</span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>Now we can print the packets to a text file as given below:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/4617.pic20.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img1.ph.126.net_SvMtMB2ornLDUhIuNRK_6g==_6630124384724241142.jpg"   alt=""   border="0"   /></a></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>with the following options set:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><span style="color:#2a2a2a;"   ><span style="font-family:Segoe UI; font-size:9pt;"   >&nbsp;</span><span style="color:navy;"   ><span style="font-size:13pt;"   >&nbsp;<a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/4722.pic21.png"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img2.ph.126.net_c8h_scUaj4vsH6IIo5hMeg==_6630146374956799367.jpg"   alt=""   border="0"   /></a></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   ><strong>Now the output will be written to a text file where the HTTP request/response header+payloads will be&nbsp;visible in clear test:</strong></span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p><p style="background: white;"   ><a rel="nofollow" href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-60/2766.pic22.jpg"   ><img title="Decrypting SSL/TLS sessions with Wireshark - Reloaded - Howie - Dspace"   src="pic/img0.ph.126.net_sAp2NRj7b0uTI-hlGxbeyA==_6630788489748219630.jpg"   alt=""   border="0"   /></a><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></p><p style="background: white;"   >&nbsp;
&nbsp;</p><p style="background: white;"   ><span style="color:navy;"   ><span style="font-size:13pt;"   >Hope this helps</span><span style="color:#2a2a2a; font-family:Segoe UI; font-size:9pt;"   >
</span></span></p>
</body></html>