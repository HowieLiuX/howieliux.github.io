<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：[转] 致菜鸟: OD里SHIFT+F4条件断点用法篇</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>[转] 致菜鸟: OD里SHIFT+F4条件断点用法篇</h2>
<p align="right">发布时间：2010-6-18 01:08
<br>分类名称：Debug_Crack</p><br>
<span style="font-family: 宋体, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 12px; line-height: 19px; color: rgb(19, 37, 60);"  ><font color="#333333"  >标 题:</font><font color="#000000"  >&nbsp;【分享】致菜鸟: OD里SHIFT+F4条件断点用法篇</font><font color="#666666"  ><br><font color="#333333"  >作 者:</font>&nbsp;<font color="#000000"  >pjb</font><br><font color="#333333"  >时 间:</font>&nbsp;2005-08-24,20:25:51<br><font color="#333333"  >链 接:</font>&nbsp;http://bbs.pediy.com/showthread.php?t=16494<br></font><br>高手就不必看了~,若有错误的地方请指正!<br><br><br>先说一点&nbsp;&nbsp;ALT+L&nbsp;看记录~<br><br>在某条语句上按了SHIFT+F4后出现了个对话框,<br><br><img src="http://bbs.pediy.com/upload/2005/4/image/1.gif_605.gif"  border="0"  alt="http://bbs.pediy.com/upload/2005/4/image/1.gif_605.gif"  thiswidth="screen.width*0.6;this.alt=''"  title="http://bbs.pediy.com/upload/2005/4/image/1.gif_605.gif"  >&nbsp;<br>1)第一行是"条件":&nbsp;要输入的肯定是你感兴趣的条件啦,比如说下面的俩句<br><br>&nbsp;0041150&nbsp;push&nbsp;eax<br>&nbsp;0041151&nbsp;call&nbsp;[TranslateMessage]<br><br>&nbsp;你在0041150处下条件记录中断,假如这时候你要是想知道ESI等不等于0,那就可以设置条件&nbsp;ESI==0&nbsp;或ESI!=0&nbsp;反正是关于ESI的条件了而不是只能利用这行的EAX.&nbsp;当然一样可以在0041150处下断追消息,比如说你想知道按了&nbsp;老鼠标移动消息,那么就设置&nbsp;MSG==WM_MOUSEMOVE&nbsp;或是&nbsp;MSG==0200(移动的数字代码).&nbsp;有人该问了,消息记录好象应该在下一行有函数的下断才正确吧?其实不一定非要在传递消息的那行0041151下断的,但在那行下断的好处是可以记录到函数参数,这在下面会讲到~&nbsp;&nbsp;&nbsp;<br>&nbsp;"条件"这的书写是按照&nbsp;MASM32汇编的形式书写的,比如&nbsp;==&nbsp;!=&nbsp;&nbsp;&gt;&nbsp;&lt;&nbsp;<br><br>2)"说明"="表达"<br>&nbsp;&nbsp;"解码表达式的值"<br><br>&nbsp;"说明"就是个注释啦,添不添无所谓了,除非你下的记录中断比较多,这样在记录里能看的明白~&nbsp;&nbsp;<br>"表达"其实就是我们记录的核心啦,程序在我们第1小条里的"条件"为真的时候,就会记录我们在"表达"里填的内容,比如说ESI==0的时候,我们记录&nbsp;[eax+4]的值<br>反正是你感兴趣的内容啦,若是想记录消息就添&nbsp;MSG&nbsp;啦,很多时候我们只添了"条件"而没有添"表达",程序中断后就会显示"未知的函数或标识符!",这就是原因了.<br>至于下面的"解码表达式的值"你可以随便选了,他不过是把记录后的数据又分析了一下,&nbsp;比如说我们记录了[eax+4]的值是&nbsp;201&nbsp;&nbsp;,那么当你选"信息代码(WM_XXX)"的时候那么你在记录(ALT+L看记录)里看到的就是被分析成了&nbsp;201&nbsp;WM_LBUTTONDOWN<br>当你选"布尔数值",那么记录里数值201后面就会跟个&nbsp;TRUE了,其实就是OD对这个数据按照我们选择的类型又进行了一次分析而已~~<br><br>3)暂停程序&nbsp;=&gt;&nbsp;&nbsp;永不&nbsp;&nbsp;&nbsp;&nbsp;条件满足时&nbsp;&nbsp;永远&nbsp;&nbsp;<br>&nbsp;&nbsp;这三个选择就是条件为真记录表达的时候程序暂不暂停程序,那就看你调试的需要了~<br><br>4)记录表达式的值&nbsp;=&gt;&nbsp;&nbsp;永不&nbsp;&nbsp;&nbsp;&nbsp;条件满足时&nbsp;&nbsp;永远<br>&nbsp;呵呵,要是选"永不",那么我们设立记录"表达"还有啥意义啊,&nbsp;若是选"永远",那么条件似乎不就没意义了,因为记录的时候已经不管条件了,只要运行到这就记录表达.不过好象也可以利用的,自己去想想啦..我不说.<br>&nbsp;一般都是选"条件满足"啦.<br><br>5)记录函数参数&nbsp;=&gt;&nbsp;&nbsp;永不&nbsp;&nbsp;&nbsp;&nbsp;条件满足时&nbsp;&nbsp;永远<br>这个要是你下在没函数的那行,那么这行就变灰了~~&nbsp;&nbsp;&nbsp;&nbsp;记录函数的参数很有意义啊,直接可以看到很多信息,我们比如说在有函数的那行下条件记录."条件"是&nbsp;EAX==0&nbsp;&nbsp;"表达"是&nbsp;[EAX+4],然后在这选择记录函数参数在"条件满足时";当然你若只想记录运行到此处的函数参数,那么就空着"条件"和"表达"吧,同时3)和4)的选择也要变为"永不"了...也许你在记录了啥也看不到,因为运行到这行可能EAX总不=0&nbsp;,那么好换换&nbsp;EAX&gt;0&nbsp;,好象看了到一堆,然后还有PMSG=XXXX&nbsp;&nbsp;Hw=XXXX,这就是运行到这里这个函数的参数啦~~&nbsp;&nbsp;我们也可以记录&nbsp;CREATFILEA&nbsp;函数,那么就知道都打开什么文件了~~<br><br>6)&nbsp;"运行次数":0为无限次<br><br>7)&nbsp;"如果程序暂停,发动如下参数到插件中..."<br>&nbsp;&nbsp;我不会,我就会上面那些,希望高手给补充一下,好让我们这些菜鸟学学~~<br><br>注意一点:&nbsp;我们在OD菜单"查看"=&gt;"窗口"里也可以用老鼠标右键给窗口过程下消息断点,下完后你可以用SHIFF_F4打开那个消息断点,发现它其实就是条件记录断点的一种形式而已~~~<br><br>举个例子吧:<br>比如说一个程序要求注册,点后出现一个注册窗口那么我们就要对点注册按钮下断,看看它之后执行了什么~~<br><br>注册窗口如果是对话框,那么肯定要用函数&nbsp;CreatDialoParam或DialogBoxParam&nbsp;若你对这俩函数都不了解的话,那就去看看书吧...首先用OD里的插件"窗口工具"获得注册按钮的标识(即ID),比如说是0422,记录下来备用啦~,<br><img src="http://bbs.pediy.com/upload/2005/4/image/3.gif_010.gif"  border="0"  alt="http://bbs.pediy.com/upload/2005/4/image/3.gif_010.gif"  thiswidth="screen.width*0.6;this.alt=''"  title="http://bbs.pediy.com/upload/2005/4/image/3.gif_010.gif"  >&nbsp;<br>在OD里对这俩函数下断,然后执行程序,让注册窗口显示就会中断,OD里看堆栈,此函数的第4个参数pDlgProc就是对话框的过程入口了,这里是0041b0b0是入口<br>&nbsp;<img src="http://bbs.pediy.com/upload/2005/4/image/2.gif_299.gif"  border="0"  alt="http://bbs.pediy.com/upload/2005/4/image/2.gif_299.gif"  thiswidth="screen.width*0.6;this.alt=''"  title="http://bbs.pediy.com/upload/2005/4/image/2.gif_299.gif"  >&nbsp;<br>去对话框入口处,SHIFT+F4,在"条件"里输入&nbsp;[ESP+8]==0111&nbsp;&amp;&amp;&nbsp;[ESP+C]==0422&nbsp;<br>"表达"可以空着,暂停程序在"条件满足时"<br>又该问了,为什么这么写?&nbsp;请记住:&nbsp;由于是过程调用,肯定要先向堆栈里压数据的,也就是标准说法:传递参数!&nbsp;对于对话况过程或窗口过程,执行到入口处的时候堆栈内肯定压入的是MSG消息结构的数据,那么&nbsp;[ESP+8]正好是WM_xxx消息,由于点了按钮我们肯定要抓的是WM_COMMAND消息&nbsp;也就是111啦,这个不明白去看书~&nbsp;[ESP+C]是Wparam参数,就是窗口的ID号了,这个条件就是当你按下了ID为422的注册按钮的时候中断,接下来你就可以单步看了~~&nbsp;&nbsp;&nbsp;&nbsp;当然,你用窗口工具的时候也能看到按钮的子窗口句柄,这时候&nbsp;{ESP+10]就是它的数值了,也一样可以代替&nbsp;{ESP+C]==0422的条件了.其实都一样的,<br>友人该说了,不会用工具怎么办啊,那就直接在过程入口下SHIFT+F4啦,条件和表达都空着,只选记录函数参数,那么就能得到一堆记录了,找到显示有&nbsp;WM_COMMAND的消息,把他的内容里的ID做为[ESP+C]==的数值,一个个试啦<p style="font: normal normal normal 12px/normal 宋体, 'courier new', simsun, tahoma, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif;"  ><ins style="display: inline-table; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; height: 90px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; position: relative; visibility: visible; width: 728px;"  ></ins></p></span>
</body></html>