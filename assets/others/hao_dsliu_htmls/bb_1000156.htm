<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：六.控制转移</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>六.控制转移</h2>
<p align="right">发布时间：2012-5-20 16:55
<br>分类名称：80x86保护模式</p><br>
<p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >控制转移基本上可分为两大类：同一任务内的控制转移和任务间的控制转移</span><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >任务</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >切换</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >。同一任务内的控制转移又可分为：段内转移、特权级不变的段间转移和特</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >权级变换的段间转移。段内转移与实模式下相似，不涉及特权级变换和任务切换。</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >只有段间转移才涉及特权级变换和任务切换。本文介绍保护方式下的控制转移，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >重点是任务内的特权级变换和任务间的切换。<a rel="nofollow" href="file:///E:\Books\Crack\Kindle\80x86&#20445;&#25252;&#27169;&#24335;&#31995;&#21015;&#25945;&#31243;\My%20Webs\DOWNLOAD\asm345.exe"  ><span style="color:blue;"  >这里下载本文所有源代码</span></a>。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:18pt;"  ><strong>&lt;一&gt;任务内无特权级变换的转移 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >各种段内转移与实模式下相似，当然不涉及特权级变换和任务切换。只有各种形式</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的段间转移才涉及特权级变换和任务切换。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>1.段间转移指令 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >与实模式下相同，指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >、</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >都具有段间转移的功能，指令</span><span style="font-family:Times New Roman;"  >INT</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >IRET</span><span style="font-family:宋体;"  >总是</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >段间转移。此外，中断</span><span style="font-family:Times New Roman;"  >/</span><span style="font-family:宋体;"  >异常也将引起段间转移。有时把这些具有段间转移功能的指</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >令统称为段间转移指令。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在保护模式下，段间转移的目标位置由选择子和偏移构成的地址表示，常把它称为</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >目标地址指针。在</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位代码段中，上述指针内的偏移使用</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位表示，这样的指针也</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >称为</span><span style="font-family:Times New Roman;"  >48</span><span style="font-family:宋体;"  >位全指针。在实例二的</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位代码段内就使用了</span><span style="font-family:Times New Roman;"  >48</span><span style="font-family:宋体;"  >位全指针。在</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位代码段中</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >，上述指针内的偏移只使用</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位表示。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >与实模式下相似，段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >和段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >还可分为段间直接转移和段</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >间间接转移两类。如果指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >在指令中直接含有目标地址指针，那么就是段</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >间直接转移；如果指令中含有指向包含目标地址指针的门描述符或</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符的指针</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >，那么就是段间间接转移，这种指针只有选择子部分有效，指示调用门、任务门或</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符，而偏移部分不起作用。实际上，当段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >和段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >所</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >含指针的选择子部分指示代码段描述符，那么就是段间直接转移，偏移部分表示目</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >标代码段的入口点；当选择子部分指示门描述符或</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符时，就是段间间接转移。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>2.向目标代码段转移的步骤 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >处理器在执行上述段间转移指令向目标代码段实施转移的过程中，一般至少要经过如</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >下步骤：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(1)</span><span style="font-family:宋体;"  >判断目标地址指针内的选择子指示的描述符是否为空描述符。空描述符是</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >中的</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >第</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >个描述符，是一个特殊的描述符。目标代码段描述符不能为空描述符，也即选择</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >子的高</span><span style="font-family:Times New Roman;"  >14</span><span style="font-family:宋体;"  >位不能为</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(2)</span><span style="font-family:宋体;"  >从全局或局部描述符表内读出目标代码段描述符。由选择子内的</span><span style="font-family:Times New Roman;"  >TI</span><span style="font-family:宋体;"  >位，确定使用</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >全局描述符表还是局部描述符表。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(3)</span><span style="font-family:宋体;"  >根据情况，检测描述符类型是否正确；调整</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(4)</span><span style="font-family:宋体;"  >把目标代码段描述符内的有关内容装载到</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >高速缓冲寄存器。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(5)</span><span style="font-family:宋体;"  >判断目标地址指针内的偏移是否越出代码段的界限。目标地址指针内的偏移必须</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >不超过目标代码段界限。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(6)</span><span style="font-family:宋体;"  >装载</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >段寄存器和指令指针寄存器</span><span style="font-family:Times New Roman;"  >EIP</span><span style="font-family:宋体;"  >；</span><span style="font-family:Times New Roman;"  >CPL</span><span style="font-family:宋体;"  >存入</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >内选择子的</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >字段。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >上述步骤只是对转移过程的简单说明，实际的动作还要复杂。在把目标代码段描述符</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >内的有关内容转载到</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >高速缓冲寄存器时，还要进行如下保护检测，其中的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >表示</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >目标代码段描述符的特权级：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(1)</span><span style="font-family:宋体;"  >对于非一致代码段，要求</span><span style="font-family:Times New Roman;"  >CPL=DPL</span><span style="font-family:宋体;"  >，</span><span style="font-family:Times New Roman;"  >RPL&lt;=DPL</span><span style="font-family:宋体;"  >；对于一致代码段，要求</span><span style="font-family:Times New Roman;"  >CPL&gt;=DPL</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(2)</span><span style="font-family:宋体;"  >代码段必须存在，即描述符中的</span><span style="font-family:Times New Roman;"  >P</span><span style="font-family:宋体;"  >位必须是</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >通常描述符特权级</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >规定了对应段的特权级。如果描述符描述的是数据段，那么</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >就</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >规定了访问该数据段的最外层特权级；如果描述符描述的是代码段，那么</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >就规定了</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >执行该代码段所需要的</span><span style="font-family:Times New Roman;"  >CPL</span><span style="font-family:宋体;"  >。但从上述装载</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >高速缓冲寄存器时进行的保护检测可见，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >对于一致代码段，却要求</span><span style="font-family:Times New Roman;"  >CPL&gt;=DPL,</span><span style="font-family:宋体;"  >也就是说，一致代码段描述符中的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >规定了可以转</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >移到一致代码段的最内层特权级。于是，</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级的程序可以转移到任何一致的代码段，而</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的程序只允许转移到</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >等于</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >的一致代码段。一致代码段描述符内</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >的这种解释，正好</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >与正常的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >的解释相反。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >一致的可执行段是一种特别的段。这种存储段，为在多个特权级执行的程序，提供对子例</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >程的共享支持，而不要求改变特权级。例如，通过把数值库例程放在一致的代码段中，可</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >以使不同级执行的程序共享数值库例程。这样，任何特权级的程序可以使用段间调用指令</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >，调用库中的例程，并在调用者所具有的特权级执行该例程。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>3.任务内无特权级变换的转移 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >所谓任务内无特权级变换的转移指：在转移到新的代码段时，当前特权级</span><span style="font-family:Times New Roman;"  >CPL</span><span style="font-family:宋体;"  >保持不变。</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >利用段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >、段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >和段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >可实现任务内无特权级变换</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的转移。利用</span><span style="font-family:Times New Roman;"  >INT</span><span style="font-family:宋体;"  >指令和</span><span style="font-family:Times New Roman;"  >IRET</span><span style="font-family:宋体;"  >指令也可实现任务内无特权级变换的转移。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(1)利用段间直接转移指令JMP或CALL </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在执行段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >时，如果指令内所含指针指示一个代码段，那么就直接开始上述</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >向目标代码段转移的步骤；在执行段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >时，如果指令内所含指针指针指示一</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >个代码段，那么就把返回地址指针压栈，然后就直接开始上述向目标代码段转移的步骤。</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >顺利通过这几步</span><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >不调整</span><span style="font-family:Times New Roman;"  >RPL)</span><span style="font-family:宋体;"  >后，就完成了任务内无特权级变换的转移。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >由此可见，利用段间直接转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >或调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >可方便地进行任务内无特权级变换</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的转移，但不能进行任务内特权级变换的转移。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(2)利用段间返回指令RET </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在执行段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >时，如果从堆栈中弹出的目标地址指针指示一个代码段，并且选</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >择子符合</span><span style="font-family:Times New Roman;"  >RPL=CPL</span><span style="font-family:宋体;"  >的条件，那么就开始上述向目标代码段的转移步骤。顺利通过这几步后</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >，就完成了任务内无特权级变换的转移。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >通常情况下，段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >与段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >对应。在利用段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >以任</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >务内无特权级变换的方式转移到某个子程序后，在子程序内利用段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >以任务</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >内无特权级变换的方式返回主程序。由于调用时无特权级变换，所以返回时也无特权级变</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >换，如果真是如此，那么必须能够满足条件</span><span style="font-family:Times New Roman;"  >RPL=CPL</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(3)利用调用门和其它途径 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >如何利用调用门实行和其它方法实现任务内无特权级变换的转移将在后面的文章中介绍。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>4.装载数据段和堆栈段寄存器时的特权检测 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >上面简单地说明了把选择子装入代码段寄存器</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >时为实现保护而进行的检测，下面也简单</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >地说明在把选择子装入数据段寄存器和堆栈段寄存器时要进行的检测。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在把选择子装入数据段寄存器</span><span style="font-family:Times New Roman;"  >DS</span><span style="font-family:宋体;"  >、</span><span style="font-family:Times New Roman;"  >ES</span><span style="font-family:宋体;"  >、</span><span style="font-family:Times New Roman;"  >FS</span><span style="font-family:宋体;"  >或</span><span style="font-family:Times New Roman;"  >GS</span><span style="font-family:宋体;"  >时，要进行如下检测：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(1)</span><span style="font-family:宋体;"  >选择子不能为空；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(2)</span><span style="font-family:宋体;"  >选择子指定的描述符必须是数据段描述符、可读可执行的代码段或一致可读的可执行</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >代码段的描述符；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(3)</span><span style="font-family:宋体;"  >对于数据段和可读可执行代码段，要求</span><span style="font-family:Times New Roman;"  >CPL&lt;=DPL</span><span style="font-family:宋体;"  >，</span><span style="font-family:Times New Roman;"  >RPL&lt;=DPL</span><span style="font-family:宋体;"  >；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(4)</span><span style="font-family:宋体;"  >对应的段必须存在。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >若装入的选择子不满足上述要求，则会产生异常。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在把选择子装入堆栈段寄存器</span><span style="font-family:Times New Roman;"  >SS</span><span style="font-family:宋体;"  >时要进行如下检测：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(1)</span><span style="font-family:宋体;"  >选择子不能为空；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(2)</span><span style="font-family:宋体;"  >选择子指定的描述符必须是可读写的数据段描述符；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(3)</span><span style="font-family:宋体;"  >要求</span><span style="font-family:Times New Roman;"  >CPL=DPL=RPL</span><span style="font-family:宋体;"  >；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(4)</span><span style="font-family:宋体;"  >对应段必须存在。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >若装入的选择子不满足上述条件，则在装入</span><span style="font-family:Times New Roman;"  >SS</span><span style="font-family:宋体;"  >时就会引起异常。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:18pt;"  ><strong>&lt;二&gt;演示任务内无特权级变换转移的实例(实例三) </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在实例二中，</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位代码段到</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位代码段的转移就是任务内无特权级转移的例子。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >下面再给出一个用于演示任务内无特权级变换转移的实例。该实例使用了段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >、</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >和段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >实现同一任务内相同特权级的转移。该实例还建立并使</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >用了局部描述符表</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>1.实现步骤和源程序 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >实现步骤如下：</span><span style="font-family:Times New Roman;"  >(1)</span><span style="font-family:宋体;"  >实模式下的初始化，包括对</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >和演示任务</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >的初始化，装载</span><span style="font-family:Times New Roman;"  >GDTR</span><span style="font-family:宋体;"  >；</span><span style="font-family:Times New Roman;"  >(2)</span><span style="font-family:宋体;"  >从</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >实模式切换到保护模式，处于</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >特权级；</span><span style="font-family:Times New Roman;"  >(3)</span><span style="font-family:宋体;"  >装载</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >，并设置堆栈；</span><span style="font-family:Times New Roman;"  >(4)</span><span style="font-family:宋体;"  >利用段间转移指</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >实现从代码段</span><span style="font-family:Times New Roman;"  >K</span><span style="font-family:宋体;"  >到同级代码段</span><span style="font-family:Times New Roman;"  >L</span><span style="font-family:宋体;"  >的转移；</span><span style="font-family:Times New Roman;"  >(5)</span><span style="font-family:宋体;"  >利用段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >调用同级代码段</span><span style="font-family:Times New Roman;"  >C</span><span style="font-family:宋体;"  >中的</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >子程序</span><span style="font-family:Times New Roman;"  >D</span><span style="font-family:宋体;"  >显示字符串信息；</span><span style="font-family:Times New Roman;"  >(6)</span><span style="font-family:宋体;"  >利用段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >调用同级代码段</span><span style="font-family:Times New Roman;"  >C</span><span style="font-family:宋体;"  >中的子程序</span><span style="font-family:Times New Roman;"  >H</span><span style="font-family:宋体;"  >把十六进制</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >数转换成对应的</span><span style="font-family:Times New Roman;"  >ASCII</span><span style="font-family:宋体;"  >码；</span><span style="font-family:Times New Roman;"  >(7)</span><span style="font-family:宋体;"  >再利用段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >调用同级代码段</span><span style="font-family:Times New Roman;"  >C</span><span style="font-family:宋体;"  >中的子程序</span><span style="font-family:Times New Roman;"  >D</span><span style="font-family:宋体;"  >显示字符</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >串信息；</span><span style="font-family:Times New Roman;"  >(8)</span><span style="font-family:宋体;"  >利用段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >实现从代码段</span><span style="font-family:Times New Roman;"  >L</span><span style="font-family:宋体;"  >到代码段</span><span style="font-family:Times New Roman;"  >K</span><span style="font-family:宋体;"  >的转移；</span><span style="font-family:Times New Roman;"  >(9)</span><span style="font-family:宋体;"  >从保护模式切换到实</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >模式；</span><span style="font-family:Times New Roman;"  >(10)</span><span style="font-family:宋体;"  >在实模式下结束程序。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >该实例的逻辑功能是用十六进制数的形式显示代码段</span><span style="font-family:Times New Roman;"  >L</span><span style="font-family:宋体;"  >的段界限的值。源程序如下：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >名称</span></em><span style="font-family:Times New Roman;"  ><em>:ASM3.ASM</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >功能</span><span style="font-family:Times New Roman;"  >:</span><span style="font-family:宋体;"  >演示任务内无特权级变换的转移</span></em><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >编译</span></em><span style="font-family:Times New Roman;"  ><em>:TASM ASM3.ASM</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >连接</span></em><span style="font-family:Times New Roman;"  ><em>:TLINK ASM3.OBJ</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:#009999; font-family:Times New Roman; font-size:9pt;"  >INCLUDE<span style="color:black;"  >         386SCD.INC </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >GDTSeg          <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999900;"  >'GDT'<span style="color:black;"  >             <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>全局描述符表数据段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(16</span><span style="font-family:宋体;"  >位</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >GDT             <span style="color:#009999;"  >LABEL<span style="color:black;"  >       <span style="color:#009999;"  >BYTE<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>全局描述符表</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DUMMY           Desc    <span style="color:red;"  >&lt;&gt;<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>空描述符</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >Normal          Desc    <span style="color:red;"  >&lt;<span style="color:#000099;"  >0ffffh<span style="color:red;"  >,,,<span style="color:black;"  >ATDW<span style="color:red;"  >,,&gt;<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>规范段描述符</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >CodeK           Desc    <span style="color:red;"  >&lt;<span style="color:#000099;"  >0ffffh<span style="color:red;"  >,,,<span style="color:black;"  >ATCE<span style="color:red;"  >,,&gt;<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>代码段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >K</span><span style="font-family:宋体;"  >的描述符</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >LDTable         Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >LDTLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,,,<span style="color:black;"  >ATLDT<span style="color:red;"  >,,&gt;<span style="color:black;"  >             <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>局部描述符表段的描述符</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >GDTLen          <span style="color:red;"  >=<span style="color:black;"  >       <span style="color:red;"  >$-<span style="color:black;"  >GDT                     <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>全局描述符表长度</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >Normal_Sel      <span style="color:red;"  >=<span style="color:black;"  >       Normal<span style="color:red;"  >-<span style="color:black;"  >GDT                <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>规范段描述符选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >CodeK_Sel       <span style="color:red;"  >=<span style="color:black;"  >       CodeK<span style="color:red;"  >-<span style="color:black;"  >GDT                 <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>代码段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >K</span><span style="font-family:宋体;"  >的选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >LDT_Sel         <span style="color:red;"  >=<span style="color:black;"  >       LDTable<span style="color:red;"  >-<span style="color:black;"  >GDT               <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>局部描述符表段<span style="color:#999999;"  >的选择子</span></em></span><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >GDTSeg          <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>全局描述符表段定义结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >LDTSeg          <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999900;"  >'LDT'<span style="color:black;"  >             <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>局部描述符表数据段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(16</span><span style="font-family:宋体;"  >位</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >LDT             <span style="color:#009999;"  >LABEL<span style="color:black;"  >       <span style="color:#009999;"  >BYTE<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>局部描述符表</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >代码段</span><span style="font-family:Times New Roman;"  >L</span><span style="font-family:宋体;"  >的描述符</span></em><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >CodeL           Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >CodeLLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >CodeLSeg<span style="color:red;"  >,,<span style="color:black;"  >ATCE<span style="color:red;"  >,,&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >代码段</span><span style="font-family:Times New Roman;"  >C</span><span style="font-family:宋体;"  >的描述符</span></em><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >CodeC           Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >CodeCLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >CodeCSeg<span style="color:red;"  >,,<span style="color:black;"  >ATCE<span style="color:red;"  >,,&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >显示缓冲区段描述符</span></em><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >VideoBuf        Desc    <span style="color:red;"  >&lt;<span style="color:#000099;"  >0ffffh<span style="color:red;"  >,<span style="color:#000099;"  >0b800h<span style="color:red;"  >,,<span style="color:black;"  >ATDW<span style="color:red;"  >,,&gt;<span style="color:black;"  >           </span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;LDT</span><span style="font-family:宋体;"  >别名段描述符</span></em><span style="font-family:Times New Roman;"  ><em>(DPL=3)</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToLDT           Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >LDTLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >LDTSEG<span style="color:red;"  >,,<span style="color:black;"  >ATDR<span style="color:red;"  >+<span style="color:black;"  >DPL3<span style="color:red;"  >,,&gt;<span style="color:black;"  >               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >显示信息缓冲区数据段描述符</span></em><span style="font-family:Times New Roman;"  ><em>(DPL=3)</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >MData           Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >MDataLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >MDataSeg<span style="color:red;"  >,,<span style="color:black;"  >ATDW<span style="color:red;"  >+<span style="color:black;"  >DPL3<span style="color:red;"  >,,&gt;<span style="color:black;"  >               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >堆栈段描述符</span></em><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >StackS          Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >TopOfS<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >StackSeg<span style="color:red;"  >,,<span style="color:black;"  >ATDWA<span style="color:red;"  >,,&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >LDTLen          <span style="color:red;"  >=<span style="color:black;"  >       <span style="color:red;"  >$-<span style="color:black;"  >LDT                     <span style="color:#999999;"  ><em>;LDT</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>所占字节数</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >LDNum           <span style="color:red;"  >=<span style="color:black;"  >       <span style="color:red;"  >($-<span style="color:black;"  >LDT<span style="color:red;"  >)/(<span style="color:#009999;"  >SIZE<span style="color:black;"  > Desc<span style="color:red;"  >)<span style="color:black;"  >              <span style="color:#999999;"  ><em>;LDT</em></span></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>含描述符项数</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >CodeL_Sel       <span style="color:red;"  >=<span style="color:black;"  >       CodeL<span style="color:red;"  >-<span style="color:black;"  >LDT<span style="color:red;"  >+<span style="color:black;"  >TIL             <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>代码段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >L</span><span style="font-family:宋体;"  >的选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >CodeC_Sel       <span style="color:red;"  >=<span style="color:black;"  >       CodeC<span style="color:red;"  >-<span style="color:black;"  >LDT<span style="color:red;"  >+<span style="color:black;"  >TIL             <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>代码段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >C</span><span style="font-family:宋体;"  >的选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >Video_Sel       <span style="color:red;"  >=<span style="color:black;"  >       VideoBuf<span style="color:red;"  >-<span style="color:black;"  >LDT<span style="color:red;"  >+<span style="color:black;"  >TIL          <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>显示缓冲区选择<span style="color:#999999;"  >子</span></em></span><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >ToLDT_Sel       <span style="color:red;"  >=<span style="color:black;"  >       ToLDT<span style="color:red;"  >-<span style="color:black;"  >LDT<span style="color:red;"  >+<span style="color:black;"  >TIL             <span style="color:#999999;"  ><em>;LDT</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>别名段选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >MData_Sel       <span style="color:red;"  >=<span style="color:black;"  >       MData<span style="color:red;"  >-<span style="color:black;"  >LDT<span style="color:red;"  >+<span style="color:black;"  >TIL<span style="color:red;"  >+<span style="color:black;"  >RPL3        <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>显示信息数据段选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >Stack_Sel       <span style="color:red;"  >=<span style="color:black;"  >       StackS<span style="color:red;"  >-<span style="color:black;"  >LDT<span style="color:red;"  >+<span style="color:black;"  >TIL            <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>堆栈段选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >LDTSeg          <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>局部描述符表段定义结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >MDataSeg        <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999900;"  >'MDATA'<span style="color:black;"  >             <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>显示信息缓冲区数据段</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Message         <span style="color:#009999;"  >DB<span style="color:black;"  >      <span style="color:#999900;"  >'Value='<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Buffer          <span style="color:#009999;"  >DB<span style="color:black;"  >      <span style="color:#000099;"  >80<span style="color:black;"  >        <span style="color:#009999;"  >DUP<span style="color:red;"  >(<span style="color:#000099;"  >0<span style="color:red;"  >)<span style="color:black;"  >            </span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >MDataLen        <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >MDataSeg        <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>显示缓冲区数据段结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >StackSeg        <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >DWORD<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999900;"  >'STACK'<span style="color:black;"  >             <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>堆栈段</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DW<span style="color:black;"  >      <span style="color:#000099;"  >512<span style="color:black;"  >        <span style="color:#009999;"  >DUP<span style="color:red;"  >(?)<span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >TopOfS          <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >StackSeg        <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>堆栈段结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >CodeCSeg        <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999900;"  >'CODEC'<span style="color:black;"  >             <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>任务代码段</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>C</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:CodeCSeg </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >显示信息子程序</span></em><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >入口参数</span><span style="font-family:Times New Roman;"  >:fs:si</span><span style="font-family:宋体;"  >指向要显示的以</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >结尾的字符串</span><span style="font-family:Times New Roman;"  >,es:di</span><span style="font-family:宋体;"  >指向显示缓冲区</span></em><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DispMsg         <span style="color:#009999;"  >PROC<span style="color:black;"  >      <span style="color:#009999;"  >FAR<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ah<span style="color:red;"  >,<span style="color:#000099;"  >01001110b<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >Disp1:<span style="color:black;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#009999;"  >BYTE<span style="color:black;"  >           <span style="color:#009999;"  >PTR<span style="color:black;"  >             <span style="color:fuchsia;"  >fs<span style="color:black;"  >:<span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >]<span style="color:black;"  >                  </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >inc<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >or<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:fuchsia;"  >al<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >jz<span style="color:black;"  >      Disp2 </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:fuchsia;"  >es<span style="color:black;"  >:<span style="color:red;"  >[<span style="color:fuchsia;"  >di<span style="color:red;"  >],<span style="color:fuchsia;"  >ax<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >inc<span style="color:black;"  >      <span style="color:fuchsia;"  >di<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >inc<span style="color:black;"  >      <span style="color:fuchsia;"  >di<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >jmp<span style="color:black;"  >     Disp1 </span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >Disp2:<span style="color:black;"  >     <span style="color:blue;"  >ret<span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DispMsg         <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >把</span><span style="font-family:Times New Roman;"  >AL</span><span style="font-family:宋体;"  >寄存器低</span><span style="font-family:Times New Roman;"  >4</span><span style="font-family:宋体;"  >位二进制数</span><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >一位</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >进制数</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >转换成</span><span style="font-family:Times New Roman;"  >ASCII</span><span style="font-family:宋体;"  >码</span></em><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >HToASCII        <span style="color:#009999;"  >PROC<span style="color:black;"  >      <span style="color:#009999;"  >FAR<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >and<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >00001111b<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >add<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >90h<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >daa<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >adc<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >40h<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >daa<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >ret<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >HToASCII        <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >CodeCLen        <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >CodeCSeg        <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>代码段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >C</span><span style="font-family:宋体;"  >定义结束</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >CodeLSeg        <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >      <span style="color:#009999;"  >PARA<span style="color:black;"  >        <span style="color:#009999;"  >USE16<span style="color:black;"  >          <span style="color:#999900;"  >'CODEL'<span style="color:black;"  >           </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:CodeLSeg </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Virtual2        <span style="color:#009999;"  >PROC<span style="color:black;"  >      <span style="color:#009999;"  >FAR<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >Video_Sel              <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>设置显示缓冲区指针</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >es<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >di<span style="color:red;"  >,<span style="color:#000099;"  >1986<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >MData_Sel              <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>设置提示信息缓冲区指针</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >fs<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >OFFSET<span style="color:black;"  > Message </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009900;"  >CALL16<span style="color:black;"  >  CodeC_Sel<span style="color:red;"  >,<span style="color:black;"  >DispMsg         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>显示提示信息</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >ToLDT_Sel              <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>把演示任务的</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >的别名</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >gs<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>段的描述符选择子装入</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>GS</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >dx<span style="color:red;"  >,<span style="color:#009999;"  >WORD<span style="color:black;"  >          <span style="color:#009999;"  >PTR<span style="color:black;"  >            <span style="color:fuchsia;"  >gs<span style="color:black;"  >:CodeL<span style="color:red;"  >.<span style="color:black;"  >LimitL </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >OFFSET<span style="color:black;"  > Buffer          <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>取代码段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >L</span><span style="font-family:宋体;"  >的段界限值</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >cx<span style="color:red;"  >,<span style="color:#000099;"  >4<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>并转成对应可显示字符串</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >Vir:<span style="color:black;"  >     <span style="color:blue;"  >rol<span style="color:black;"  >       <span style="color:fuchsia;"  >dx<span style="color:red;"  >,<span style="color:#000099;"  >4<span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:fuchsia;"  >dl<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >CALL16<span style="color:black;"  >  CodeC_Sel<span style="color:red;"  >,<span style="color:black;"  >HToASCII </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:fuchsia;"  >fs<span style="color:black;"  >:<span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >],<span style="color:fuchsia;"  >al<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >inc<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >loop<span style="color:black;"  >    Vir </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:fuchsia;"  >fs<span style="color:black;"  >:<span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >],<span style="color:#999900;"  >'H'<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >OFFSET<span style="color:black;"  > Buffer </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >CALL16<span style="color:black;"  >  CodeC_Sel<span style="color:red;"  >,<span style="color:black;"  >DispMsg </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >JUMP16<span style="color:black;"  >  CodeK_Sel<span style="color:red;"  >,<span style="color:black;"  >Virtual3 </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >CodeLLen        <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Virtual2        <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >CodeLSeg        <span style="color:#009999;"  >ENDS<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >CodeKSeg        <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >      <span style="color:#009999;"  >PARA<span style="color:black;"  >        <span style="color:#009999;"  >USE16<span style="color:black;"  >          <span style="color:#999900;"  >'CODEK'<span style="color:black;"  >           </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:CodeKSeg </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Virtual1        <span style="color:#009999;"  >PROC<span style="color:black;"  >      <span style="color:#009999;"  >FAR<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >LDT_Sel </span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >LLDT<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>加载局部描述符表寄存器</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>LDTR</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >Stack_Sel </span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ss<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>建立演示任务堆栈</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >sp<span style="color:red;"  >,<span style="color:#009999;"  >OFFSET<span style="color:black;"  > TopOfS </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >JUMP16<span style="color:black;"  >  CodeL_Sel<span style="color:red;"  >,<span style="color:black;"  >Virtual2 </span></span></span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >Virtual3:<span style="color:black;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >Normal_Sel </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >es<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >fs<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >gs<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ss<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:fuchsia;"  >cr0<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >and<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >11111110b<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >cr0<span style="color:red;"  >,<span style="color:fuchsia;"  >eax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >JUMP16<span style="color:black;"  >      <span style="color:red;"  >&lt;<span style="color:#009999;"  >SEG<span style="color:black;"  > Real<span style="color:red;"  >&gt;,&lt;<span style="color:#009999;"  >OFFSET<span style="color:black;"  > Real<span style="color:red;"  >&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >CodeKLen        <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Virtual1        <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >CodeKSeg        <span style="color:#009999;"  >ENDS<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;============================================================================</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >RDataSeg        <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>实方式数据段</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >VGDTR           PDesc   <span style="color:red;"  >&lt;<span style="color:black;"  >GDTLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,&gt;<span style="color:black;"  >           <span style="color:#999999;"  ><em>;GDT</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>伪描述符</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >SPVar           <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:red;"  >?<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>用于保存实方式下的</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>SP</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >SSVar           <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:red;"  >?<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>用于保存实方式下的</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>SS</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >RDataSeg        <span style="color:#009999;"  >ENDS<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >RCodeSeg        <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >      <span style="color:#009999;"  >PARA<span style="color:black;"  >        <span style="color:#009999;"  >USE16<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:RCodeSeg </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Start           <span style="color:#009999;"  >PROC<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >DS<span style="color:black;"  >:GDTSeg </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#999999;"  ><em>;-----------------</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >GDTSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>初始化全局描述符表</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >bx<span style="color:red;"  >,<span style="color:#000099;"  >16<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >CodeKSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mul<span style="color:black;"  >      <span style="color:fuchsia;"  >bx<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >     CodeK<span style="color:red;"  >.<span style="color:black;"  >BaseL<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >     CodeK<span style="color:red;"  >.<span style="color:black;"  >BaseM<span style="color:red;"  >,<span style="color:fuchsia;"  >dl<span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >     CodeK<span style="color:red;"  >.<span style="color:black;"  >BaseH<span style="color:red;"  >,<span style="color:fuchsia;"  >dh<span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >LDTSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mul<span style="color:black;"  >      <span style="color:fuchsia;"  >bx<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >     LDTable<span style="color:red;"  >.<span style="color:black;"  >BaseL<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >     LDTable<span style="color:red;"  >.<span style="color:black;"  >BaseM<span style="color:red;"  >,<span style="color:fuchsia;"  >dl<span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >     LDTable<span style="color:red;"  >.<span style="color:black;"  >BaseH<span style="color:red;"  >,<span style="color:fuchsia;"  >dh<span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>设置</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >伪描述符</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >DS<span style="color:black;"  >:RDataSeg </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >RDataSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >GDTSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mul<span style="color:black;"  >      <span style="color:fuchsia;"  >bx<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  > VGDTR<span style="color:red;"  >.<span style="color:black;"  >Base<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >              </span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  > VGDTR<span style="color:red;"  >.<span style="color:black;"  >Base<span style="color:red;"  >+<span style="color:#000099;"  >2<span style="color:red;"  >,<span style="color:fuchsia;"  >dx<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>初始化演示任务</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>LDT</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >cld<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >call<span style="color:black;"  >    Init_MLDT </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>保存实方式堆栈指针</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >     SSVar<span style="color:red;"  >,<span style="color:fuchsia;"  >ss<span style="color:black;"  >        </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >     SPVar<span style="color:red;"  >,<span style="color:fuchsia;"  >sp<span style="color:black;"  >        </span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>装载</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>GDTR</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >lgdt<span style="color:black;"  >      <span style="color:#009999;"  >QWORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  > VGDTR </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >cli<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>切换到保护方式</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:fuchsia;"  >cr0<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >or<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >1<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >cr0<span style="color:red;"  >,<span style="color:fuchsia;"  >eax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >JUMP16<span style="color:black;"  >      <span style="color:red;"  >&lt;<span style="color:black;"  >CodeK_Sel<span style="color:red;"  >&gt;,&lt;<span style="color:#009999;"  >OFFSET<span style="color:black;"  > Virtual1<span style="color:red;"  >&gt;<span style="color:black;"  >            </span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#990000; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >Real:<span style="color:black;"  >      <span style="color:#999999;"  ><em>;</em></span></span></span><span style="font-family:宋体;"  ><em>又回到实方式</em></span><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >RDataSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >lss<span style="color:black;"  >      <span style="color:fuchsia;"  >sp<span style="color:red;"  >,<span style="color:#009999;"  >DWORD<span style="color:black;"  >          <span style="color:#009999;"  >PTR<span style="color:black;"  > SPVar </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >sti<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:#000099;"  >4c00h<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >int<span style="color:black;"  >      <span style="color:#000099;"  >21h<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Start           <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Init_MLDT       <span style="color:#009999;"  >PROC<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >push<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >LDTSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >cx<span style="color:red;"  >,<span style="color:black;"  >LDNum </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >OFFSET<span style="color:black;"  > LDT </span></span></span></span></span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >InitL:<span style="color:black;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseL </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >movzx<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >shl<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:#000099;"  >4<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >shld<span style="color:black;"  >      <span style="color:fuchsia;"  >edx<span style="color:red;"  >,<span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:#000099;"  >16<span style="color:black;"  >           </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseL<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >            </span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseM<span style="color:red;"  >,<span style="color:fuchsia;"  >dl<span style="color:black;"  >            </span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseH<span style="color:red;"  >,<span style="color:fuchsia;"  >dh<span style="color:black;"  >            </span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >add<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >SIZE<span style="color:black;"  > Desc </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >loop<span style="color:black;"  >    InitL </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >pop<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >ret<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Init_MLDT       <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >RCodeSeg        <span style="color:#009999;"  >ENDS<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >END<span style="color:black;"  >     Start </span></span></span></p><p> &nbsp;</p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>2.关于实例三的说明 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >有些步骤的实现方法已在前面的实例中做过介绍，下面就任务内无特权级变换的转移和使用局部</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >描述符</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >等作些说明：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(1)实模式下初始化LDT </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >演示任务使用了局部描述符表</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >，本实例中该</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >在实模式下初始化</span><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >当然，也可以在使用</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >前</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的保护模式初始化</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >。为了简便，</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >中各描述符的界限和属性值在定义时预置，利用一个子程序</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >设置各段的段基地址。为方便起见，在定义时把各段的段值安排在相应描述符的段基地址低</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >字段中。由于实例中各段在实模式下定位</span><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >这是因为程序是从实模式下启动执行的</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >，所以把段值</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >乘以</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >就是对应的段基地址。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(2)装载LDTR寄存器 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在使用</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >之前，还要装载局部描述符表寄存器</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >。本实例中的如下两条指令用于装载</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >LDT_SEL </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >lldt<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >LLDT</span><span style="font-family:宋体;"  >指令是专门用于装载</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >的指令。该指令的操作数是对应</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >段描述符的选择子。根据该选择子，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >处理器从</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >中取出相应的</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >段描述符，在进行合法性等检查后，</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >段描述符的基地址和界限等信息</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >被装入</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >的高速缓冲寄存器中。由于要引用</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >，所以不能在实模式下装载</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >。在</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >操作系统类指</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >令</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >一文中将对</span><span style="font-family:Times New Roman;"  >LLDT</span><span style="font-family:宋体;"  >指令作详细说明。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(3)利用段间转移指令JMP实现任务内无特权级的转移 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在本实例中进入保护方式后，特权级是</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >。通过如下段间直接转移指令实现从代码段</span><span style="font-family:Times New Roman;"  >K</span><span style="font-family:宋体;"  >到代码段</span><span style="font-family:Times New Roman;"  >L</span><span style="font-family:宋体;"  >的转移：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    JUMP16    CodeL_Sel<span style="color:red;"  >,<span style="color:black;"  >Virtual2 </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >其中，选择子</span><span style="font-family:Times New Roman;"  >CodeL_Sel</span><span style="font-family:宋体;"  >是对应代码段</span><span style="font-family:Times New Roman;"  >L</span><span style="font-family:宋体;"  >的描述符的选择子。该描述符在</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >中，所以选择子中的描述</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >符表指示位</span><span style="font-family:Times New Roman;"  >TI</span><span style="font-family:宋体;"  >为</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >。描述符特权级是</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >，表示对应代码段的特权级是</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >，选择子中的请求特权级</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >也</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >是</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >。目标代码段不是一致代码段，所以在</span><span style="font-family:Times New Roman;"  >CPL=DPL</span><span style="font-family:宋体;"  >，</span><span style="font-family:Times New Roman;"  >RPL&lt;=DPL</span><span style="font-family:宋体;"  >的情况下，顺利进行相同特权级的转</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >移：目标代码段的选择子</span><span style="font-family:Times New Roman;"  >CodeL_Sel</span><span style="font-family:宋体;"  >被装入</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >，对应描述符中的信息被装入高速缓冲寄存器中，偏移</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >量</span><span style="font-family:Times New Roman;"  >Virtual2</span><span style="font-family:宋体;"  >被装入指令指针寄存器。由于是</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位代码段，所以偏移用</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位表示。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >类似地，通过如下段间直接转移指令实现从代码段</span><span style="font-family:Times New Roman;"  >L</span><span style="font-family:宋体;"  >转移到代码段</span><span style="font-family:Times New Roman;"  >K</span><span style="font-family:宋体;"  >：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    JUMP16    CodeK_Sel<span style="color:red;"  >,<span style="color:black;"  >Virtual3 </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >其中，选择子</span><span style="font-family:Times New Roman;"  >CodeK_Sel</span><span style="font-family:宋体;"  >是对应代码段</span><span style="font-family:Times New Roman;"  >K</span><span style="font-family:宋体;"  >的描述符选择子。由于描述符在</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >中，所以选择子中的</span><span style="font-family:Times New Roman;"  >TI</span><span style="font-family:宋体;"  >位是</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(4)利用段间调用指令CALL实现任务内无特权级变换的转移 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在代码段</span><span style="font-family:Times New Roman;"  >L</span><span style="font-family:宋体;"  >中，通过段间直接调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >调用了在代码段</span><span style="font-family:Times New Roman;"  >C</span><span style="font-family:宋体;"  >中的两个子程序，这些调用都是无特权级变</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >换的转移。例如，利用如下指令调用了显示字符串子程序</span><span style="font-family:Times New Roman;"  >DispMsg</span><span style="font-family:宋体;"  >：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    CALL16    CodeC_Sel<span style="color:red;"  >,<span style="color:black;"  >DispMsg </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >其中，</span><span style="font-family:Times New Roman;"  >CodeC_Sel</span><span style="font-family:宋体;"  >是代码段</span><span style="font-family:Times New Roman;"  >C</span><span style="font-family:宋体;"  >的选择子，</span><span style="font-family:Times New Roman;"  >DispMsg</span><span style="font-family:宋体;"  >表示子程序的入口。描述代码段</span><span style="font-family:Times New Roman;"  >C</span><span style="font-family:宋体;"  >的描述符在</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >中，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >描述符特权级</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >是</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >，所以使用的选择子</span><span style="font-family:Times New Roman;"  >CodeC_Sel</span><span style="font-family:宋体;"  >的请求特权级</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >是</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >，描述符表指示位</span><span style="font-family:Times New Roman;"  >TI</span><span style="font-family:宋体;"  >为</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >目标代码段</span><span style="font-family:Times New Roman;"  >C</span><span style="font-family:宋体;"  >不是一致代码段，所以在</span><span style="font-family:Times New Roman;"  >CPL=DPL</span><span style="font-family:宋体;"  >，</span><span style="font-family:Times New Roman;"  >RPL&lt;=DPL</span><span style="font-family:宋体;"  >的情况下，顺利进行相同特权级的转移：</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >当前</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >IP</span><span style="font-family:宋体;"  >压入堆栈，目标代码段的选择子</span><span style="font-family:Times New Roman;"  >CodeC_Sel</span><span style="font-family:宋体;"  >被装入</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >，对应描述符中的信息被装入高速缓</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >冲寄存器中，</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位偏移</span><span style="font-family:Times New Roman;"  >DispMsg</span><span style="font-family:宋体;"  >被装入指令指针</span><span style="font-family:Times New Roman;"  >IP</span><span style="font-family:宋体;"  >。由于是</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位段，所以偏移用</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位表示，压入堆栈</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的是字而不是双字。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(5)段间返回指令RET实现任务内无特权级变换的转移 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >从堆栈的栈顶弹出返回地址</span><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >由选择子和偏移</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >构成。弹出选择子内的</span><span style="font-family:Times New Roman;"  >RPL=CPL</span><span style="font-family:宋体;"  >，并</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >且对应</span><span style="font-family:Times New Roman;"  >DPL=CPL</span><span style="font-family:宋体;"  >，</span><span style="font-family:Times New Roman;"  >RPL&lt;=DPL</span><span style="font-family:宋体;"  >是当然的，所以能顺利进行相同特权级的转移。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>3.别名技术 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在上述实例三中，使用了两个描述符来描述演示任务的</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >段。段描述符</span><span style="font-family:Times New Roman;"  >LDTable</span><span style="font-family:宋体;"  >被安排在</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >中，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >它是系统段描述符，把段</span><span style="font-family:Times New Roman;"  >LDTSeg</span><span style="font-family:宋体;"  >描述成演示任务的局部描述符表</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >。描述符</span><span style="font-family:Times New Roman;"  >ToLDT</span><span style="font-family:宋体;"  >被安排在</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >中，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >它是数据段描述符，把段</span><span style="font-family:Times New Roman;"  >LDTSeg</span><span style="font-family:宋体;"  >描述成一个普通数据段。描述符</span><span style="font-family:Times New Roman;"  >LDTable</span><span style="font-family:宋体;"  >被装载到</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >，描述</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >符</span><span style="font-family:Times New Roman;"  >ToLDT</span><span style="font-family:宋体;"  >被装载到某个数据段寄存器。为什么要这样处理呢？根据实例三的功能要求，需要访问演示</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >任务的局部描述符表</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >段，以取得代码段</span><span style="font-family:Times New Roman;"  >L</span><span style="font-family:宋体;"  >的段界限值，这需要通过某个段寄存器进行，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >但不能把系统段描述符的选择子装载到段寄存器，所以采</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >用两个描述符来描述段</span><span style="font-family:Times New Roman;"  >LDTSeg</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >这种为了满足对同一个段实施不同方式操作的需要，而用多个描述符加以描述的技术称为别名技术。</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >在保护方式程序设计中，常常要采用别名技术。例如：用两个具有不同类型值的描述符来描述同一个</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >段。再如，用两个具有不同</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >的描述符来描述同一个段。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:18pt;"  ><strong>&lt;三&gt;任务内不同特权级的变换 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在一个任务内可以存在四种特权级，所以常常会发生不同特权级之间的变换。例如，外层的应用程</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >序调用内层操作系统的例程，以获得必要的诸如存储器分配等系统服务。内层操作系统的例程完成</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >后，返回到外层应用程序。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在同一任务内，实现特权级从外层到内层变换的普通途径是使用段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >，通过调用门进</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >行转移；实现特权级从内层向外层变换的普通途径是使用段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >。注意，不能用</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >指令</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >实现任务内不同特权级的变换。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>1.通过调用门的转移 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >当段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >和段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >所含指针的选择子指示调用门描述符时，就可以实现通过</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >调用门的转移。但只有</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >指令能变换到内层的特权级，</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >指令只能转移到同级的代码。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >调用门描述符转移的入口点包含目标地址的段及偏移量的</span><span style="font-family:Times New Roman;"  >48</span><span style="font-family:宋体;"  >位全指针。在执行通过任务门的段间转</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >或段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >时，指令所含指针内的选择子用</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >于确定调用门，而偏移被丢弃；把调用门内的</span><span style="font-family:Times New Roman;"  >48</span><span style="font-family:宋体;"  >位全指针作为目标地址指针进行转移。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >处理器采用与访问数据段相同的特权级规则控制对门描述符的访问。调用门描述符的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >规定了访</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >问该门的最外层特权级，在取出调用门内的</span><span style="font-family:Times New Roman;"  >48</span><span style="font-family:宋体;"  >位全指针，把它作为目标地址指针向目标代码段转移</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >之前，要进行特权级检查。只有在相同级或者更内层特权级的程序才可访问调用门，即</span><span style="font-family:Times New Roman;"  >CPL&lt;=</span><span style="font-family:宋体;"  >调用</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >门的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >。同时，还要求指示门的选择子的</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >必须满足</span><span style="font-family:Times New Roman;"  >RPL&lt;=</span><span style="font-family:宋体;"  >调</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >用门的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >的条件。检测通过后，才开始向目标代码段转移的步骤。其中还要检测目标描述</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >符是否为代码段描述符，调用门内的选择子指示的描述符必须是代码段描述符。此外，在装载代码</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >段描述符高速缓冲寄存器之前调整代码段选择子的</span><span style="font-family:Times New Roman;"  >RPL=0</span><span style="font-family:宋体;"  >，也即调用门中代码段选择子的</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >被忽略。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在装载</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >高速缓冲寄存器时，还要对目标代码段描述符进行保护检测。检测过程中的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >不再是调</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >用门的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >，而是调用门内选择子所指示的目标代码段描述符的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >。段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >和段间转移</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >所做的检测不一样。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >对于使用调用门的段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >，检测条件与段间直接转移相同。由于已置</span><span style="font-family:Times New Roman;"  >RPL=0</span><span style="font-family:宋体;"  >，所以可认为</span><span style="font-family:Times New Roman;"  >RPL&lt;=DPL</span><span style="font-family:宋体;"  >的条件总能满足。所以，对于普通的非一致代码段，当</span><span style="font-family:Times New Roman;"  >CPL=DPL</span><span style="font-family:宋体;"  >时，发生无特权级变换的</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >转移；对于一致代码段，在满足</span><span style="font-family:Times New Roman;"  >CPL&gt;=DPL</span><span style="font-family:宋体;"  >时也发生无特权级变换的转移；其它情形就引起异常。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >对于使用调用门的段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >，情形就不同了。由于已置</span><span style="font-family:Times New Roman;"  >RPL=0</span><span style="font-family:宋体;"  >，所以可认为</span><span style="font-family:Times New Roman;"  >RPL&lt;=DPL</span><span style="font-family:宋体;"  >的条</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >件总能满足。对于一致代码段，在满足</span><span style="font-family:Times New Roman;"  >CPL&gt;=DPL</span><span style="font-family:宋体;"  >时发生无特权级变换的转移。对于非一致代码段，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >当</span><span style="font-family:Times New Roman;"  >CPL=DPL</span><span style="font-family:宋体;"  >时，仍发生无特权级变换的转移；当</span><span style="font-family:Times New Roman;"  >CPL&gt;DPL</span><span style="font-family:宋体;"  >时，就发生向内层特权级变换的转移，将调</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >用门中的选择子和偏移装入</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >和指令指针</span><span style="font-family:Times New Roman;"  >EIP</span><span style="font-family:宋体;"  >中，并使</span><span style="font-family:Times New Roman;"  >CPL</span><span style="font-family:宋体;"  >保持等于</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >，同时切换到内层堆栈。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >综上所述，使用段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >，通过调用门可以实现从外层程序调用进入内层程序</span><span style="font-family:Times New Roman;"  >(JMP</span><span style="font-family:宋体;"  >指令只</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >能实现无特权级变换的转移</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >；通过调用门也可实现无特权级变换的转移。需要注意的是，</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >指令</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >指令都不能实现向外层特权级的转移否则会引起异常。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >当然，</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >指令在最后把目标代码段的指针装入</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >EIP</span><span style="font-family:宋体;"  >之前，要把原</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >EIP</span><span style="font-family:宋体;"  >，即返回地址保存到</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >堆栈。如无特权级变换，堆栈保持不变，返回地址就保存在原堆栈中；否则，返回地址保存在内层</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >堆栈中。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>2.堆栈切换 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在使用</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >指令通过调用门向内层转移时，不仅特权级发生变换，控制转移到一个新的代码段，而</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >且也切换到内层的堆栈段。从本教程第五篇的任务状态段</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >的格式可见，</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中包含有指</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >向</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级、</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >级和</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >级堆栈的指针。在特权级发生向内层变换时，根据变换到的特权级使用</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中相应的</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >堆栈指针对</span><span style="font-family:Times New Roman;"  >SS</span><span style="font-family:宋体;"  >及</span><span style="font-family:Times New Roman;"  >ESP</span><span style="font-family:宋体;"  >寄存器进行初始化，建立起一个空栈。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在建立起内层堆栈后，处理器先把外层堆栈的指针</span><span style="font-family:Times New Roman;"  >SS</span><span style="font-family:宋体;"  >及</span><span style="font-family:Times New Roman;"  >ESP</span><span style="font-family:宋体;"  >寄存器的值压入内层堆栈，以使得相应</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的向外层返回可恢复原来的外层堆栈。然后，从外层堆栈复制以双字为单位的调用参数到内层堆栈</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >中，调用门中的</span><span style="font-family:Times New Roman;"  >DCOUNT</span><span style="font-family:宋体;"  >字段值决定了复制参数的数量。这些被复制的参数是主程序通过堆栈传递给</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >子程序的实参，在调用之前被压入外层堆栈。通过复制栈中的参数，使内层的子程序不需要考虑堆</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >栈的切换，而容易地访问主程序传递过来的实参。最后，调用的返回地址被压入堆栈，以便在调用</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >结束时返回。下图为在向内层变换时，建立内层堆栈，并从外层堆栈复制</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >个双字参数到内层堆栈</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的示意图。图中每项是双字，可见的段寄存器内的选择子被扩展成</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >为存入堆栈，高</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位为</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >。对</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >于</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位的使用调用门的段也是如此。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p style="text-align: center;"  ><img title="六.控制转移 - Howie - Dspace"  src="pic/img7.ph.126.net_hXsAocrRSBKM-1Fk7QyBnw==_1299007017537210857.jpg"  alt=""  /><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >   </span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >需要注意的是，无论是否通过调用门，只要不发生特权级变换，就不会切换堆栈。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>3.向外层返回 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >与使用</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >指令通过调用门向内层变换相反，使用</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >指令实现向外层返回。段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >从</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >堆栈中弹出返回地址，并且可以采用调整</span><span style="font-family:Times New Roman;"  >ESP</span><span style="font-family:宋体;"  >的方法，跳过相应的在调用之前压入堆栈的参数。返</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >回地址的选择子指示要返回的代码段的描述符，从而确定返回的代码段。选择子的</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >确定返回后</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的特权级，而不是对应描述符的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >，这是因为，段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >可能使控制返回到一致代码段，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >而一致代码段可以在</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >规定的特权级以外的特权级执行。需要注意的是，</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >指令所使用的返回</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >地址的选择子只能使用代码段描述符，而不能使用任何系统段描述符或门描述符，当然，更不能</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >使用数据段描述符，否则会引起异常。与</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >指令相对应，</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >指令也不能向内层返回。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >段间返回指令完成返回的步骤如下：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(1)RET</span><span style="font-family:宋体;"  >指令先从堆栈中弹出返回地址。如果弹出地址的选择子的</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >规定相对于</span><span style="font-family:Times New Roman;"  >CPL</span><span style="font-family:宋体;"  >更外层的特权</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >级，那么就引起向外层返回。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(2)</span><span style="font-family:宋体;"  >为向外层返回，跳过内层堆栈中的参数，再从内层栈中弹出指向外层堆栈的指针，并装入</span><span style="font-family:Times New Roman;"  >SS</span><span style="font-family:宋体;"  >及</span><span style="font-family:Times New Roman;"  >ESP</span><span style="font-family:宋体;"  >，以恢复外层堆栈。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(3)</span><span style="font-family:宋体;"  >调整</span><span style="font-family:Times New Roman;"  >ESP</span><span style="font-family:宋体;"  >，跳过在相应的调用之前压入到外层堆栈的参数。即返回指令不但弹出内层栈的参数，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >而且也弹出外层栈的参数。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(4)</span><span style="font-family:宋体;"  >然后，检查数据段寄存器</span><span style="font-family:Times New Roman;"  >DS</span><span style="font-family:宋体;"  >、</span><span style="font-family:Times New Roman;"  >ES</span><span style="font-family:宋体;"  >、</span><span style="font-family:Times New Roman;"  >FS</span><span style="font-family:宋体;"  >及</span><span style="font-family:Times New Roman;"  >GS</span><span style="font-family:宋体;"  >，以保证寻址的段在外层是可访问的，如果段寄存器</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >寻址的段在外层是不可访问的，那么装入一个空选择子，以避免在返回时发生保护空洞。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(5)</span><span style="font-family:宋体;"  >返回外层继续执行。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >上述五步是对带立即数的段间返回指令而言的，立即数规定了堆栈中要跳过的参数的字节数。对于</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >无立即数的段间返回指令缺少第二步和第三步。若</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >指令不需要向外层返回，那么就只</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >有</span><span style="font-family:Times New Roman;"  >(1)</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >(5)</span><span style="font-family:宋体;"  >两步。对于有通过堆栈传递参数的子程序，必须使用带立即数的返回指令返回，否则返</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >回时会装载错误的外层栈指针。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >若不使用带立即数的返回指令，可以在返回前把外层栈的栈指针存入内层栈中的用于保存返回地址</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >上方两个双字的区域中，由外层返回的过程可知，这可正确恢复外层栈的指针，但在外层程序中，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >必须人为调整外层栈指针，以便废除在外层栈中压入的参数。在使用</span><span style="font-family:Times New Roman;"  >C</span><span style="font-family:宋体;"  >调用约定的程序中可使用此</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >方法。但这会增加代码的长度和处理时间，使代码效率变低。正因为如此，在</span><span style="font-family:Times New Roman;"  >Windows 9X</span><span style="font-family:宋体;"  >下，新增</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >加了一种</span><span style="font-family:Times New Roman;"  >STDCALL</span><span style="font-family:宋体;"  >的调用约定，它正是为了适应</span><span style="font-family:Times New Roman;"  >Intel</span><span style="font-family:宋体;"  >系列处理器的体系结构而产生的。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:18pt;"  ><strong>&lt;四&gt;演示任务内特权级变换的实例(实例四) </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >下面给出一个演示任务内特权级变换的实例。该实例演示在任务内通过调用门从外层特权级变换到</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >内层特权级；也演示通过段间返回指令从内层特权级变换到外层特权级；还演示通过调用门的无特</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >权级变换的转移。实例使用了任务状态段</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >，这是因为任务内特权级变换时要使用的内层堆栈指</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >针存放在</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>1.实现步骤 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >该实例的实现步骤为：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(1)</span><span style="font-family:宋体;"  >实方式下初始化；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(2)</span><span style="font-family:宋体;"  >切换到保护模式；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(3)</span><span style="font-family:宋体;"  >设置</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >。由于在任务内发生特权级变换时要切换堆栈，而内层堆栈的指针存放在当前任</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中，所以在进入保护模式后设置任务状态段寄存器</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >。由于演示任务使用了局部描述符表</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >，所以设置</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(4)</span><span style="font-family:宋体;"  >经调用门进入</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位过渡代码段；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(5)</span><span style="font-family:宋体;"  >建立返回</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级演示代码段的环境；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(6)</span><span style="font-family:宋体;"  >利用</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >指令转移到</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级的演示代码段。为了演示外层程序通过调用门调用内层程序，要</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >使</span><span style="font-family:Times New Roman;"  >CPL&gt;0</span><span style="font-family:宋体;"  >。实例先通过段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >从特权级</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >变换到特权级</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >的演示代码段。在特权级</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >下，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >通过调用门调用</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >级的子程序。随着执行段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >，又回到</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级的演示代码段；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(7)</span><span style="font-family:宋体;"  >在</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级的演示代码段中，经调用门转移到</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级的</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位过渡代码段；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(8)</span><span style="font-family:宋体;"  >直接转</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级的临时代码段；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(9)</span><span style="font-family:宋体;"  >准备返回实模式；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(10)</span><span style="font-family:宋体;"  >切换回实模式；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(11)</span><span style="font-family:宋体;"  >实模式下的恢复工作。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>2.源程序组织和清单 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >实例四由如下部分组成：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(1)</span><span style="font-family:宋体;"  >全局描述符表</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >含有演示任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >段描述符和</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >段描述符，此外还含有临时代码段</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的描述符、规范数据段描述符和视频缓冲区段描述符。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(2)</span><span style="font-family:宋体;"  >演示任务的</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >段。它含有除临时代码段外的其它代码段的描述符和演示任务各级堆栈段描</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >述符，还含有</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >个调用门。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(3)</span><span style="font-family:宋体;"  >演示任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >段。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(4)</span><span style="font-family:宋体;"  >演示任务的</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级、</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >级和</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级堆栈段。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(5)</span><span style="font-family:宋体;"  >显示子程序段。</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位代码段，特权级</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(6)</span><span style="font-family:宋体;"  >演示代码段。</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位代码段，特权级</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(7)</span><span style="font-family:宋体;"  >过渡代码段。</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位段，特权级</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(8)</span><span style="font-family:宋体;"  >临时代码段。</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位段，特权级</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(9)</span><span style="font-family:宋体;"  >实模式下的数据和代码段。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >该实例的逻辑功能是显示演示代码段执行时的当前特权级</span><span style="font-family:Times New Roman;"  >CPL</span><span style="font-family:宋体;"  >。源程序清单如下：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >名称</span></em><span style="font-family:Times New Roman;"  ><em>:ASM4.ASM</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >功能</span><span style="font-family:Times New Roman;"  >:</span><span style="font-family:宋体;"  >演示任务内有特权级变换的转移</span></em><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >编译</span></em><span style="font-family:Times New Roman;"  ><em>:TASM ASM4.ASM</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >连接</span></em><span style="font-family:Times New Roman;"  ><em>:TLINK /32 ASM4.OBJ</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:#009999; font-family:Times New Roman; font-size:9pt;"  >INCLUDE<span style="color:black;"  >     <span style="color:#000099;"  >386<span style="color:black;"  >SCD<span style="color:red;"  >.<span style="color:blue;"  >INC<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >GDTSeg          <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>全局描述符表数据段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(16</span><span style="font-family:宋体;"  >位</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>全局描述符表</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >GDT             <span style="color:#009999;"  >LABEL<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>空描述符</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DUMMY           Desc    <span style="color:red;"  >&lt;&gt;<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>规范段描述符</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Normal          Desc    <span style="color:red;"  >&lt;<span style="color:#000099;"  >0ffffh<span style="color:red;"  >,,,<span style="color:black;"  >ATDW<span style="color:red;"  >,,&gt;<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>视频缓冲区段描述符</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>(DPL=3)</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >VideoBuf        Desc    <span style="color:red;"  >&lt;<span style="color:#000099;"  >07fffh<span style="color:red;"  >,<span style="color:#000099;"  >8000h<span style="color:red;"  >,<span style="color:#000099;"  >0bh<span style="color:red;"  >,<span style="color:black;"  >ATDW<span style="color:red;"  >+<span style="color:black;"  >DPL3<span style="color:red;"  >,,&gt;<span style="color:black;"  >               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >EFFGDT          <span style="color:#009999;"  >LABEL<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>任务状态段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoTSS         Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoTssLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoTSSSeg<span style="color:red;"  >,,<span style="color:black;"  >AT386TSS<span style="color:red;"  >,,&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>局部描述符表段的描述符</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoLDTD        Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoLDTLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoLDTSeg<span style="color:red;"  >,,<span style="color:black;"  >ATLDT<span style="color:red;"  >,,&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>临时代码段描述符</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >TempCode        Desc    <span style="color:red;"  >&lt;<span style="color:#000099;"  >0ffffh<span style="color:red;"  >,<span style="color:black;"  >TempCodeSeg<span style="color:red;"  >,,<span style="color:black;"  >ATCE<span style="color:red;"  >,,&gt;<span style="color:black;"  >           </span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >GDTLen          <span style="color:red;"  >=<span style="color:black;"  >       <span style="color:red;"  >$-<span style="color:black;"  >GDT                     <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>全局描述符表长度</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >GDNum           <span style="color:red;"  >=<span style="color:black;"  >       <span style="color:red;"  >($-<span style="color:black;"  >EFFGDT<span style="color:red;"  >)/(<span style="color:#009999;"  >SIZE<span style="color:black;"  > Desc<span style="color:red;"  >)<span style="color:black;"  >              <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>需特殊处理的描述符数</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >Normal_Sel      <span style="color:red;"  >=<span style="color:black;"  >       Normal<span style="color:red;"  >-<span style="color:black;"  >GDT                <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>规范段描述符选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >Video_Sel       <span style="color:red;"  >=<span style="color:black;"  >       VideoBuf<span style="color:red;"  >-<span style="color:black;"  >GDT              <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>视频缓冲区段描述符选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoTSS_Sel     <span style="color:red;"  >=<span style="color:black;"  >       DemoTSS<span style="color:red;"  >-<span style="color:black;"  >GDT               <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>任务状态段描述符选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoLDT_Sel     <span style="color:red;"  >=<span style="color:black;"  >       DemoLDTD<span style="color:red;"  >-<span style="color:black;"  >GDT              <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>局部描述符表段的选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >TempCode_Sel    <span style="color:red;"  >=<span style="color:black;"  >       TempCode<span style="color:red;"  >-<span style="color:black;"  >GDT              <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>临时代码段的选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >GDTSeg          <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>全局描述符表段定义结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoLDTSeg      <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>局部描述符表数据段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(16</span><span style="font-family:宋体;"  >位</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoLDT         <span style="color:#009999;"  >LABEL<span style="color:black;"  >       <span style="color:#009999;"  >BYTE<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>局部描述符表</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;0</em></span></span><span style="font-family:宋体;"  ><em>级堆栈段描述符</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack0      Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoStack0Len<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoStack0Seg<span style="color:red;"  >,,<span style="color:black;"  >ATDW<span style="color:red;"  >+<span style="color:black;"  >DPL0<span style="color:red;"  >,<span style="color:black;"  >D32<span style="color:red;"  >,&gt;<span style="color:black;"  >                 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;1</em></span></span><span style="font-family:宋体;"  ><em>级堆栈段描述符</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack1      Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoStack1Len<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoStack1Seg<span style="color:red;"  >,,<span style="color:black;"  >ATDW<span style="color:red;"  >+<span style="color:black;"  >DPL1<span style="color:red;"  >,<span style="color:black;"  >D32<span style="color:red;"  >,&gt;<span style="color:black;"  >                 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;3</em></span></span><span style="font-family:宋体;"  ><em>级堆栈段描述符</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(16</span><span style="font-family:宋体;"  >位段</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack3      Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoStack3Len<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoStack3Seg<span style="color:red;"  >,,<span style="color:black;"  >ATDW<span style="color:red;"  >+<span style="color:black;"  >DPL3<span style="color:red;"  >,,&gt;<span style="color:black;"  >               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>代码段描述符</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span></em><span style="font-family:Times New Roman;"  ><em>,DPL=3)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoCode        Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoCodeLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoCodeSeg<span style="color:red;"  >,,<span style="color:black;"  >ATCE<span style="color:red;"  >+<span style="color:black;"  >DPL3<span style="color:red;"  >,<span style="color:black;"  >D32<span style="color:red;"  >,&gt;<span style="color:black;"  >                 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>过渡代码段描述符</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >T32Code         Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >T32CodeLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >T32CodeSeg<span style="color:red;"  >,,<span style="color:black;"  >ATCE<span style="color:red;"  >,<span style="color:black;"  >D32<span style="color:red;"  >,&gt;<span style="color:black;"  >               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>显示子程序代码段描述符</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span></em><span style="font-family:Times New Roman;"  ><em>,DPL=1)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >EchoSubR        Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >EchoSubRLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >EchoSubRSeg<span style="color:red;"  >,,<span style="color:black;"  >ATCER<span style="color:red;"  >+<span style="color:black;"  >DPL1<span style="color:red;"  >,<span style="color:black;"  >D32<span style="color:red;"  >,&gt;<span style="color:black;"  >                 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoLDNum       <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >($-<span style="color:black;"  >DemoLDT<span style="color:red;"  >)/(<span style="color:#009999;"  >SIZE<span style="color:black;"  > Desc<span style="color:red;"  >)<span style="color:black;"  >            </span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;0</em></span></span><span style="font-family:宋体;"  ><em>级堆栈描述符选择子</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>(RPL=0)</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack0_Sel  <span style="color:red;"  >=<span style="color:black;"  >       DemoStack0<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL<span style="color:red;"  >+<span style="color:black;"  >RPL0 </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;1</em></span></span><span style="font-family:宋体;"  ><em>级堆栈描述符选择子</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>(RPL=1)</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack1_Sel  <span style="color:red;"  >=<span style="color:black;"  >       DemoStack1<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL<span style="color:red;"  >+<span style="color:black;"  >RPL1 </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;3</em></span></span><span style="font-family:宋体;"  ><em>级堆栈描述符选择子</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>(RPL=3)</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack3_Sel  <span style="color:red;"  >=<span style="color:black;"  >       DemoStack3<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL<span style="color:red;"  >+<span style="color:black;"  >RPL3 </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>代码段描述符选择子</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>(RPL=3)</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoCode_Sel    <span style="color:red;"  >=<span style="color:black;"  >       DemoCode<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL<span style="color:red;"  >+<span style="color:black;"  >RPL3 </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>过渡代码段描述符选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >T32Code_Sel     <span style="color:red;"  >=<span style="color:black;"  >       T32Code<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>显示子程序代码段描述符选择子</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>(RPL=1)</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Echo_Sel1       <span style="color:red;"  >=<span style="color:black;"  >       EchoSubR<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL<span style="color:red;"  >+<span style="color:black;"  >RPL1 </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>显示子程序代码段描述符选择子</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>(RPL=3)</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Echo_Sel3       <span style="color:red;"  >=<span style="color:black;"  >       EchoSubR<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL<span style="color:red;"  >+<span style="color:black;"  >RPL3 </span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>指向过渡代码段内</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >T32Begin</span><span style="font-family:宋体;"  >点的调用门</span></em><span style="font-family:Times New Roman;"  ><em>(DPL=0)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToT32GateA      Gate    <span style="color:red;"  >&lt;<span style="color:black;"  >T32Begin<span style="color:red;"  >,<span style="color:black;"  >T32Code_Sel<span style="color:red;"  >,,<span style="color:black;"  >AT386CGate<span style="color:red;"  >,&gt;<span style="color:black;"  >           </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>指向过渡代码段内</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >T32End</span><span style="font-family:宋体;"  >点的调用门</span></em><span style="font-family:Times New Roman;"  ><em>(DPL=3)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToT32GateB      Gate    <span style="color:red;"  >&lt;<span style="color:black;"  >T32End<span style="color:red;"  >,<span style="color:black;"  >T32Code_Sel<span style="color:red;"  >,,<span style="color:black;"  >AT386CGate<span style="color:red;"  >+<span style="color:black;"  >DPL3<span style="color:red;"  >,&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>指向显示子程序代码段的调用门</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>(DPL=3)</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToEchoGate      Gate    <span style="color:red;"  >&lt;<span style="color:black;"  >EchoSub<span style="color:red;"  >,<span style="color:black;"  >Echo_Sel3<span style="color:red;"  >,,<span style="color:black;"  >AT386CGate<span style="color:red;"  >+<span style="color:black;"  >DPL3<span style="color:red;"  >,&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoLDTLen      <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$-<span style="color:black;"  >DemoLDT </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>指向过渡代码段内</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >T32Begin</span><span style="font-family:宋体;"  >点的调用门的选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToT32A_Sel      <span style="color:red;"  >=<span style="color:black;"  >       ToT32GateA<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>指向过渡代码段内</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >T32End</span><span style="font-family:宋体;"  >点的调用门的选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToT32B_Sel      <span style="color:red;"  >=<span style="color:black;"  >       ToT32GateB<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>显示子程序调用门的选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToEcho_Sel      <span style="color:red;"  >=<span style="color:black;"  >       ToEchoGate<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL </span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoLDTSeg      <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>局部描述符表段定义结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoTSSSeg      <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>任务状态段</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>TSS</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;Back</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DD<span style="color:black;"  >      DemoStack0Len             <span style="color:#999999;"  ><em>;0</em></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈指针</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DD<span style="color:black;"  >      DemoStack0_Sel            <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>初始化</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DD<span style="color:black;"  >      DemoStack1Len             <span style="color:#999999;"  ><em>;1</em></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈指针</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DD<span style="color:black;"  >      DemoStack1_Sel            <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>初始化</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DD<span style="color:black;"  >       <span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;2</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈指针</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DD<span style="color:black;"  >       <span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>未初始化</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;CR3</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EIP</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EFLAGS</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EAX</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;ECX</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EDX</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EBX</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;ESP</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EBP</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;ESI</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EDI</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;ES</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;CS</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;SS</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;DS</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;FS</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;GS</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      DemoLDT_Sel               <span style="color:#999999;"  ><em>;LDT</em><span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>调试陷阱标志</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:red;"  >$+<span style="color:#000099;"  >2<span style="color:black;"  >          <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>指向</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >I/O</span><span style="font-family:宋体;"  >许可位图</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:#000099;"  >0ffffh<span style="color:black;"  >         <span style="color:#999999;"  ><em>;I/O</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>许可位图结束标志</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoTSSLen      <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoTSSSeg      <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>任务状态段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >结束</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoStack0Seg   <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >DWORD<span style="color:black;"  >         <span style="color:#009999;"  >STACK<span style="color:black;"  >           <span style="color:#009999;"  >USE32<span style="color:black;"  >             <span style="color:#999999;"  ><em>;0</em></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack0Len   <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:#000099;"  >512<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DB<span style="color:black;"  >      DemoStack0Len <span style="color:#009999;"  >DUP<span style="color:red;"  >(?)<span style="color:black;"  >        </span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoStack0Seg   <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;0</em></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈段结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoStack1Seg   <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >DWORD<span style="color:black;"  >         <span style="color:#009999;"  >STACK<span style="color:black;"  >           <span style="color:#009999;"  >USE32<span style="color:black;"  >             <span style="color:#999999;"  ><em>;1</em></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack1Len   <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:#000099;"  >512<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DB<span style="color:black;"  >      DemoStack1Len <span style="color:#009999;"  >DUP<span style="color:red;"  >(?)<span style="color:black;"  >        </span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoStack1Seg   <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;1</em></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈段结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoStack3Seg   <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >DWORD<span style="color:black;"  >         <span style="color:#009999;"  >STACK<span style="color:black;"  >           <span style="color:#009999;"  >USE16<span style="color:black;"  >             <span style="color:#999999;"  ><em>;3</em></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(16</span><span style="font-family:宋体;"  >位段</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack3Len   <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:#000099;"  >512<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DB<span style="color:black;"  >      DemoStack3Len <span style="color:#009999;"  >DUP<span style="color:red;"  >(?)<span style="color:black;"  >        </span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoStack3Seg   <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;3</em></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈段结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >EchoSubRSeg     <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE32<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>显示子程序代码段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位</span><span style="font-family:Times New Roman;"  >,1</span><span style="font-family:宋体;"  >级</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:EchoSubRSeg </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >Message         <span style="color:#009999;"  >DB<span style="color:black;"  >       <span style="color:#999900;"  >'CPL='<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>显示信息</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >该代码段可读</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >EchoSub         <span style="color:#009999;"  >PROC<span style="color:black;"  >      <span style="color:#009999;"  >FAR<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >cld<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >push<span style="color:black;"  >      <span style="color:fuchsia;"  >ebp<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ebp<span style="color:red;"  >,<span style="color:fuchsia;"  >esp<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >Echo_Sel1              <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>该代码段是可读段</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ds<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>采用</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >RPL=1</span><span style="font-family:宋体;"  >的选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >Video_Sel </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >es<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >edi<span style="color:red;"  >,<span style="color:#000099;"  >1996<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >esi<span style="color:red;"  >,<span style="color:#009999;"  >OFFSET<span style="color:black;"  > Message </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ah<span style="color:red;"  >,<span style="color:#000099;"  >4eh<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>置显示属性</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >红底黄字</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >EchoSub1:<span style="color:black;"  >     <span style="color:blue;"  >lodsb<span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >or<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:fuchsia;"  >al<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >jz<span style="color:black;"  >      EchoSub2 </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >stosw<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >jmp<span style="color:black;"  >     EchoSub1 </span></span></span></p><p><span style="color:#990000; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >EchoSub2:<span style="color:black;"  >      <span style="color:blue;"  >mov<span style="color:black;"  >        <span style="color:fuchsia;"  >eax<span style="color:red;"  >,[<span style="color:fuchsia;"  >ebp<span style="color:red;"  >+<span style="color:#000099;"  >8<span style="color:red;"  >]<span style="color:black;"  >               <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>从堆栈中取调用程序的选择子</em></span><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >and<span style="color:black;"  >       <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >3<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>调用程序的</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >CPL</span><span style="font-family:宋体;"  >在</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >的</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >字段</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >add<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#999900;"  >'0'<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ah<span style="color:red;"  >,<span style="color:#000099;"  >4eh<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><em><span style="font-family:宋体;"  >置<span style="color:#999999;"  >显示属性</span></span><span style="font-family:Times New Roman;"  >(</span></em><span style="color:#999999;"  ><span style="font-family:宋体;"  ><em>红底黄字</em></span><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >stosw<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >pop<span style="color:black;"  >      <span style="color:fuchsia;"  >ebp<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >retf<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >EchoSub         <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >EchoSubRLen     <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >EchoSubRSeg     <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>显示子程序代码段结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoCodeSeg     <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE32<span style="color:black;"  >           <span style="color:#999999;"  ><em>;32</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>位代码段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(3</span><span style="font-family:宋体;"  >级</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:DemoCodeSeg </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoBegin       <span style="color:#009999;"  >PROC<span style="color:black;"  >      <span style="color:#009999;"  >FAR<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009900;"  >CALL32<span style="color:black;"  >  ToEcho_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >          <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>显示当前特权级</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >变换到</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >级</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009900;"  >CALL32<span style="color:black;"  >  ToT32B_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >          <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>转到过渡代码段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >变换到</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoBegin       <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoCodeLen     <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoCodeSeg     <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;32</em></span></span></span></span><span style="font-family:宋体;"  ><em>位代码段结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >T32CodeSeg      <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE32<span style="color:black;"  >           <span style="color:#999999;"  ><em>;32</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>位过渡代码段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(0</span><span style="font-family:宋体;"  >级</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:T32CodeSeg </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >T32Begin        <span style="color:#009999;"  >PROC<span style="color:black;"  >      <span style="color:#009999;"  >FAR<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >DemoStack0_Sel         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>建立</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级堆栈</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ss<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >esp<span style="color:red;"  >,<span style="color:black;"  >DemoStack0Len </span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >push<span style="color:black;"  >       <span style="color:#009999;"  >DWORD<span style="color:black;"  >         <span style="color:#009999;"  >PTR<span style="color:black;"  > DemoStack3_Sel  <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>压入</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级堆栈指针</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >push<span style="color:black;"  >    DemoStack3Len </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >push<span style="color:black;"  >       <span style="color:#009999;"  >DWORD<span style="color:black;"  >         <span style="color:#009999;"  >PTR<span style="color:black;"  > DemoCode_SEL    <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>压入入口点</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >push<span style="color:black;"  >      <span style="color:#009999;"  >OFFSET<span style="color:black;"  > DemoBegin </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >retf<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>利用</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >实现转</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级的演示代码</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >T32Begin        <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >T32End          <span style="color:#009999;"  >PROC<span style="color:black;"  >      <span style="color:#009999;"  >FAR<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >JUMP32<span style="color:black;"  >  TempCode_Sel<span style="color:red;"  >,&lt;<span style="color:#009999;"  >OFFSET<span style="color:black;"  > ToReal<span style="color:red;"  >&gt;<span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >T32End          <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >T32CodeLen      <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >T32CodeSeg      <span style="color:#009999;"  >ENDS<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >TempCodeSeg     <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999999;"  ><em>;16</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>位临时代码段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(0</span><span style="font-family:宋体;"  >级</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:TempCodeSeg </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Virtual         <span style="color:#009999;"  >PROC<span style="color:black;"  >      <span style="color:#009999;"  >FAR<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >DemoTSS_Sel            <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>装载</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>TR</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >ltr<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >DemoLDT_Sel            <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>装载</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>LDTR</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >lldt<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009900;"  >JUMP16<span style="color:black;"  >  ToT32A_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >          <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>通过调用门转过渡段</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#990000; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >ToReal:<span style="color:black;"  >      <span style="color:blue;"  >mov<span style="color:black;"  >        <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >Normal_Sel             <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>准备切换回实模式</em></span><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >es<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >fs<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >gs<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ss<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:fuchsia;"  >cr0<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >and<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >11111110b<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >cr0<span style="color:red;"  >,<span style="color:fuchsia;"  >eax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >JUMP16<span style="color:black;"  >      <span style="color:red;"  >&lt;<span style="color:#009999;"  >SEG<span style="color:black;"  > Real<span style="color:red;"  >&gt;,&lt;<span style="color:#009999;"  >OFFSET<span style="color:black;"  > Real<span style="color:red;"  >&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Virtual         <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >TempCodeLen     <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >TempCodeSeg     <span style="color:#009999;"  >ENDS<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;============================================================================</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >RDataSeg        <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>实方式数据段</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >VGDTR           PDesc   <span style="color:red;"  >&lt;<span style="color:black;"  >GDTLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,&gt;<span style="color:black;"  >           <span style="color:#999999;"  ><em>;GDT</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>伪描述符</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >SPVar           <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:red;"  >?<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>用于保存实方式下的</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>SP</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >SSVar           <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:red;"  >?<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>用于保存实方式下的</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>SS</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >RDataSeg        <span style="color:#009999;"  >ENDS<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >RCodeSeg        <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >      <span style="color:#009999;"  >PARA<span style="color:black;"  >        <span style="color:#009999;"  >USE16<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:RCodeSeg<span style="color:red;"  >,<span style="color:fuchsia;"  >DS<span style="color:black;"  >:RDataSeg </span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Start           <span style="color:#009999;"  >PROC<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >RDataSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >cld<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >CALL<span style="color:black;"  >    InitGDT                   <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>初始化全局描述符表</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>GDT</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >DemoLDTSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >fs<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >OFFSET<span style="color:black;"  > DemoLDT </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >cx<span style="color:red;"  >,<span style="color:black;"  >DemoLDNum </span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >CALL<span style="color:black;"  >    InitLDT                   <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>初始化局部描述符表</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>LDT</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >     SSVar<span style="color:red;"  >,<span style="color:fuchsia;"  >ss<span style="color:black;"  >        </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >     SPVar<span style="color:red;"  >,<span style="color:fuchsia;"  >sp<span style="color:black;"  >        </span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >lgdt<span style="color:black;"  >       <span style="color:#009999;"  >QWORD<span style="color:black;"  >         <span style="color:#009999;"  >PTR<span style="color:black;"  > VGDTR           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>装载</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >GDTR</span><span style="font-family:宋体;"  >并切换到保护方式</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >cli<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:fuchsia;"  >cr0<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >or<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >1<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >cr0<span style="color:red;"  >,<span style="color:fuchsia;"  >eax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >JUMP16<span style="color:black;"  >      <span style="color:red;"  >&lt;<span style="color:black;"  >TempCode_Sel<span style="color:red;"  >&gt;,&lt;<span style="color:#009999;"  >OFFSET<span style="color:black;"  > Virtual<span style="color:red;"  >&gt;<span style="color:black;"  >            </span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >Real:<span style="color:black;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >RDataSeg </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >lss<span style="color:black;"  >       <span style="color:fuchsia;"  >sp<span style="color:red;"  >,<span style="color:#009999;"  >DWORD<span style="color:black;"  >           <span style="color:#009999;"  >PTR<span style="color:black;"  > SPVar        <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>又回到实方式</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >sti<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:#000099;"  >4c00h<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >int<span style="color:black;"  >      <span style="color:#000099;"  >21h<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Start           <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >InitGDT         <span style="color:#009999;"  >PROC<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >push<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >GDTSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >cx<span style="color:red;"  >,<span style="color:black;"  >GDNum </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >OFFSET<span style="color:black;"  > EFFGDT </span></span></span></span></span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >InitG:<span style="color:black;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseL </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >movzx<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >shl<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:#000099;"  >4<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >shld<span style="color:black;"  >      <span style="color:fuchsia;"  >edx<span style="color:red;"  >,<span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:#000099;"  >16<span style="color:black;"  >           </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseL<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseM<span style="color:red;"  >,<span style="color:fuchsia;"  >dl<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseH<span style="color:red;"  >,<span style="color:fuchsia;"  >dh<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >add<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >SIZE<span style="color:black;"  > Desc </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >loop<span style="color:black;"  >    InitG </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >pop<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >bx<span style="color:red;"  >,<span style="color:#000099;"  >16<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >GDTSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mul<span style="color:black;"  >      <span style="color:fuchsia;"  >bx<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  > VGDTR<span style="color:red;"  >.<span style="color:black;"  >Base<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >              </span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  > VGDTR<span style="color:red;"  >.<span style="color:black;"  >Base<span style="color:red;"  >+<span style="color:#000099;"  >2<span style="color:red;"  >,<span style="color:fuchsia;"  >dx<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >ret<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >InitGDT         <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >入口参数</span><span style="font-family:Times New Roman;"  >:FS:SI=</span><span style="font-family:宋体;"  >第一个要初始化的描述符</span><span style="font-family:Times New Roman;"  >,CX=</span><span style="font-family:宋体;"  >要初始化的描述符数</span></em><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >InitLDT         <span style="color:#009999;"  >PROC<span style="color:black;"  >     </span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >ILDT:<span style="color:black;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:#009999;"  >WORD<span style="color:black;"  >           <span style="color:#009999;"  >PTR<span style="color:black;"  >             <span style="color:fuchsia;"  >FS<span style="color:black;"  >:<span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseL </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >movzx<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >shl<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:#000099;"  >4<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >shld<span style="color:black;"  >      <span style="color:fuchsia;"  >edx<span style="color:red;"  >,<span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:#000099;"  >16<span style="color:black;"  >           </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:fuchsia;"  >fs<span style="color:black;"  >:<span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseL<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >                  </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:fuchsia;"  >fs<span style="color:black;"  >:<span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseM<span style="color:red;"  >,<span style="color:fuchsia;"  >dl<span style="color:black;"  >                  </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:fuchsia;"  >fs<span style="color:black;"  >:<span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseH<span style="color:red;"  >,<span style="color:fuchsia;"  >dh<span style="color:black;"  >                  </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >add<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >SIZE<span style="color:black;"  > Desc </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >loop<span style="color:black;"  >    ILDT </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >ret<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >InitLDT         <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >RCodeSeg        <span style="color:#009999;"  >ENDS<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >END<span style="color:black;"  >     Start </span></span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>3.关于实例四的说明 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >程序中部分片段的背景和实现方法在前面的实例中做过介绍，下面主要就如何实现任务内特权级变换</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >做些说明：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(1)通过段间返回指令实现特权级变换 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >实例在两处使用段间返回指令实现任务内的特权级变换。一处是在</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级的过渡代码段中用段间</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >指令</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >从特权级</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >变换到特权级</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >的演示代码段。该处</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >指令并不对应</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >指令。实例从实模式切换到保护</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >模式后</span><span style="font-family:Times New Roman;"  >CPL=0</span><span style="font-family:宋体;"  >。为了演示如何通过调用门调用内层程序，要设法使</span><span style="font-family:Times New Roman;"  >CPL&gt;0</span><span style="font-family:宋体;"  >。为此，实例先建立一个已发</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >生的从外层到内层变换的环境，即按上图所示在当前堆栈</span><span style="font-family:Times New Roman;"  >(0</span><span style="font-family:宋体;"  >级堆栈</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >中放入外层堆栈的指针和外层演</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >示程序的入口指针，形成一个如下图所示的</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级堆栈，无需传递参数。然后，执行段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >从堆栈中弹出</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级演示代码段的选择子，</span><span style="font-family:Times New Roman;"  >RPL=3</span><span style="font-family:宋体;"  >，而当时</span><span style="font-family:Times New Roman;"  >CPL=0</span><span style="font-family:宋体;"  >，所以导致向外层变换特权级，从</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级的</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >过渡代码段变换到</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级的演示代码段，同时切换到</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级堆栈。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p style="text-align: center;"  ><img title="六.控制转移 - Howie - Dspace"  src="pic/img1.ph.126.net_ZibHDjLxM9pxtyS-mPrWCw==_2715107625368525361.jpg"  alt=""  /><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >   </span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >另一处是从</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >级的显示子程序</span><span style="font-family:Times New Roman;"  >EchoSub</span><span style="font-family:宋体;"  >返回到</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级的演示程序段。该处的</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >指令与演示程序中使用的通</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >过调用门的段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >相对应，执行段间返回指令</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >时的</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >级堆栈也如上图所示，其中的返回</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >地址和外层栈指针由</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >指令压入。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(2)通过调用门实现特权级变换 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >实例在两处使用了段间调用指令，通过调用门实现特权级的变换。一处是</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级演示代码通过调用</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >门</span><span style="font-family:Times New Roman;"  >ToEchoGate</span><span style="font-family:宋体;"  >调用</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >级的显示子程序。调用门</span><span style="font-family:Times New Roman;"  >ToEchoGate</span><span style="font-family:宋体;"  >自身的</span><span style="font-family:Times New Roman;"  >DPL=3</span><span style="font-family:宋体;"  >，只有这样，</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级的演示代码才</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >能够使用该调用门。由于调用门内的选择子</span><span style="font-family:Times New Roman;"  >Echo_Sel3</span><span style="font-family:宋体;"  >所指示的显示子程序代码段描述符</span><span style="font-family:Times New Roman;"  >DPL=1</span><span style="font-family:宋体;"  >，而当</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >时</span><span style="font-family:Times New Roman;"  >CPL=3</span><span style="font-family:宋体;"  >，所以引起从外层特权级向内层特权级的变换，使</span><span style="font-family:Times New Roman;"  >CPL=1</span><span style="font-family:宋体;"  >。同时形成如上图所示的</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >级堆栈。</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >虽然调用门内的选择子</span><span style="font-family:Times New Roman;"  >Echo_Sel3</span><span style="font-family:宋体;"  >的</span><span style="font-family:Times New Roman;"  >RPL=3</span><span style="font-family:宋体;"  >，大于目标代码段的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >，但没有关系，因为在通过调用门</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >转移时，门内指示目标代码段的选择子</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >总被作</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >对待。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >另一处是</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级演示代码还通过调用门</span><span style="font-family:Times New Roman;"  >ToT32GateB</span><span style="font-family:宋体;"  >调用了</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级的过渡代码。该处使用的调用门描述符</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >也</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >等于</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >。由于调用门内的选择子</span><span style="font-family:Times New Roman;"  >T32Code_Sel</span><span style="font-family:宋体;"  >所指示的过渡代码段描述符的</span><span style="font-family:Times New Roman;"  >DPL=0</span><span style="font-family:宋体;"  >，而当时</span><span style="font-family:Times New Roman;"  >CPL=3</span><span style="font-family:宋体;"  >，所以</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >引起从</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >特权级向</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >特权级的变换，使</span><span style="font-family:Times New Roman;"  >CPL=0</span><span style="font-family:宋体;"  >。同时形成如上图所示的</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级堆栈。但该处的调用实际上是</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >有去无回</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >的，调用的目的是转移到</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级的过渡代码，准备返回实模式。由于从</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >级的演示代码到</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的过渡代码要发生特权级变换，所以不能使用转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >，必须使用调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(3)通过调用门实现无特权级变换 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在临时代码段中，使用调用门</span><span style="font-family:Times New Roman;"  >ToT32GateA</span><span style="font-family:宋体;"  >转移到过渡代码段。尽管调用门内的选择子</span><span style="font-family:Times New Roman;"  >T32Code_Sel</span><span style="font-family:宋体;"  >所指</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >示的过渡代码段描述符的</span><span style="font-family:Times New Roman;"  >DPL=0</span><span style="font-family:宋体;"  >，但当时</span><span style="font-family:Times New Roman;"  >CPL=0</span><span style="font-family:宋体;"  >，所以不发生特权级变换。正是这个原因，才可以使用</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(4)子程序EchoSub的实现 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >子程序</span><span style="font-family:Times New Roman;"  >EchoSub</span><span style="font-family:宋体;"  >的功能是显示调用程序执行时的特权级。调用程序的执行特权级在代码段寄存器</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >内选</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >择子的</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >字段，在调用</span><span style="font-family:Times New Roman;"  >EchoSub</span><span style="font-family:宋体;"  >时，</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >寄存器的内容被压入堆栈。子程序从堆栈取得调用程序的代码</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >段选择子，再从中分离出</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >就可得调用程序的执行特权级。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(5)装载任务状态段寄存器TR </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在任务内发生特权级变换时堆栈也随着自动切换，外层堆栈指针保存在内层堆栈中，而内层堆栈指针</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >存放在当前任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中。所以，在从外层向内层变换时，要访问</span><span style="font-family:Times New Roman;"  >TSS(</span><span style="font-family:宋体;"  >从内层向外层转移时不需要访</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >问</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >，而只需内层栈中保存的栈指针</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >。实例在进入保护模式下的临时代码段后，通过如下两条指令</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >装载任务状态段寄存器</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >，使其指向已预置好的任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >DemoTSS_Sel </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >ltr<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >LTR</span><span style="font-family:宋体;"  >指令是专门用于装载任务状态段寄存器</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >的指令。该指令的操作数是对应</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >段描述符的选择</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >子。</span><span style="font-family:Times New Roman;"  >LTR</span><span style="font-family:宋体;"  >指令从</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >中取出相应的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >段描述符，把</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >段描述符的基地址和界限等信息装入</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >的高速</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >缓冲寄存器中。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:18pt;"  ><strong>&lt;五&gt;任务切换 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >利用段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >或者段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >，通过任务门或直接通过任务状态段，可以切换到别的</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >任务。此外，在中断</span><span style="font-family:Times New Roman;"  >/</span><span style="font-family:宋体;"  >异常或者执行</span><span style="font-family:Times New Roman;"  >IRET</span><span style="font-family:宋体;"  >指令时也可能发生任务切换。需要注意的是，因为</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >指令</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的目标地址只能使用代码段描述符，所以，不能通过</span><span style="font-family:Times New Roman;"  >RET</span><span style="font-family:宋体;"  >指令实现任务切换。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>1.直接通过TSS进行任务切换 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >或段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >所含指针的选择子指示一个可用任务状态段</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符时，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >正常情况下就发生从当前任务到由该可用</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >对应任务</span><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >目标任务</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >的切换。目标任务的入口点由</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >目标任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >内的</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >EIP</span><span style="font-family:宋体;"  >字段所规定的指针确定。这样的</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >或</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >指令内的偏移被丢弃。另外，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >对于段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >，若目标选择子指示一</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >段描述符或任务门时，则返回地址和外层栈指</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >针并不压入堆栈。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >处理器采用与访问数据段相同的特权级规则控制对</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >段描述符的访问。</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >段描述符的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >规定</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >了访问该描述符的最外层特权级，只有在相同级别或更内层级别的程序才可以访问它。同时，还</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >要求指示它的选择子的</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >必须满足</span><span style="font-family:Times New Roman;"  >RPL&lt;=TSS</span><span style="font-family:宋体;"  >的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >的条件。当这些条件满足时，就开始任务切换。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>2.通过任务门进行任务切换 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >任务门内的选择子指示某个任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符。当段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >或段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >所含指针</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的选择子指示一个任务门时，正常情况下就发生任务切换，即从当前任务切换到由任务门内的选</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >择子所指示的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符对应的任务</span><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >目标任务</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >。这样的</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >或</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >指令内的偏移被丢弃；任务门</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >内的偏移也无意义。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >处理器采用与访问数据段相同的特权级规则控制对任务门的访问。任务门的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >规定了访问该任</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >务门的最外层特权级，只有在同级或更内层级别的程序才可以访问它。同时，还要求指示任务门</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的选择子</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >必须满足</span><span style="font-family:Times New Roman;"  >RPL&lt;=</span><span style="font-family:宋体;"  >任务门的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >的条件。在这些条件满足时，再检查任务门内的选择子，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >要求该选择子指示</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >中的可用的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符。对于任务门所指向的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >不进行特权级</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >检查。检查通过以后，就开始任务切换。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>3.任务切换过程 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >根据指示目标任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符的选择子进行任务切换的一般过程如下：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >第一，测试目标任务状态段的界限。</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >用于保存任务的各种状态信息，不同的任务，</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中可以</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >有数量不等的其他信息，根据任务状态段的基本格式，</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >的界限应大于或等于</span><span style="font-family:Times New Roman;"  >103(104-1)</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >第二，把寄存器现场保存到当前任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >。把通用寄存器、段寄存器、</span><span style="font-family:Times New Roman;"  >EIP</span><span style="font-family:宋体;"  >及</span><span style="font-family:Times New Roman;"  >EFLAGS</span><span style="font-family:宋体;"  >的当前值保</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >存到当前</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中。保存的</span><span style="font-family:Times New Roman;"  >EIP</span><span style="font-family:宋体;"  >值是返回地址，指向引起任务切换指令的下一条指令。但不</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >把</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >CR3</span><span style="font-family:宋体;"  >的内容保存到</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >第三，把指示目标任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >的选择子装入</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >寄存器中。同时把对应</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >的描述符装入</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >的高速缓冲</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >寄存器中。此后，当前任务改称为原任务，目标任务改称为当前任务。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >第四，基本恢复当前任务</span><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >目标任务</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >的寄存器现场。根据保存在</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中的内容，恢复各通用寄存</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >器、段寄存器、</span><span style="font-family:Times New Roman;"  >EFLAGS</span><span style="font-family:宋体;"  >及</span><span style="font-family:Times New Roman;"  >EIP</span><span style="font-family:宋体;"  >。在装入寄存器的过程中，为了能正确地处理可能发生的异常，只</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >把对应选择子装入各段寄存器。此时选择子的</span><span style="font-family:Times New Roman;"  >P</span><span style="font-family:宋体;"  >位为</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >。还装载</span><span style="font-family:Times New Roman;"  >CR3</span><span style="font-family:宋体;"  >寄存器。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >第五，进行链接处理。如果需要链接，那么将指向原任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >的选择子写入当前任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >的链接字</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >段，把当前任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符类型改为</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >忙</span><span style="font-family:Times New Roman;"  >"(</span><span style="font-family:宋体;"  >并不修改原任务状态段描述符的</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >忙</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >位</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >，并将标</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >志寄存器</span><span style="font-family:Times New Roman;"  >EFLAGS</span><span style="font-family:宋体;"  >中的</span><span style="font-family:Times New Roman;"  >NT</span><span style="font-family:宋体;"  >位置</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >，表示是嵌套任务。如果需要解链，那么把原任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符类型改</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >为</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >可用</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >。如果无解链处理，那么将原任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符类型置为</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >可用</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >，当前任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >类型置为</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >忙</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >。由于</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >指令引起的任务切换不实施链接</span><span style="font-family:Times New Roman;"  >/</span><span style="font-family:宋体;"  >解链处理；由</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >指令、中断、</span><span style="font-family:Times New Roman;"  >IRET</span><span style="font-family:宋体;"  >指</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >令引起的任务切换要实施链接</span><span style="font-family:Times New Roman;"  >/</span><span style="font-family:宋体;"  >解链处理。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >第六，把</span><span style="font-family:Times New Roman;"  >CR0</span><span style="font-family:宋体;"  >中的</span><span style="font-family:Times New Roman;"  >TS</span><span style="font-family:宋体;"  >标志置为</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >，这表示已发生过任务切换，在当前任务使用协处理器指令时，产生</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >自陷。由自陷处理程序完成有关协处理器现场的保存和恢复。这有利于快速地进行任务切换。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >第七，把</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中的</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >选择子的</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >作为当前任务特权级设置为</span><span style="font-family:Times New Roman;"  >CPL</span><span style="font-family:宋体;"  >。又因为装入</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >高速缓冲寄存器时</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >要检测</span><span style="font-family:Times New Roman;"  >CPL=</span><span style="font-family:宋体;"  >代码段描述符的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >，所以</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中的选择子所指示的代码段描述符的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >必须等于该选择</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >子的</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >。任务切换可以在一个任务的任何特权级发生，并且可以切换到另一任务的任何特权级。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >第八，装载</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >寄存器。一个任务可以有自己的</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >，也可以没有。当任务没有</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >时，</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >选</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >择子为</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >。如果</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >选择子非空，则从</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >中读出对应的</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >描述符，在经过测试后，把所读</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >描述符装入</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >高速缓冲寄存器。如果</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >选择子为空，则将</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >的存在位置为</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >，表明任务不</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >使用</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >第九，装载代码段寄存器</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >、堆栈段寄存器</span><span style="font-family:Times New Roman;"  >SS</span><span style="font-family:宋体;"  >和各数据段寄存器及其高速缓冲寄存器。在装入代码</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >段高速缓存之前，也要进行特权检查，处理器调整</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中的</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >选择子的</span><span style="font-family:Times New Roman;"  >RPL=0</span><span style="font-family:宋体;"  >，装入之后，调</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >整</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >的</span><span style="font-family:Times New Roman;"  >RPL</span><span style="font-family:宋体;"  >等于目标代码段的</span><span style="font-family:Times New Roman;"  >DPL</span><span style="font-family:宋体;"  >。堆栈段使用的是</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中的</span><span style="font-family:Times New Roman;"  >SS</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >SP</span><span style="font-family:宋体;"  >字段的值，而不是使用内层栈保</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >存区中的指针，即使发生了向内层特权级的变换。这与任务内的通过调用门的转移不同。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >第十，把调试寄存器</span><span style="font-family:Times New Roman;"  >DR7</span><span style="font-family:宋体;"  >中的局部启用位置为</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >，以清除局部于原任务的各个断点和方式。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>4.关于任务状态和嵌套的说明 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >需要注意的是，任务切换不能递归。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >引起任务切换时，不实施链接，不导致任务的嵌套。它要求目标任务是可用任</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >务。切换过程中把原任务置为</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >可用</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >，目标任务置为</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >忙</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >引起任务切换时，实施链接，导致任务的嵌套。它要求目标任务是可用的任务。</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >在切换过程中把目标任务置为</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >忙</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >，原任务仍保持</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >忙</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >；标志寄存器</span><span style="font-family:Times New Roman;"  >EFLAGS</span><span style="font-family:宋体;"  >中的</span><span style="font-family:Times New Roman;"  >NT</span><span style="font-family:宋体;"  >位被置为</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >表示任务是嵌套任务。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在由中断异常引起任务切换时，实施链接，导致任务的嵌套。要求目标任务是可用的任务。在切换</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >过程中把目标任务置为</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >忙</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >，原任务仍保持</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >忙</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >；标志寄存器</span><span style="font-family:Times New Roman;"  >EFLAGS</span><span style="font-family:宋体;"  >中的</span><span style="font-family:Times New Roman;"  >NT</span><span style="font-family:宋体;"  >位被置为</span><span style="font-family:Times New Roman;"  >1</span><span style="font-family:宋体;"  >，表示任</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >务是嵌套任务。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在执行</span><span style="font-family:Times New Roman;"  >IRET</span><span style="font-family:宋体;"  >指令时引起任务切换，那么实施解链。要求目标任务是忙的任务。在切换过程中把原任</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >务置为</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >可用</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >，目标任务仍保持</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >忙</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >。关于中断</span><span style="font-family:Times New Roman;"  >/</span><span style="font-family:宋体;"  >异常如何引起任务切换和指令</span><span style="font-family:Times New Roman;"  >IRET</span><span style="font-family:宋体;"  >如何考虑任</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >务切换的内容将在后面的文章中论述。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:18pt;"  ><strong>&lt;六&gt;演示任务切换的实例(实例五) </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >下面给出一个用于演示任务切换的实例。该实例的逻辑功能是在切换后显示原任务的挂起点</span><span style="font-family:Times New Roman;"  >(EIP)</span><span style="font-family:宋体;"  >的</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >值。该实例演示内容包括：直接通过</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >段的任务切换，通过任务门的任务切换，任务内特权级的变</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >换及参数传递。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>1.实现步骤 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >为了达到演示任务切换和特权级变换的目的，实例五在保护方式下涉及到两个任务，一个任务称为</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >临时任务，另一个任务称为演示任务。演示任务的功能是演示通过调用门实现特权级的变换和堆栈</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >间参数的自动复制。临时任务和演示任务配合展示任务切换。实例五的主要实现步骤如下：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(1)</span><span style="font-family:宋体;"  >实模式下初始化；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(2)</span><span style="font-family:宋体;"  >切换到保护模式；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(3)</span><span style="font-family:宋体;"  >设置</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >对应临时任务，特权级为</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(4)</span><span style="font-family:宋体;"  >直接切换到演示任务，演示任务的特权级为</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(5)</span><span style="font-family:宋体;"  >把入口参数压入堆栈，经调用门进入显示信息子程序，显示信息子程序的特权级为</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(6)</span><span style="font-family:宋体;"  >从堆栈中取出入口参数并处理；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(7)</span><span style="font-family:宋体;"  >从显示信息子程序返回特权级为</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >的演示代码段；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(8)</span><span style="font-family:宋体;"  >为切换回实模式作部分准备工作；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(9)</span><span style="font-family:宋体;"  >经任务门切换到特权级为</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >的临时任务；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(10)</span><span style="font-family:宋体;"  >准备返回实模式；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(11)</span><span style="font-family:宋体;"  >切换到实模式；</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(12)</span><span style="font-family:宋体;"  >实模式下的恢复工作。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >在任务切换时，把原任务的现场保存到</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >所指示的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >内，然后再把指向目标任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符的</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >选择子装入</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >，所以在从临时任务切换到演示任务之前，要把指向临时任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符的选择子</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >装入</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >。通过把演示任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >初始化成恢复点在特权级</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >的代码段，使得从临时任务切换到演示</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >任务后，当前特权级</span><span style="font-family:Times New Roman;"  >CPL=2</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>2.源程序组织和清单 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >实例五由如下部分组成：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(1)</span><span style="font-family:宋体;"  >全局描述符表</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >GDT</span><span style="font-family:宋体;"  >含有演示任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符和</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >段描述符，还含有临时任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >和临时任务的代码段描述符，此外，还含有子程序代码段描述符、规范数据段描述符和视频缓冲</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >区段描述符。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(2)</span><span style="font-family:宋体;"  >演示任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >。以根据演示要求初始化。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(3)</span><span style="font-family:宋体;"  >演示任务的</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >段。它含有演示任务的</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级和</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >级堆栈段描述符、代码段和数据段描述符、分别</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >以数据段方式描述</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >和临时任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >的数据段描述符、以及指向子程序的调用门和指向临时任务</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的任务门。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(4)</span><span style="font-family:宋体;"  >演示任务的</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级和</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >级堆栈段。</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位段，特权级分别为</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(5)</span><span style="font-family:宋体;"  >演示任务数据段。</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位段，特权级</span><span style="font-family:Times New Roman;"  >3</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(6)</span><span style="font-family:宋体;"  >子程序代码段。</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位代码段，特权级</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(7)</span><span style="font-family:宋体;"  >演示任务代码段。</span><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位代码段，特权级</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(8)</span><span style="font-family:宋体;"  >临时任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >段。未初始化。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(9)</span><span style="font-family:宋体;"  >临时任务代码段。</span><span style="font-family:Times New Roman;"  >16</span><span style="font-family:宋体;"  >位代码段，特权级</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >(10)</span><span style="font-family:宋体;"  >实模式下的数据和代码段。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >该实例的逻辑功能是在切换后显示原任务的挂起点</span><span style="font-family:Times New Roman;"  >(EIP)</span><span style="font-family:宋体;"  >的值。源程序清单如下：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >名称</span></em><span style="font-family:Times New Roman;"  ><em>:ASM5.ASM</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >功能</span><span style="font-family:Times New Roman;"  >:</span><span style="font-family:宋体;"  >演示任务切换和任务内有特权级变换的转移</span></em><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >编译</span></em><span style="font-family:Times New Roman;"  ><em>:TASM ASM5.ASM</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >链接</span></em><span style="font-family:Times New Roman;"  ><em>:TLINK /32 ASM5.OBJ</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:#009999; font-family:Times New Roman; font-size:9pt;"  >INCLUDE<span style="color:black;"  >     <span style="color:#000099;"  >386<span style="color:black;"  >SCD<span style="color:red;"  >.<span style="color:blue;"  >INC<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >GDTSeg          <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>全局描述符表数据段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(16</span><span style="font-family:宋体;"  >位</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>全局描述符表</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >GDT             <span style="color:#009999;"  >LABEL<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>空描述符</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DUMMY           Desc    <span style="color:red;"  >&lt;&gt;<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>规范段描述符及选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Normal          Desc    <span style="color:red;"  >&lt;<span style="color:#000099;"  >0ffffh<span style="color:red;"  >,,,<span style="color:black;"  >ATDW<span style="color:red;"  >,,&gt;<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Normal_Sel      <span style="color:red;"  >=<span style="color:black;"  >       Normal<span style="color:red;"  >-<span style="color:black;"  >GDT </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>视频缓冲区段描述符</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(DPL=3)</span><span style="font-family:宋体;"  >及选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >VideoBuf        Desc    <span style="color:red;"  >&lt;<span style="color:#000099;"  >0ffffh<span style="color:red;"  >,<span style="color:#000099;"  >8000h<span style="color:red;"  >,<span style="color:#000099;"  >0bh<span style="color:red;"  >,<span style="color:black;"  >ATDW<span style="color:red;"  >+<span style="color:black;"  >DPL3<span style="color:red;"  >,,&gt;<span style="color:black;"  >               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Video_Sel       <span style="color:red;"  >=<span style="color:black;"  >       VideoBuf<span style="color:red;"  >-<span style="color:black;"  >GDT </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >EFFGDT          <span style="color:#009999;"  >LABEL<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>演示任务的局部描述符表段的描述符及选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoLDTab       Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoLDTLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoLDTSeg<span style="color:red;"  >,,<span style="color:black;"  >ATLDT<span style="color:red;"  >,,&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoLDT_Sel     <span style="color:red;"  >=<span style="color:black;"  >       DemoLDTab<span style="color:red;"  >-<span style="color:black;"  >GDT </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>演示任务的任务状态段描述符及选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoTSS         Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoTSSLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoTSSSeg<span style="color:red;"  >,,<span style="color:black;"  >AT386TSS<span style="color:red;"  >,,&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoTSS_Sel     <span style="color:red;"  >=<span style="color:black;"  >       DemoTSS<span style="color:red;"  >-<span style="color:black;"  >GDT </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>临时任务的任务状态段描述符及选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >TempTSS         Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >TempTSSLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >TempTSSSeg<span style="color:red;"  >,,<span style="color:black;"  >AT386TSS<span style="color:red;"  >+<span style="color:black;"  >DPL2<span style="color:red;"  >,,&gt;<span style="color:black;"  >               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >TempTSS_Sel     <span style="color:red;"  >=<span style="color:black;"  >       TempTSS<span style="color:red;"  >-<span style="color:black;"  >GDT </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>临时代码段描述符及选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >TempCode        Desc    <span style="color:red;"  >&lt;<span style="color:#000099;"  >0ffffh<span style="color:red;"  >,<span style="color:black;"  >TempCodeSeg<span style="color:red;"  >,,<span style="color:black;"  >ATCE<span style="color:red;"  >,,&gt;<span style="color:black;"  >           </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >TempCode_Sel    <span style="color:red;"  >=<span style="color:black;"  >       TempCode<span style="color:red;"  >-<span style="color:black;"  >GDT </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>子程序代码段描述符及选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >SubR            Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >SubRLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >SubRSeg<span style="color:red;"  >,,<span style="color:black;"  >ATCE<span style="color:red;"  >,<span style="color:black;"  >D32<span style="color:red;"  >,&gt;<span style="color:black;"  >               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >SubR_Sel        <span style="color:red;"  >=<span style="color:black;"  >       SubR<span style="color:red;"  >-<span style="color:black;"  >GDT </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >GDNum           <span style="color:red;"  >=<span style="color:black;"  >       <span style="color:red;"  >($-<span style="color:black;"  >EFFGDT<span style="color:red;"  >)/(<span style="color:#009999;"  >SIZE<span style="color:black;"  > Desc<span style="color:red;"  >)<span style="color:black;"  >              <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>需处理基地址的描述符个数</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >GDTLen          <span style="color:red;"  >=<span style="color:black;"  >       <span style="color:red;"  >$-<span style="color:black;"  >GDT                     <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>全局描述符表长度</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >GDTSeg          <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>全局描述符表段定义结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoLDTSeg      <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>局部描述符表数据段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(16</span><span style="font-family:宋体;"  >位</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoLDT         <span style="color:#009999;"  >LABEL<span style="color:black;"  >       <span style="color:#009999;"  >BYTE<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>局部描述符表</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;0</em></span></span><span style="font-family:宋体;"  ><em>级堆栈段描述符</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >及选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack0      Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoStack0Len<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoStack0Seg<span style="color:red;"  >,,<span style="color:black;"  >ATDW<span style="color:red;"  >,<span style="color:black;"  >D32<span style="color:red;"  >,&gt;<span style="color:black;"  >               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack0_Sel  <span style="color:red;"  >=<span style="color:black;"  >       DemoStack0<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;2</em></span></span><span style="font-family:宋体;"  ><em>级堆栈段描述符</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >及选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack2      Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoStack2Len<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoStack2Seg<span style="color:red;"  >,,<span style="color:black;"  >ATDW<span style="color:red;"  >+<span style="color:black;"  >DPL2<span style="color:red;"  >,<span style="color:black;"  >D32<span style="color:red;"  >,&gt;<span style="color:black;"  >                 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack2_Sel  <span style="color:red;"  >=<span style="color:black;"  >       DemoStack2<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL<span style="color:red;"  >+<span style="color:black;"  >RPL2 </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>演示任务代码段描述符</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span><span style="font-family:Times New Roman;"  >,DPL=2)</span><span style="font-family:宋体;"  >及选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoCode        Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoCodeLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoCodeSeg<span style="color:red;"  >,,<span style="color:black;"  >ATCE<span style="color:red;"  >+<span style="color:black;"  >DPL2<span style="color:red;"  >,<span style="color:black;"  >D32<span style="color:red;"  >,&gt;<span style="color:black;"  >                 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoCode_Sel    <span style="color:red;"  >=<span style="color:black;"  >       DemoCode<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL<span style="color:red;"  >+<span style="color:black;"  >RPL2 </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><em><span style="font-family:宋体;"  >演示任务数据段<span style="color:#999999;"  >描述符</span></span><span style="font-family:Times New Roman;"  >(32</span></em><span style="color:#999999;"  ><em><span style="font-family:宋体;"  >位段</span><span style="font-family:Times New Roman;"  >,DPL=3)</span><span style="font-family:宋体;"  >及选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoData        Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoDataLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoDataSeg<span style="color:red;"  >,,<span style="color:black;"  >ATDW<span style="color:red;"  >+<span style="color:black;"  >DPL3<span style="color:red;"  >,<span style="color:black;"  >D32<span style="color:red;"  >,&gt;<span style="color:black;"  >                 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoData_Sel    <span style="color:red;"  >=<span style="color:black;"  >       DemoData<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>把</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >作为普通数据段描述的描述符</span><span style="font-family:Times New Roman;"  >(DPL=2)</span><span style="font-family:宋体;"  >及选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToDLDT          Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >DemoLDTLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >DemoLDTSeg<span style="color:red;"  >,,<span style="color:black;"  >ATDW<span style="color:red;"  >+<span style="color:black;"  >DPL2<span style="color:red;"  >,,&gt;<span style="color:black;"  >               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToDLDT_Sel      <span style="color:red;"  >=<span style="color:black;"  >       ToDLDT<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>把</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >作为普通数据段描述的描述符</span><span style="font-family:Times New Roman;"  >(DPL=2)</span><span style="font-family:宋体;"  >及选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToTTSS          Desc    <span style="color:red;"  >&lt;<span style="color:black;"  >TempTSSLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,<span style="color:black;"  >TempTSSSeg<span style="color:red;"  >,,<span style="color:black;"  >ATDW<span style="color:red;"  >+<span style="color:black;"  >DPL2<span style="color:red;"  >,,&gt;<span style="color:black;"  >               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToTTSS_Sel      <span style="color:red;"  >=<span style="color:black;"  >       ToTTSS<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL </span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoLDNum       <span style="color:red;"  >=<span style="color:black;"  >       <span style="color:red;"  >($-<span style="color:black;"  >DemoLDT<span style="color:red;"  >)/(<span style="color:#009999;"  >SIZE<span style="color:black;"  > Desc<span style="color:red;"  >)<span style="color:black;"  >              <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>需处理基地址的</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >描述符数</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>指向子程序</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >SubRB</span><span style="font-family:宋体;"  >代码段的调用门</span><span style="font-family:Times New Roman;"  >(DPL=3)</span><span style="font-family:宋体;"  >及选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToSubR          Gate    <span style="color:red;"  >&lt;<span style="color:black;"  >SubRB<span style="color:red;"  >,<span style="color:black;"  >SubR_Sel<span style="color:red;"  >,,<span style="color:black;"  >AT386CGate<span style="color:red;"  >+<span style="color:black;"  >DPL3<span style="color:red;"  >,&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToSubR_Sel      <span style="color:red;"  >=<span style="color:black;"  >       ToSubR<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL<span style="color:red;"  >+<span style="color:black;"  >RPL2 </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>指向临时任务</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >Temp</span><span style="font-family:宋体;"  >的任务门</span><span style="font-family:Times New Roman;"  >(DPL=3)</span><span style="font-family:宋体;"  >及选择子</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToTempT         Gate    <span style="color:red;"  >&lt;,<span style="color:black;"  >TempTSS_Sel<span style="color:red;"  >,,<span style="color:black;"  >ATTaskGate<span style="color:red;"  >+<span style="color:black;"  >DPL3<span style="color:red;"  >,&gt;<span style="color:black;"  >           </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >ToTempT_Sel     <span style="color:red;"  >=<span style="color:black;"  >       ToTempT<span style="color:red;"  >-<span style="color:black;"  >DemoLDT<span style="color:red;"  >+<span style="color:black;"  >TIL </span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoLDTLen      <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$-<span style="color:black;"  >DemoLDT </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoLDTSeg      <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>局部描述符表段定<span style="color:#999999;"  >义结束</span></em></span><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoTSSSeg      <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>任务状态段</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>TSS</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DD<span style="color:black;"  >       <span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>链接字</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DD<span style="color:black;"  >      DemoStack0Len             <span style="color:#999999;"  ><em>;0</em></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈指针</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DW<span style="color:black;"  >      DemoStack0_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >          <span style="color:#999999;"  ><em>;0</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DD<span style="color:black;"  >       <span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;1</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈指针</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >实例不使用</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:#000099;"  >0<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >           <span style="color:#999999;"  ><em>;1</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈选择子</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >实例不使用</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DD<span style="color:black;"  >       <span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;2</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈指针</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:#000099;"  >0<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >           <span style="color:#999999;"  ><em>;2</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>级堆栈选择子</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;CR3</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DW<span style="color:black;"  >      DemoBegin<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;EIP</em><span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EFLAGS</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EAX</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;ECX</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EDX</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EBX</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      DemoStack2Len             <span style="color:#999999;"  ><em>;ESP</em><span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EBP</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >0<span style="color:black;"  >        <span style="color:#999999;"  ><em>;ESI</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DD<span style="color:black;"  >      <span style="color:#000099;"  >1986<span style="color:black;"  >        <span style="color:#999999;"  ><em>;EDI</em><span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DW<span style="color:black;"  >      Video_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;ES</em><span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DW<span style="color:black;"  >      DemoCode_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;CS</em><span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DW<span style="color:black;"  >      DemoStack2_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;SS</em><span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DW<span style="color:black;"  >      DemoData_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;DS</em><span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DW<span style="color:black;"  >      ToDLDT_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;FS</em><span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DW<span style="color:black;"  >      ToTTSS_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;GS</em><span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DW<span style="color:black;"  >      DemoLDT_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;LDTR</em><span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:#000099;"  >0<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>调试陷阱标志</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:red;"  >$+<span style="color:#000099;"  >2<span style="color:black;"  >          <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>指向</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >I/O</span><span style="font-family:宋体;"  >许可位图</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DB<span style="color:black;"  >       <span style="color:#000099;"  >0ffh<span style="color:black;"  >         <span style="color:#999999;"  ><em>;I/O</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>许可位图结束标志</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoTSSLen      <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoTSSSeg      <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>任务状态段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >结束</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoStack0Seg   <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE32<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>演示任务</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级堆栈段</span><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack0Len   <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:#000099;"  >1024<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DB<span style="color:black;"  >      DemoStack0Len <span style="color:#009999;"  >DUP<span style="color:red;"  >(<span style="color:#000099;"  >0<span style="color:red;"  >)<span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoStack0Seg   <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>演示任务</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级堆栈段结束</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoStack2Seg   <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE32<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>演示任务</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >级堆栈段</span><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoStack2Len   <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:#000099;"  >512<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >DB<span style="color:black;"  >      DemoStack2Len <span style="color:#009999;"  >DUP<span style="color:red;"  >(<span style="color:#000099;"  >0<span style="color:red;"  >)<span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoStack2Seg   <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>演示任务</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >级堆栈段结束</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoDataSeg     <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE32<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>演示任务数据段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位段</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Message         <span style="color:#009999;"  >DB<span style="color:black;"  >      <span style="color:#999900;"  >'Value='<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoDataLen     <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoDataSeg     <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>演示任务数据段结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >SubRSeg         <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE32<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>子程序代码段</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >(32</span><span style="font-family:宋体;"  >位</span></em><span style="font-family:Times New Roman;"  ><em>)</em><span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:SubRSeg </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >SubRB           <span style="color:#009999;"  >PROC<span style="color:black;"  >      <span style="color:#009999;"  >FAR<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >push<span style="color:black;"  >      <span style="color:fuchsia;"  >ebp<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ebp<span style="color:red;"  >,<span style="color:fuchsia;"  >esp<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >pushad<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>保护现场</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >esi<span style="color:red;"  >,<span style="color:#009999;"  >DWORD<span style="color:black;"  >           <span style="color:#009999;"  >PTR<span style="color:black;"  >             <span style="color:red;"  >[<span style="color:fuchsia;"  >ebp<span style="color:red;"  >+<span style="color:#000099;"  >12<span style="color:red;"  >]<span style="color:black;"  >                   <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>从</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级栈中取出显示串偏移</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ah<span style="color:red;"  >,<span style="color:#000099;"  >4ah<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>设置显示属性</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >jmp<span style="color:black;"  >      <span style="color:#009999;"  >SHORT<span style="color:black;"  > SubR2 </span></span></span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >SubR1:<span style="color:black;"  >     <span style="color:blue;"  >stosw<span style="color:black;"  >      </span></span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >SubR2:<span style="color:black;"  >     <span style="color:blue;"  >lodsb<span style="color:black;"  >      </span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >or<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:fuchsia;"  >al<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >jnz<span style="color:black;"  >     SubR1 </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ah<span style="color:red;"  >,<span style="color:#000099;"  >4eh<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>设置显示属性</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >edx<span style="color:red;"  >,<span style="color:#009999;"  >DWORD<span style="color:black;"  >           <span style="color:#009999;"  >PTR<span style="color:black;"  >             <span style="color:red;"  >[<span style="color:fuchsia;"  >ebp<span style="color:red;"  >+<span style="color:#000099;"  >16<span style="color:red;"  >]<span style="color:black;"  >                   <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>从</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级栈中取出显示值</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ecx<span style="color:red;"  >,<span style="color:#000099;"  >8<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >SubR3:<span style="color:black;"  >     <span style="color:blue;"  >rol<span style="color:black;"  >       <span style="color:fuchsia;"  >edx<span style="color:red;"  >,<span style="color:#000099;"  >4<span style="color:black;"  >          </span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:fuchsia;"  >dl<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >call<span style="color:black;"  >    HToASCII </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >stosw<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >loop<span style="color:black;"  >    SubR3 </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >popad<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >pop<span style="color:black;"  >      <span style="color:fuchsia;"  >ebp<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >ret<span style="color:black;"  >      <span style="color:#000099;"  >8<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >SubRB           <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >HToASCII        <span style="color:#009999;"  >PROC<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >and<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >0fh<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >add<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >90h<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >daa<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >adc<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >40h<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >daa<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >ret<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >HToASCII        <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >SubRLen         <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >SubRSeg         <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>子程序代码段结束</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoCodeSeg     <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE32<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>演示任务的</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位代码段</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:DemoCodeSeg<span style="color:red;"  >,<span style="color:fuchsia;"  >DS<span style="color:black;"  >:DemoDataSeg </span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoBegin       <span style="color:#009999;"  >PROC<span style="color:black;"  >      <span style="color:#009999;"  >FAR<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>把要复制的参数个数置入调用门</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:fuchsia;"  >fs<span style="color:black;"  >:ToSubR<span style="color:red;"  >.<span style="color:black;"  >DCount<span style="color:red;"  >,<span style="color:#000099;"  >2<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>向</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >级堆栈中压入参数</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >push<span style="color:black;"  >      <span style="color:#009999;"  >DWORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:fuchsia;"  >gs<span style="color:black;"  >:TempTask<span style="color:red;"  >.<span style="color:black;"  >TREIP </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >push<span style="color:black;"  >      <span style="color:#009999;"  >OFFSET<span style="color:black;"  > Message </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>通过调用门调用</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>SubRB</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >CALL32<span style="color:black;"  >  ToSubR_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >        </span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>把指向规范数据段描述符的选择子填入临时任务</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>TSS</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >DS<span style="color:black;"  >:TempTSSSeg </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >push<span style="color:black;"  >      <span style="color:fuchsia;"  >gs<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >pop<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >Normal_Sel </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  > TempTask<span style="color:red;"  >.<span style="color:black;"  >TRDS<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >              </span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  > TempTask<span style="color:red;"  >.<span style="color:black;"  >TRES<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >              </span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  > TempTask<span style="color:red;"  >.<span style="color:black;"  >TRFS<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >              </span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  > TempTask<span style="color:red;"  >.<span style="color:black;"  >TRGS<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >              </span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  > TempTask<span style="color:red;"  >.<span style="color:black;"  >TRSS<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >              </span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#999999;"  ><em>;</em></span></span><span style="font-family:宋体;"  ><em>通过任务门切换到临时任务</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >JUMP32<span style="color:black;"  >  ToTempT_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >        </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >jmp<span style="color:black;"  >     DemoBegin </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoBegin       <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >DemoCodeLen     <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >DemoCodeSeg     <span style="color:#009999;"  >ENDS<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>演示任务的</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >32</span><span style="font-family:宋体;"  >位代码段结束</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >TempTSSSeg      <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>临时任务的任务状态段</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>TSS</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >TempTask        TSS     <span style="color:red;"  >&lt;&gt;<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009999;"  >DB<span style="color:black;"  >       <span style="color:#000099;"  >0ffh<span style="color:black;"  >         <span style="color:#999999;"  ><em>;I/O</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>许可位图结束标志</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >TempTSSLen      <span style="color:red;"  >=<span style="color:black;"  >      <span style="color:red;"  >$<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >TempTSSSeg      <span style="color:#009999;"  >ENDS<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >TempCodeSeg     <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>临时任务的代码段</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:TempCodeSeg </span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Virtual         <span style="color:#009999;"  >PROC<span style="color:black;"  >      <span style="color:#009999;"  >FAR<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >TempTSS_Sel            <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>装载</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>TR</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >ltr<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:#009900;"  >JUMP16<span style="color:black;"  >  DemoTSS_Sel<span style="color:red;"  >,<span style="color:#000099;"  >0<span style="color:black;"  >          <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>直<span style="color:#999999;"  >接切换到演示任务</span></em></span><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >clts<span style="color:black;"  >       <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>清任务切换标志</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:fuchsia;"  >cr0<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>准备返回实模式</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >and<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >11111110b<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >cr0<span style="color:red;"  >,<span style="color:fuchsia;"  >eax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >JUMP16<span style="color:black;"  >      <span style="color:red;"  >&lt;<span style="color:#009999;"  >SEG<span style="color:black;"  > Real<span style="color:red;"  >&gt;,&lt;<span style="color:#009999;"  >OFFSET<span style="color:black;"  > Real<span style="color:red;"  >&gt;<span style="color:black;"  >             </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Virtual         <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >TempCodeSeg     <span style="color:#009999;"  >ENDS<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;============================================================================</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >RDataSeg        <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >       <span style="color:#009999;"  >PARA<span style="color:black;"  >         <span style="color:#009999;"  >USE16<span style="color:black;"  >           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>实方式数据段</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >VGDTR           PDesc   <span style="color:red;"  >&lt;<span style="color:black;"  >GDTLen<span style="color:red;"  >-<span style="color:#000099;"  >1<span style="color:red;"  >,&gt;<span style="color:black;"  >           <span style="color:#999999;"  ><em>;GDT</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>伪描述符</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >SPVar           <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:red;"  >?<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>用于保存实方式下的</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>SP</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >SSVar           <span style="color:#009999;"  >DW<span style="color:black;"  >       <span style="color:red;"  >?<span style="color:black;"  >         <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>用于保存实方式下的</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>SS</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >RDataSeg        <span style="color:#009999;"  >ENDS<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >RCodeSeg        <span style="color:#009999;"  >SEGMENT<span style="color:black;"  >      <span style="color:#009999;"  >PARA<span style="color:black;"  >        <span style="color:#009999;"  >USE16<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >ASSUME<span style="color:black;"  >      <span style="color:fuchsia;"  >CS<span style="color:black;"  >:RCodeSeg<span style="color:red;"  >,<span style="color:fuchsia;"  >DS<span style="color:black;"  >:RDataSeg<span style="color:red;"  >,<span style="color:fuchsia;"  >ES<span style="color:black;"  >:RDataSeg </span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Start           <span style="color:#009999;"  >PROC<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >RDataSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >cld<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >call<span style="color:black;"  >    InitGDT                   <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>初始化全局描述符表</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>GDT</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >DemoLDTSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >fs<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >OFFSET<span style="color:black;"  > DemoLDT </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >cx<span style="color:red;"  >,<span style="color:black;"  >DemoLDNum </span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >call<span style="color:black;"  >    InitLDT                   <span style="color:#999999;"  ><em>;</em></span></span></span></span><span style="font-family:宋体;"  ><em>初始化局部描述符表</em></span><span style="color:#999999; font-family:Times New Roman;"  ><em>LDT</em><span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >     SSVar<span style="color:red;"  >,<span style="color:fuchsia;"  >ss<span style="color:black;"  >        </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >     SPVar<span style="color:red;"  >,<span style="color:fuchsia;"  >sp<span style="color:black;"  >        </span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >lgdt<span style="color:black;"  >       <span style="color:#009999;"  >QWORD<span style="color:black;"  >         <span style="color:#009999;"  >PTR<span style="color:black;"  > VGDTR           <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>装载</em></span><span style="color:#999999;"  ><em><span style="font-family:Times New Roman;"  >GDTR</span><span style="font-family:宋体;"  >并切换到保护方式</span></em><span style="color:black; font-family:Times New Roman;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >cli<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:fuchsia;"  >cr0<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >or<span style="color:black;"  >      <span style="color:fuchsia;"  >al<span style="color:red;"  >,<span style="color:#000099;"  >1<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >cr0<span style="color:red;"  >,<span style="color:fuchsia;"  >eax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009900;"  >JUMP16<span style="color:black;"  >      <span style="color:red;"  >&lt;<span style="color:black;"  >TempCode_Sel<span style="color:red;"  >&gt;,&lt;<span style="color:#009999;"  >OFFSET<span style="color:black;"  > Virtual<span style="color:red;"  >&gt;<span style="color:black;"  >            </span></span></span></span></span></span></span></span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >Real:<span style="color:black;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >RDataSeg </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:Times New Roman;"  >     <span style="color:blue;"  >lss<span style="color:black;"  >       <span style="color:fuchsia;"  >sp<span style="color:red;"  >,<span style="color:#009999;"  >DWORD<span style="color:black;"  >           <span style="color:#009999;"  >PTR<span style="color:black;"  > SPVar        <span style="color:#999999;"  ><em>;</em></span></span></span></span></span></span></span></span></span></span><span style="font-family:宋体;"  ><em>又回到实方式</em></span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >sti<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:#000099;"  >4c00h<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >int<span style="color:black;"  >      <span style="color:#000099;"  >21h<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >Start           <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >InitGDT         <span style="color:#009999;"  >PROC<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >push<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >GDTSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >cx<span style="color:red;"  >,<span style="color:black;"  >GDNum </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >OFFSET<span style="color:black;"  > EFFGDT </span></span></span></span></span></span></span></p><p><span style="color:#990000; font-family:Times New Roman; font-size:9pt;"  >InitG:<span style="color:black;"  >     <span style="color:blue;"  >mov<span style="color:black;"  >       <span style="color:fuchsia;"  >ax<span style="color:red;"  >,[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseL </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >movzx<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >shl<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:#000099;"  >4<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >shld<span style="color:black;"  >      <span style="color:fuchsia;"  >edx<span style="color:red;"  >,<span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:#000099;"  >16<span style="color:black;"  >           </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseL<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseM<span style="color:red;"  >,<span style="color:fuchsia;"  >dl<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseH<span style="color:red;"  >,<span style="color:fuchsia;"  >dh<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >add<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >SIZE<span style="color:black;"  > Desc </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >loop<span style="color:black;"  >    InitG </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >pop<span style="color:black;"  >      <span style="color:fuchsia;"  >ds<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >bx<span style="color:red;"  >,<span style="color:#000099;"  >16<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:black;"  >GDTSeg </span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mul<span style="color:black;"  >      <span style="color:fuchsia;"  >bx<span style="color:black;"  >       </span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  > VGDTR<span style="color:red;"  >.<span style="color:black;"  >Base<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >              </span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  > VGDTR<span style="color:red;"  >.<span style="color:black;"  >Base<span style="color:red;"  >+<span style="color:#000099;"  >2<span style="color:red;"  >,<span style="color:fuchsia;"  >dx<span style="color:black;"  >                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >ret<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >InitGDT         <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:#999999; font-size:9pt;"  ><em><span style="font-family:Times New Roman;"  >;</span><span style="font-family:宋体;"  >入口参数</span><span style="font-family:Times New Roman;"  >:FS:SI=</span><span style="font-family:宋体;"  >第一个要初始化的描述符</span><span style="font-family:Times New Roman;"  >,CX=</span><span style="font-family:宋体;"  >要初始化的描述符数</span></em><span style="color:black; font-family:Times New Roman;"  >    </span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >InitLDT         <span style="color:#009999;"  >PROC<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:fuchsia;"  >ax<span style="color:red;"  >,<span style="color:#009999;"  >WORD<span style="color:black;"  >          <span style="color:#009999;"  >PTR<span style="color:black;"  >            <span style="color:fuchsia;"  >fs<span style="color:black;"  >:<span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseL </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >movzx<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >shl<span style="color:black;"  >      <span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:#000099;"  >4<span style="color:black;"  >         </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >shld<span style="color:black;"  >      <span style="color:fuchsia;"  >edx<span style="color:red;"  >,<span style="color:fuchsia;"  >eax<span style="color:red;"  >,<span style="color:#000099;"  >16<span style="color:black;"  >           </span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >WORD<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:fuchsia;"  >fs<span style="color:black;"  >:<span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseL<span style="color:red;"  >,<span style="color:fuchsia;"  >ax<span style="color:black;"  >                  </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:fuchsia;"  >fs<span style="color:black;"  >:<span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseM<span style="color:red;"  >,<span style="color:fuchsia;"  >dl<span style="color:black;"  >                  </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >mov<span style="color:black;"  >      <span style="color:#009999;"  >BYTE<span style="color:black;"  >        <span style="color:#009999;"  >PTR<span style="color:black;"  >          <span style="color:fuchsia;"  >fs<span style="color:black;"  >:<span style="color:red;"  >[<span style="color:fuchsia;"  >si<span style="color:red;"  >].<span style="color:black;"  >BaseH<span style="color:red;"  >,<span style="color:fuchsia;"  >dh<span style="color:black;"  >                  </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >add<span style="color:black;"  >      <span style="color:fuchsia;"  >si<span style="color:red;"  >,<span style="color:#009999;"  >SIZE<span style="color:black;"  > Desc </span></span></span></span></span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >loop<span style="color:black;"  >    InitLDT </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:blue;"  >ret<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >InitLDT         <span style="color:#009999;"  >ENDP<span style="color:black;"  >     </span></span></span></p><p><span style="color:#999999; font-family:Times New Roman; font-size:9pt;"  ><em>;----------------------------------------------------------------------------</em><span style="color:black;"  >    </span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >RCodeSeg        <span style="color:#009999;"  >ENDS<span style="color:black;"  >     </span></span></span></p><p><span style="color:black; font-family:Times New Roman; font-size:9pt;"  >    <span style="color:#009999;"  >END<span style="color:black;"  >     Start </span></span></span></p><p><span style="color:red; font-family:Batang; font-size:13pt;"  ><strong>3.关于实例五的说明 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >程序中部分片段的背景和实现方法在前面的实例中做过介绍，下面主要就任务切换和通过调用门</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >实现任务内特权级变换时参数的复制等情形做些说明：</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(1)从临时任务直接通过TSS切换到演示任务 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >从实模式切换到保护模式后，就认为进入了临时任务。但</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >并没有指向临时任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >。在从临</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >时任务切换到演示任务时，要把临时任务的现场保存到临时任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >，这就要求</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >指向临时任</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >。所以首先要使用</span><span style="font-family:Times New Roman;"  >LTR</span><span style="font-family:宋体;"  >指令把指向临时任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >描述符的选择子装入</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >。在利用</span><span style="font-family:Times New Roman;"  >LTR</span><span style="font-family:宋体;"  >指令显</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >示地装载</span><span style="font-family:Times New Roman;"  >TR</span><span style="font-family:宋体;"  >时，并不引用</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >的内容，所以临时任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >几乎没有初始化。理由是这不是真正的</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >任务切换。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >临时任务采用段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >，直接指向演示任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >，切换到演示任务。在执行切换到演示</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >任务的段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >时，</span><span style="font-family:Times New Roman;"  >CPL=0</span><span style="font-family:宋体;"  >，</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >指令中所含选择子内的</span><span style="font-family:Times New Roman;"  >RPL=0</span><span style="font-family:宋体;"  >，演示任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >的描述符特</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >权级</span><span style="font-family:Times New Roman;"  >DPL=0</span><span style="font-family:宋体;"  >，并且是一个可用的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >，所以顺利进行从临时任务到演示任务的切换。切换过程包</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >括：把临时任务的执行现场保存到临时任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中；从演示任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中恢复演示任务的现场；</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >把演示任务的</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >描述符选择子装载到</span><span style="font-family:Times New Roman;"  >LDTR</span><span style="font-family:宋体;"  >等。从源程序可见，初始化后的演示任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >字</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >段存放的选择子是</span><span style="font-family:Times New Roman;"  >DemoCode_Sel</span><span style="font-family:宋体;"  >，对应的描述符在演示任务的</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >中，并且</span><span style="font-family:Times New Roman;"  >DPL=2</span><span style="font-family:宋体;"  >，它描述了代码</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >段</span><span style="font-family:Times New Roman;"  >DemoCode</span><span style="font-family:宋体;"  >；挂起点是</span><span style="font-family:Times New Roman;"  >DemoBegin</span><span style="font-family:宋体;"  >，所以在切换到演示任务后从该点开始执行，并且</span><span style="font-family:Times New Roman;"  >CPL=2</span><span style="font-family:宋体;"  >。由于</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >使用</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >指令进行任务切换，所以不实施任务链接。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(2)从演示任务通过任务门切换到临时任务 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >演示任务采用段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >，通过任务门</span><span style="font-family:Times New Roman;"  >ToTempT</span><span style="font-family:宋体;"  >切换到临时任务。在执行切换到临时任务的</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >段间转移指令</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >时，</span><span style="font-family:Times New Roman;"  >CPL=2</span><span style="font-family:宋体;"  >，</span><span style="font-family:Times New Roman;"  >JMP</span><span style="font-family:宋体;"  >指令中所含选择子</span><span style="font-family:Times New Roman;"  >ToTempT_Sel</span><span style="font-family:宋体;"  >内的</span><span style="font-family:Times New Roman;"  >RPL=0</span><span style="font-family:宋体;"  >，它指示的任务门的</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >描述符特权级</span><span style="font-family:Times New Roman;"  >DPL=3</span><span style="font-family:宋体;"  >，所以可以访问该任务门。任务门内的选择子</span><span style="font-family:Times New Roman;"  >TempTSS_Sel</span><span style="font-family:宋体;"  >指示临时任务</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >，并且此时的临时任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >是可用的，所以可顺利进行任务切换。演示任务的现场保存到演</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >示任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >；临时任务的现场从临时任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >恢复。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >临时任务的挂起点是临时任务代码段的</span><span style="font-family:Times New Roman;"  >ToRela</span><span style="font-family:宋体;"  >点，所以恢复后的临时任务从该点开始，</span><span style="font-family:Times New Roman;"  >CS</span><span style="font-family:宋体;"  >含临时</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >任务代码段的选择子。但由于在演示任务内</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >强硬</span><span style="font-family:Times New Roman;"  >"</span><span style="font-family:宋体;"  >地改变了临时任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >内的</span><span style="font-family:Times New Roman;"  >SS</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >DS</span><span style="font-family:宋体;"  >等字段，</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >所以在恢复到临时任务时，</span><span style="font-family:Times New Roman;"  >SS</span><span style="font-family:宋体;"  >和</span><span style="font-family:Times New Roman;"  >DS</span><span style="font-family:宋体;"  >等段寄存器内已含有规范数据段的选择子，而非挂起时的原有</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >值。注意，这种做法不被提倡，但在这里却充分地展示了如何从</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >恢复任务。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(3)演示任务内的特权级变换和堆栈传递参数 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >演示任务采用段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >，通过调用门</span><span style="font-family:Times New Roman;"  >ToSubR</span><span style="font-family:宋体;"  >调用子程序</span><span style="font-family:Times New Roman;"  >SubRB</span><span style="font-family:宋体;"  >。执行段间调用指令</span><span style="font-family:Times New Roman;"  >CALL</span><span style="font-family:宋体;"  >时</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的</span><span style="font-family:Times New Roman;"  >CPL=2</span><span style="font-family:宋体;"  >，指令所含指向调用门的选择子的</span><span style="font-family:Times New Roman;"  >RPL=2</span><span style="font-family:宋体;"  >，调用门的</span><span style="font-family:Times New Roman;"  >DPL=3</span><span style="font-family:宋体;"  >，所以对调用门的访问是允许</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的；尽管调用门内的选择子的</span><span style="font-family:Times New Roman;"  >RPL=3</span><span style="font-family:宋体;"  >，但由于它所指示的子程序代码段描述符的</span><span style="font-family:Times New Roman;"  >DPL=0</span><span style="font-family:宋体;"  >，所以在调</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >用过程中就发生了从特权级</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >到特权级</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >的变换，同时堆栈也被切换。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >演示代码段通过堆栈传递了两个参数给子程序</span><span style="font-family:Times New Roman;"  >SubRB</span><span style="font-family:宋体;"  >。在把参数压入堆栈时，</span><span style="font-family:Times New Roman;"  >CPL=2</span><span style="font-family:宋体;"  >，使用的也是</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >对应特权级</span><span style="font-family:Times New Roman;"  >2 </span><span style="font-family:宋体;"  >的堆栈。通过调用门进入子程序后，</span><span style="font-family:Times New Roman;"  >CPL=0</span><span style="font-family:宋体;"  >，使用</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级堆栈。为此，把调用门</span><span style="font-family:Times New Roman;"  >ToSubR</span><span style="font-family:宋体;"  >中</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >的</span><span style="font-family:Times New Roman;"  >DCount</span><span style="font-family:宋体;"  >字段设置为</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >，表示在特权级向内层变换时，需从外层堆栈依次复制</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >各个双字参数到内层</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >堆栈。随着特权级变换，堆栈也跟着变换。这种在堆栈切换的同时复制所需参数的做法，保证了子</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >程序方便地访问堆栈中的参数，而无需考虑是哪个堆栈。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >随着从子程序</span><span style="font-family:Times New Roman;"  >SubRB</span><span style="font-family:宋体;"  >的返回，</span><span style="font-family:Times New Roman;"  >CPL=0</span><span style="font-family:宋体;"  >变换为</span><span style="font-family:Times New Roman;"  >CPL=2</span><span style="font-family:宋体;"  >，堆栈也回到</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >级堆栈。由于再次进入</span><span style="font-family:Times New Roman;"  >0</span><span style="font-family:宋体;"  >级堆栈，总</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >是从空开始，所以在返回前不是非要保持内层堆栈平衡不可。但</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >级堆栈中的</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >个双字参数需要废</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >除。从源程序可见，这是采用带立即数的段间返回指令实现的，在返回的同时，自动废除外层堆栈</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >中的参数，同时也废除了内层堆栈中的参数。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:fuchsia; font-family:Batang; font-size:12pt;"  ><strong>(4)别名技术的应用 </strong></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >关于别名技术，前文已经作过介绍。实例五也有两处应用了别名技术。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >为了把调用门</span><span style="font-family:Times New Roman;"  >ToSubR</span><span style="font-family:宋体;"  >中的</span><span style="font-family:Times New Roman;"  >DCount</span><span style="font-family:宋体;"  >字段设置成</span><span style="font-family:Times New Roman;"  >2</span><span style="font-family:宋体;"  >，使用一个数据段描述符</span><span style="font-family:Times New Roman;"  >ToDLDT</span><span style="font-family:宋体;"  >描述调用门所在演示</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >任务的</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >段，该描述符把演示任务的</span><span style="font-family:Times New Roman;"  >LDT</span><span style="font-family:宋体;"  >段描述成数据段。</span><span style="font-family:Times New Roman;"  >    </span></span></p><p><span style="color:black; font-size:9pt;"  ><span style="font-family:宋体;"  >还有一处是把临时任务的</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >视为普通数据段。从演示任务切换到临时任务之前，把指向描述规范</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >数据段的描述符</span><span style="font-family:Times New Roman;"  >Normal</span><span style="font-family:宋体;"  >的选择子</span><span style="font-family:Times New Roman;"  >Normal_Sel</span><span style="font-family:宋体;"  >填到临时任务</span><span style="font-family:Times New Roman;"  >TSS</span><span style="font-family:宋体;"  >中的各数据段寄存器</span><span style="font-family:Times New Roman;"  >(</span><span style="font-family:宋体;"  >包括堆栈段寄</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >存器</span><span style="font-family:Times New Roman;"  >)</span><span style="font-family:宋体;"  >字段，于是在切换到临时任务时，作为恢复临时任务的现场，该选择子就被装到</span><span style="font-family:Times New Roman;"  >DS</span><span style="font-family:宋体;"  >等数据段</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >寄存器，对应的描述符</span><span style="font-family:Times New Roman;"  >Normal</span><span style="font-family:宋体;"  >内的信息也就被装入到对应的高速缓冲寄存器中，达到为从临时任</span><span style="font-family:Times New Roman;"  >    </span><span style="font-family:宋体;"  >务切换到实模式作准备的目的。</span></span></p>
</body></html>