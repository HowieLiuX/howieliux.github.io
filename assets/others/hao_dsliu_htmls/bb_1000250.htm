<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：Understanding The COM Single-Threaded Apartment （2）</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>Understanding The COM Single-Threaded Apartment （2）</h2>
<p align="right">发布时间：2011-3-12 12:05
<br>分类名称：COM</p><br>
<p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Note  point 3 in the diagram: "The creation call is marshaled by COM into the  Legacy STA". In order for the creation call to be successful, COM has  to communicate with the Legacy STA and tell it to create </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >spILegacyCOMObject1A</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >. This communication requires a <b>message loop</b> to exist in the target Legacy STA. Hence the need for the services of </span><span style="font-size: 12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >ThreadMsgWaitForSingleObject()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >.</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-outline-level: 2;background:white;"   align="left"   ><a name="EXE_COM_SERVERS_AND_APARTMENTS" rel="nofollow"   ></a><b><span style="font-size:14.0pt;mso-bidi-font-size:13.0pt;"   lang="EN-US"   >EXE COM Servers And Apartments</span></b></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Thus  far, we have discussed COM servers implemented inside DLLs. However,  this article will not be complete without touching on COM servers  implemented in EXEs. My aim is to show how Apartments, the STA in  particular, are implemented inside an EXE server. Let us start with  examining two of the main differences between a DLL server and an EXE  server.</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-outline-level: 3;background:white;"   align="left"   ><b><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >Difference 1: The Way Objects Are Created</span></b></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >When COM wishes to create a COM object which is implemented inside a DLL, it loads the DLL, connects with its exported </span><span style="font-size: 12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >DllGetClassObject()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > function, calls it, and obtains a pointer to the </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IClassFactory</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > interface of the class factory object of the COM object. It is from this </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IClassFactory</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > interface pointer that the COM object is created.</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >The story with EXE Servers has the same eventuality: obtaining the </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IClassFactory</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >  interface pointer of the class factory object of the COM object to be  created and then creating the COM object through it. What happens before  that is the difference between a DLL server and an EXE Server.</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >A DLL server exports the </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >DllGetClassObject()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > function for COM to extract the class factory but an EXE server cannot export any function. An EXE server instead has to <i>register</i> its class factory in the COM sub-system when it starts up, and then <i>revoke</i> the class factory when it shuts down. This registration is done via the API </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CoRegisterClassObject()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >.</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-outline-level: 3;background:white;"   align="left"   ><b><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >Difference 2: The Way The Apartment Model Of Objects Are Indicated</span></b></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >As mentioned earlier in this article, objects implemented in DLLs indicate their Apartment Models by appropriately setting the <b>"ThreadingModel"</b> registry string value which is located in the object's <b>"InProcServer32"</b> registry entry.</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Objects  implemented in an EXE server do not set this registry value. Instead,  the Apartment Model of the thread which registers the object's class  factory determines the object's Apartment Model:</span></p>  <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>::CoInitializeEx(NULL, COINIT_APARTMENTTHREADED);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>...</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>...</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>...</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>IUnknown* pIUnknown = NULL;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>DWORD dwCookie = <span style="color:navy;"   >0</span>;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>pCExeObj02_Factory -<span style="color:blue;"   >&gt;</span> QueryInterface(IID_IUnknown, (<span style="color:blue;"   >void</span>**)&amp;pIUnknown);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue;"   >if</span> (pIUnknown)</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>hr = ::CoRegisterClassObject</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>(</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>CLSID_ExeObj02,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>pIUnknown,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>CLSCTX_LOCAL_SERVER,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>REGCLS_MULTIPLEUSE | REGCLS_SUSPENDED,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&amp;dwCookie</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>pIUnknown -<span style="color:blue;"   >&gt;</span> Release();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>pIUnknown = NULL;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>  </div>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >In the above code snippet, we are attempting to register a class factory for the </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > COM object inside a thread. Note the call to </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >::CoInitializeEx(NULL, COINIT_APARTMENTTHREADED)</span><span style="mso-bidi-font-size: 10.0pt;"   lang="EN-US"   > at the beginning. This call indicates to COM that </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > COM objects will live in an STA. The thread which called </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CoRegisterClassObject()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >  is the lone thread inside this STA. This implies that there will be a  message loop inside this thread and that all access to any </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > object created by any client are serialized by this message loop.</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >If the call to </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >CoInitializeEx()</span><span style="mso-bidi-font-size: 10.0pt;"   lang="EN-US"   > used </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >COINIT_MULTITHREADED</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > instead, </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size: 10.0pt;"   lang="EN-US"   > COM objects will live in an MTA. This means that </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size: 10.0pt;"   lang="EN-US"   >  COM objects and its class factory object can be accessed from any  thread. Such threads can be those which are implemented internally in  the EXE Server (as part of the logic of the implementation) or those  from the RPC thread pool the purpose of which is to serve external  clients' method calls. The implementation of the </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >  COM object must therefore ensure internal serialization to whatever  extent required. In many ways, this is much more efficient as compared  with STAs.</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Aside  from the above two differences, take note that while it is possible  that STA objects inside a DLL server receive method calls only from  inside its owning STA thread, all method calls from a client to an STA  object inside an EXE COM server will invariably be invoked from an  external thread. This implies the use of marshalling proxies and stubs  and, of course, a message loop inside the object's owning STA thread.</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-outline-level: 3;background:white;"   align="left"   ><b><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >Demonstrating The STA Inside A COM EXE Server</span></b></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >As  usual, we shall attempt to demonstrate STAs inside COM EXE Servers via  an example code. The example code for this section is rather elaborate.  It can be found in the following folder: "<i>Test Programs\VCTests\DemonstrateExeServerSTA</i>" in the sample code that accompanies this article. There are three parts to this set of sample code:</span></p>  <ol start="1"   type="1"   ><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l1 level1 lfo1;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Interface      ("<i>Interface\ExeServerInterfaces</i>" subfolder). </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l1 level1 lfo1;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Implementation      ("<i>Implementation\ExeServerImpl</i>" subfolder). </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l1 level1 lfo1;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Client      ("<i>Client\VCTest01</i>" subfolder). </span></li></ol>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Please note that in order to use the </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >ExeServerImpl</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > COM server, you will need to compile code in "<i>Implementation\ExeServerImpl</i>" and then register the resultant <i>ExeServerImpl.exe</i> by typing the following command in a command prompt window:</span></p>  <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >ExeServerImpl RegServer</span></p>  </div>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Do not type any <b>"-"</b> or <b>"\"</b> before <b>"RegServer"</b>.</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-outline-level: 3;background:white;"   align="left"   ><b><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >The Interface</span></b></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >The code in the Interface part is actually an ATL project ("<i>ExeServerInterfaces.dsw</i>") which I use to define three interfaces: </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >, </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > and </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IExeObj03</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >. The three interfaces each contain only one single method (of the same name): </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >. This ATL project also specifies three coclasses which are identified by </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > (specified to contain an implementation of interface </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >), </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > (specified to contain an implementation of interface </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >) and </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj03</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > (specified to contain an implementation of interface </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IExeObj03</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >).</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >There  is no meaningful implementation of these interfaces and coclass's in  this project. I created this project in order to use the ATL wizards to  help me manage the IDL file and to automatically generate the  appropriate "<i>ExeServerInterfaces.h</i>" and "<i>ExeServerInterfaces_i.c</i>" files. These generated files are used by both the Implementation and Client code.</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >I  used a separate ATL project to generate the above-mentioned files  because I wanted my implementation code to be non-ATL based. I wanted a  COM EXE implementation based on a simple Windows application so that I  could put in various customized constructs that can help me illustrate  STAs clearer. With the ATL wizards, things <i>can</i> be a little more inflexible.</span></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-outline-level: 3;background:white;"   align="left"   ><b><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >The Implementation</span></b></p>  <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >The  code in the Implementation part provides an implementation of the  interfaces and coclass's described in the Interface part. Except for </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >, each of the implementation of </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > contains only a message box display:</span></p>  <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >STDMETHODIMP CExeObj01::TestMethod1()</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>TCHAR szMessage[<span style="color:navy;"   >256</span>];</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>sprintf (szMessage, <span style="color:purple;"   >"0x%X"</span>, GetCurrentThreadId());</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::MessageBox(NULL, szMessage, <span style="color:purple;"   >"CExeObj01::TestMethod1()"</span>, MB_OK);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >return</span> S_OK;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >}</span></p>  </div>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;background:white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >&nbsp;</span></p>  <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >STDMETHODIMP CExeObj03::TestMethod1()</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>TCHAR szMessage[<span style="color:navy;"   >256</span>];</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>sprintf (szMessage, <span style="color:purple;"   >"0x%X"</span>, GetCurrentThreadId());</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::MessageBox(NULL, szMessage, <span style="color:purple;"   >"CExeObj03::TestMethod1()"</span>, MB_OK);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >return</span> S_OK;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >}</span></p>  </div><br><p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >The  purpose of doing this is to show the ID of the thread which is  executing when each of the methods is invoked. This should match with  the ID of their containing STA thread. I have made </span><span style="font-size: 12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > a little special. This C++ class provides an implementation of </span><span style="font-size: 12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >. It also contains a pointer to an </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > object:</span></p>   <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >class</span><span style="font-size:10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   > CExeObj02 : <span style="color:blue;"   >public</span> CReferenceCountedObject, <span style="color:blue;"   >public</span> IExeObj02</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >public</span> :</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CExeObj02();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>~CExeObj02();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>...</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>...</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>...</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >protected</span> :</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>IExeObj01* m_pIExeObj01;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >};</span></p>  </div>   <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >During the construction of </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >CExeObj02</span><span style="mso-bidi-font-size: 10.0pt;"   lang="EN-US"   >, we will instantiate </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >m_pIExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >:</span></p>   <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >CExeObj02::CExeObj02()</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoCreateInstance</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>(</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSID_ExeObj01,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>NULL,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSCTX_LOCAL_SERVER,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>IID_IExeObj01,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>(LPVOID*)&amp;m_pIExeObj01 </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >}</span></p>  </div>   <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >The purpose of doing this is to show later that </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > and the object behind </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >m_pIExeObj01</span><span style="mso-bidi-font-size: 10.0pt;"   lang="EN-US"   > will run in separate STAs. Take a look at this class' </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > implementation:</span></p>   <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >STDMETHODIMP CExeObj02::TestMethod1()</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>TCHAR szMessage[<span style="color:navy;"   >256</span>];</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>sprintf (szMessage, <span style="color:purple;"   >"0x%X"</span>, GetCurrentThreadId());</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::MessageBox(NULL, szMessage, <span style="color:purple;"   >"CExeObj02::TestMethod1()"</span>, MB_OK);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >return</span> m_pIExeObj01 -<span style="color:blue;"   >&gt;</span> TestMethod1();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >}</span></p>  </div>   <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Two message boxes will be displayed: the first one showing </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >'s thread ID and the second will show </span><span style="font-size: 12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >m_pIExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >'s thread ID. These IDs will be different as will be seen later on when we run the client code.</span></p>   <p style="text-align: left; line-height: 14.4pt; background: none repeat scroll 0% 0% white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >In  addition to providing implementations to the interfaces, the  implementation code also provide class factories for each of the  coclass's. These are </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj01_Factory</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >, </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj2_Factory</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > and </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj03_Factory</span><span style=""   lang="EN-US"   >.</span></p><p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Let us now focus our attention on the </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >WinMain()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > function:</span></p>    <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >int</span><span style="font-size:10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   > APIENTRY WinMain</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >(</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>HINSTANCE hInstance,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>HINSTANCE hPrevInstance,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>LPSTR<span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp; </span>lpCmdLine,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >int</span><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>nCmdShow</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >)</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span>MSG<span style="mso-spacerun:yes;"   >&nbsp; </span>msg;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span>HRESULT hr = S_OK;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span><span style="color:blue;"   >bool</span><span style="mso-spacerun:yes;"   >&nbsp; </span>bRun = <span style="color:blue;"   >true</span>;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span>DisplayCurrentThreadId();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span>hr = ::CoInitializeEx(NULL, COINIT_APARTMENTTHREADED);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span>...</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span>...</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span>...</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span><span style="color:blue;"   >if</span> (bRun)</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span>{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>DWORD dwCookie_ExeObj01 = <span style="color:navy;"   >0</span>;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>DWORD dwCookie_ExeObj02 = <span style="color:navy;"   >0</span>;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>DWORD dwCookie_ExeObj03 = <span style="color:navy;"   >0</span>;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>DWORD dwThreadId_RegisterExeObj02Factory = <span style="color:navy;"   >0</span>;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>DWORD dwThreadId_RegisterExeObj03Factory = <span style="color:navy;"   >0</span>;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>g_dwMainThreadID = GetCurrentThreadId();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>RegisterClassObject<span style="color:blue;"   >&lt;</span>CExeObj01_Factory<span style="color:blue;"   >&gt;</span>(CLSID_ExeObj01,&amp;dwCookie_ExeObj01);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>dwThreadId_RegisterExeObj02Factory </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp; </span>= RegisterClassObject_ViaThread</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>(ThreadFunc_RegisterExeObj02Factory, &amp;dwCookie_ExeObj02);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>dwThreadId_RegisterExeObj03Factory </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp; </span>= RegisterClassObject_ViaThread</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>(ThreadFunc_RegisterExeObj03Factory, &amp;dwCookie_ExeObj03);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>::CoResumeClassObjects();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span><i><span style="color:green;"   >// Main message loop:</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span><span style="color:blue;"   >while</span> (GetMessage(&amp;msg, NULL, <span style="color:navy;"   >0</span>, <span style="color:navy;"   >0</span>)) </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp; </span>TranslateMessage(&amp;msg);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp; </span>DispatchMessage(&amp;msg);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>}</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>StopThread(dwThreadId_RegisterExeObj02Factory);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>StopThread(dwThreadId_RegisterExeObj03Factory);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>::CoRevokeClassObject(dwCookie_ExeObj01);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>::CoRevokeClassObject(dwCookie_ExeObj02);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>::CoRevokeClassObject(dwCookie_ExeObj03);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span>}</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span>::CoUninitialize();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;</span><span style="color:blue;"   >return</span> msg.wParam;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >}</span></p>  </div>    <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >I have left out some code in </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >WinMain()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >  that pertains to EXE server registration and unregistration which are  not relevant to our discussion here. I have narrowed down the code to  show only the runtime class factory registration process.</span></p>    <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >I created two helper functions </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >RegisterClassObject()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > and </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >RegisterClassObject_ViaThread()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > to help me with simplifying the call to </span><span style="font-size: 12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CoRegisterClassObject()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >.</span></p>    <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >These  are simple helper functions and, to avoid digression, I will not  discuss them in this article but to provide only a summary of what these  functions do:</span></p>    <ul type="disc"   ><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l2 level1 lfo2;tab-stops:list 36.0pt;background:white;"   ><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >RegisterClassObject()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >       - instantiates a class factory based on the class name (supplied  as a      template parameter) and then registers this class factory to  COM as the      class factory for a COM object the CLSID of which is  supplied as a      parameter to the </span><span style="font-size:12.0pt;      mso-bidi-font-size:11.0pt;"   lang="EN-US"   >RegisterClassObject()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      function. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l2 level1 lfo2;tab-stops:list 36.0pt;background:white;"   ><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >RegisterClassObject_ViaThread()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      - starts a thread whose job is to register a class factory using the </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:      ;"   lang="EN-US"   >RegisterClassObject()</span><span style="mso-bidi-font-size:      10.0pt;"   lang="EN-US"   > function. </span></li></ul>    <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Whenever the EXE COM Server starts up, it registers all three class factories (albeit not all of them are performed in </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >WinMain()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >'s thread).</span></p>    <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Notice the call to </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >CoInitializeEx(NULL, COINIT_APARTMENTTHREADED)</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > at the beginning of the function. This is important and it makes the COM objects created by the class factory registered in </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >WinMain()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >'s thread belong to an STA (the one in which </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >WinMain()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >'s thread is currently running in). This class factory is </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj01_Factory</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > and the CLSID of the objects it creates is </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >.</span></p>    <p style="text-align: left; line-height: 14.4pt; background: none repeat scroll 0% 0% white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >After performing class factories registration, </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >WinMain()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > enters a message loop. This message loop services all method calls to </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj01</span><span style=""   lang="EN-US"   > COM objects created by clients.</span></p><p style="text-align: left; line-height: 14.4pt; background: none repeat scroll 0% 0% white;"   align="left"   ><wbr></p><p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Let us now observe the other threads in action:</span></p>          <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >DWORD WINAPI ThreadFunc_RegisterExeObj02Factory(LPVOID lpvParameter)</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>MSG msg;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>PStructRegisterViaThread pStructRegisterViaThread </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>= (PStructRegisterViaThread)lpvParameter;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoInitializeEx(NULL, COINIT_APARTMENTTHREADED);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>DisplayCurrentThreadId();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>pStructRegisterViaThread -<span style="color:blue;"   >&gt;</span> dwThreadId = GetCurrentThreadId();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>RegisterClassObject<span style="color:blue;"   >&lt;</span>CExeObj02_Factory<span style="color:blue;"   >&gt;</span></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>(CLSID_ExeObj02, &amp;(pStructRegisterViaThread -<span style="color: blue;"   >&gt;</span> dwCookie));</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>SetEvent(pStructRegisterViaThread -<span style="color:blue;"   >&gt;</span> hEventRegistered);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><i><span style="color:green;"   >// Main message loop:</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >while</span> (GetMessage(&amp;msg, NULL, <span style="color:navy;"   >0</span>, <span style="color:navy;"   >0</span>)) </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>TranslateMessage(&amp;msg);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>DispatchMessage(&amp;msg);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>}</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoUninitialize();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >return</span> <span style="color:navy;"   >0</span>;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >}</span></p>  </div>     <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;background:white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >&nbsp;</span></p>     <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >DWORD</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >WINAPI</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >ThreadFunc_RegisterExeObj03Factory(LPVOID lpvParameter) {</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>MSG msg; </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>PStructRegisterViaThread pStructRegisterViaThread</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>= (PStructRegisterViaThread)lpvParameter;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoInitializeEx(NULL, COINIT_APARTMENTTHREADED);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>DisplayCurrentThreadId();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>pStructRegisterViaThread -<span style="color:blue;"   >&gt;</span> dwThreadId = GetCurrentThreadId();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>RegisterClassObject<span style="color:blue;"   >&lt;</span>CExeObj03_Factory<span style="color:blue;"   >&gt;</span></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>(CLSID_ExeObj03, &amp;(pStructRegisterViaThread -<span style="color: blue;"   >&gt;</span> dwCookie));</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>SetEvent(pStructRegisterViaThread -<span style="color:blue;"   >&gt;</span> hEventRegistered);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><i><span style="color:green;"   >// Main message loop:</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >while</span> (GetMessage(&amp;msg, NULL, <span style="color:navy;"   >0</span>, <span style="color:navy;"   >0</span>)) </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>TranslateMessage(&amp;msg);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>DispatchMessage(&amp;msg);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>}</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoUninitialize();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >return</span> <span style="color:navy;"   >0</span>;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >}</span></p>  </div>     <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Each of the threads perform the same actions:</span></p>     <ol start="1"   type="1"   ><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l0 level1 lfo3;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Each      initializes itself as an STA thread by calling </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CoInitializeEx(NULL,      COINIT_APARTMENTTHREADED)</span><span style="mso-bidi-font-size:      10.0pt;"   lang="EN-US"   >. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l0 level1 lfo3;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Each      displays the ID of the thread in which it is running (</span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:      ;"   lang="EN-US"   >DisplayCurrentThreadId()</span><span style="mso-bidi-font-size:      10.0pt;"   lang="EN-US"   >). </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l0 level1 lfo3;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Each      registers a class factory for </span><span style="font-size:      12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj02_Factory</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      and </span><span style="font-size:12.0pt;mso-bidi-font-size:      11.0pt;"   lang="EN-US"   >CExeObj03_Factory</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      respectively. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l0 level1 lfo3;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Each      enters a message loop. </span></li></ol>     <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >What we obtain eventually can be summarized in the following table:</span></p>     <table style="width:399.0pt;mso-cellspacing:.7pt;mso-yfti-tbllook:1184;mso-padding-alt:  1.5pt 1.5pt 1.5pt 1.5pt;"   border="1"   cellpadding="0"   cellspacing="1"   width="532"   >     <tbody><tr style="mso-yfti-irow:0;mso-yfti-firstrow:yes;"   >   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><b><span style="mso-bidi-font-size:   10.0pt;"   lang="EN-US"   >S/No</span></b><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><b><span style="mso-bidi-font-size:   10.0pt;"   lang="EN-US"   >Thread Function</span></b><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><b><span style="mso-bidi-font-size:   10.0pt;"   lang="EN-US"   >Class Factory</span></b><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><b><span style="mso-bidi-font-size:   10.0pt;"   lang="EN-US"   >COM coclass</span></b><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><b><span style="mso-bidi-font-size:   10.0pt;"   lang="EN-US"   >Apartment</span></b><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>  </tr>  <tr style="mso-yfti-irow:1;"   >   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >1</span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="font-size:12.0pt;   mso-bidi-font-size:11.0pt;"   lang="EN-US"   >WinMain()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="font-size:12.0pt;   mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj01_Factory</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="font-size:12.0pt;   mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >STA</span></p>   </td>  </tr>  <tr style="mso-yfti-irow:2;"   >   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >2</span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="font-size:12.0pt;   mso-bidi-font-size:11.0pt;"   lang="EN-US"   >ThreadFunc_ RegisterExeObj02Factory()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="font-size:12.0pt;   mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj02_Factory</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="font-size:12.0pt;   mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >STA</span></p>   </td>  </tr>  <tr style="mso-yfti-irow:3;mso-yfti-lastrow:yes;"   >   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >3</span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="font-size:12.0pt;   mso-bidi-font-size:11.0pt;"   lang="EN-US"   >ThreadFunc_ RegisterExeObj03Factory()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="font-size:12.0pt;   mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj03_Factory</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="font-size:12.0pt;   mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj03</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   ></span></p>   </td>   <td style="padding:1.5pt 1.5pt 1.5pt 1.5pt;"   >   <p style="text-align:left;line-height:14.4pt;   mso-pagination:widow-orphan;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >STA</span></p>   </td>  </tr>  </table><span style="font-size:10.5pt;mso-bidi-font-size:10.0pt;font-family: ;"   lang="EN-US"   ></span><span style="font-size:10.5pt;mso-bidi-font-size:10.0pt;font-family: ;"   lang="EN-US"   ></span><span style="font-size:10.5pt;mso-bidi-font-size:10.0pt;font-family: ;"   lang="EN-US"   ></span><span style="font-size:10.5pt;mso-bidi-font-size:10.0pt;font-family: ;"   lang="EN-US"   ></span><br><p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-outline-level: 3;background:white;"   align="left"   ><b><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >The Client</span></b></p>      <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Let us move on now to the Client. The Client code is simple. It consists of a </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >main()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > function that instantiates two instances each of coclass'es </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >, </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > and </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj03</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >. Each instantiation is referenced by a pointer to interfaces </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >, </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > and </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >IExeObj03</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > respectively:</span></p>      <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >int</span><span style="font-size:10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   > main()</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>IExeObj01* pIExeObj01A = NULL;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>IExeObj01* pIExeObj01B = NULL;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>IExeObj02* pIExeObj02A = NULL;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>IExeObj02* pIExeObj02B = NULL;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>IExeObj03* pIExeObj03A = NULL;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>IExeObj03* pIExeObj03B = NULL;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>HRESULT hr = ::CoInitializeEx(NULL, COINIT_MULTITHREADED);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoCreateInstance</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>(</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSID_ExeObj01,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>NULL,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSCTX_LOCAL_SERVER,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>IID_IExeObj01,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>(LPVOID*)&amp;pIExeObj01A </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoCreateInstance</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>(</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSID_ExeObj01,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>NULL,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSCTX_LOCAL_SERVER,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>IID_IExeObj01,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>(LPVOID*)&amp;pIExeObj01B</span></p>  </div>      <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;background:white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >&nbsp;</span></p>      <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoCreateInstance</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>(</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSID_ExeObj02,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>NULL,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSCTX_LOCAL_SERVER,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>IID_IExeObj02,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>(LPVOID*)&amp;pIExeObj02A </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoCreateInstance</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>(</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSID_ExeObj02,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>NULL,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSCTX_LOCAL_SERVER,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>IID_IExeObj02,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>(LPVOID*)&amp;pIExeObj02B </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoCreateInstance</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>(</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSID_ExeObj03,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>NULL,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSCTX_LOCAL_SERVER,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>IID_IExeObj03,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>(LPVOID*)&amp;pIExeObj03A </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoCreateInstance</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>(</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSID_ExeObj03,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>NULL,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSCTX_LOCAL_SERVER,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>IID_IExeObj03,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>(LPVOID*)&amp;pIExeObj03B </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>...</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>...</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>...</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >}</span></p>  </div>      <p style="text-align: left; line-height: 14.4pt; background: none repeat scroll 0% 0% white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Note our call to </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >CoInitializeEx(NULL, COINIT_MULTITHREADED)</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > at the beginning of </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >main()</span><span style=""   lang="EN-US"   >.  Unlike the case with using DLL servers, this call will have no effect  on the Apartment Model used by the COM objects that we create.</span></p><p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >The Client code then proceeds to call each interface pointer's </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > method before releasing all interface pointers:</span></p>       <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >if</span> (pIExeObj01A)</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>pIExeObj01A -<span style="color:blue;"   >&gt;</span> TestMethod1();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>}</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >if</span> (pIExeObj01B)</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>pIExeObj01B -<span style="color:blue;"   >&gt;</span> TestMethod1();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>}</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >if</span> (pIExeObj02A)</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>pIExeObj02A -<span style="color:blue;"   >&gt;</span> TestMethod1();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>}</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >if</span> (pIExeObj02B)</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>pIExeObj02B -<span style="color:blue;"   >&gt;</span> TestMethod1();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>}</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >if</span> (pIExeObj03A)</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>pIExeObj03A -<span style="color:blue;"   >&gt;</span> TestMethod1();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>}</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >if</span> (pIExeObj03B)</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>pIExeObj03B -<span style="color:blue;"   >&gt;</span> TestMethod1();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>}</span></p>  </div>       <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Let us observe what will happen when the Client application runs:</span></p>       <ol start="1"   type="1"   ><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >When      the first call to </span><span style="font-size:12.0pt;      mso-bidi-font-size:11.0pt;"   lang="EN-US"   >::CoCreateInstance()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      is made, COM will launch our EXE COM server. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Our      COM server will then run its </span><span style="font-size:      12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >WinMain()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      function. The first visible thing it will do is to display </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:      ;"   lang="EN-US"   >WinMain()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >'s thread ID in a message box. Let's say this is </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:      ;"   lang="EN-US"   >thread_id_1</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Next,      the class factory for the </span><span style="font-size:12.0pt;      mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      COM object is registered within </span><span style="font-size:      12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >WinMain()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >'s      thread. Hence </span><span style="font-size:12.0pt;mso-bidi-font-size:      11.0pt;"   lang="EN-US"   >CLSID_ExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      COM objects will live in the STA headed by </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >WinMain()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >'s      thread. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Our      COM server will then launch the thread headed by </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >ThreadFunc_RegisterExeObj02Factory()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      which will register the class factory for the </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      COM object. The ID for this thread is displayed by a message box at the      start of the thread. Let's say this is </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >thread_id_2</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >.      </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      COM objects will live in the STA headed by the thread with ID </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:      ;"   lang="EN-US"   >thread_id_2</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Our      COM server will then launch the thread headed by </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >ThreadFunc_RegisterExeObj03Factory()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      which will register the class factory for the </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj03</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      COM object. The ID for this thread is displayed by a message box at the      start of the thread. Let's say this is </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >thread_id_3</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >.      </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj03</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      COM objects will live in the STA headed by the thread with ID </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:      ;"   lang="EN-US"   >thread_id_3</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Back      to the client code. When </span><span style="font-size:12.0pt;      mso-bidi-font-size:11.0pt;"   lang="EN-US"   >TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      is invoked on </span><span style="font-size:12.0pt;mso-bidi-font-size:      11.0pt;"   lang="EN-US"   >pIExeObj01A</span><span style="mso-bidi-font-size:      10.0pt;"   lang="EN-US"   >, the ID of the thread which      is executing is displayed. You will note that this is </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:      ;"   lang="EN-US"   >thread_id_1</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > which is consistent with point 3 above. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >The      same ID will be displayed when </span><span style="font-size:      12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      is invoked on </span><span style="font-size:12.0pt;mso-bidi-font-size:      11.0pt;"   lang="EN-US"   >pIExeObj01B</span><span style="mso-bidi-font-size:      10.0pt;"   lang="EN-US"   >. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >When      </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      is invoked on </span><span style="font-size:12.0pt;mso-bidi-font-size:      11.0pt;"   lang="EN-US"   >pIExeObj02A</span><span style="mso-bidi-font-size:      10.0pt;"   lang="EN-US"   >, two thread IDs will be      displayed one after the other. The first one is the ID of the thread      executing when </span><span style="font-size:12.0pt;mso-bidi-font-size:      11.0pt;"   lang="EN-US"   >pIExeObj02A -</span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >&gt;</span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:      ;"   lang="EN-US"   > TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > is invoked, and this is </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >thread_id_2</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      which is consistent with point 5 above. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >When      the second message box is displayed, we will see the ID of the thread      running when the </span><span style="font-size:12.0pt;      mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj01</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      COM object contained inside </span><span style="font-size:12.0pt;      mso-bidi-font-size:11.0pt;"   lang="EN-US"   >pIExeObj02A</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      is invoked. This is <b><i>not</i></b> </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >thread_id_2</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      but </span><span style="font-size:12.0pt;mso-bidi-font-size:      11.0pt;"   lang="EN-US"   >thread_id_1</span><span style="mso-bidi-font-size:      10.0pt;"   lang="EN-US"   >! This is perfectly in line      with point 3 above. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >The      same pair of IDs will be displayed when </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      is invoked on </span><span style="font-size:12.0pt;mso-bidi-font-size:      11.0pt;"   lang="EN-US"   >pIExeObj02B</span><span style="mso-bidi-font-size:      10.0pt;"   lang="EN-US"   >. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l3 level1 lfo4;tab-stops:list 36.0pt;background:white;"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >When      </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >pIExeObj03A -</span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >&gt;</span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:      ;"   lang="EN-US"   > TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > and </span><span style="font-size:      12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >pIExeObj03B -</span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:      ;"   lang="EN-US"   >&gt;</span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:      ;"   lang="EN-US"   > TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > are invoked in the statements that follow, we      will see that the ID of the thread executing them is </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:      ;"   lang="EN-US"   >thread_id_3</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >. This is again consistent with point 7 above. </span></li></ol>       <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >If you were to put breakpoints in </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj01::TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > and </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CExeObj02::TestMethod1()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >, you will observe from the call stack that calls between them are actually marshaled.</span></p>       <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >We  have thus demonstrated STAs as used inside a COM EXE Server. I strongly  encourage the reader to experiment with the code and see the effects of  changing one or more threads from STAs to MTAs. It's a fun way to  learn.</span></p>       <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Before  I conclude this last major section, please allow me to present two  short variations to the Implementation code. The first shows the  dramatic effects of not providing the appropriate message loop inside a  class registration thread. The second shows the completely harmless  effects of not providing one!</span></p>       <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-outline-level: 3;background:white;"   align="left"   ><b><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >Variation 1</span></b></p>       <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Let us examine the first case. In the EXE COM server code's <i>main.cpp</i> file, we modify the </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >ThreadFunc_RegisterExeObj02Factory()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > function as follows:</span></p>       <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >DWORD WINAPI ThreadFunc_RegisterExeObj02Factory(LPVOID lpvParameter)</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>MSG msg;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>PStructRegisterViaThread pStructRegisterViaThread </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>= (PStructRegisterViaThread)lpvParameter;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoInitializeEx(NULL, COINIT_APARTMENTTHREADED);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>DisplayCurrentThreadId();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>pStructRegisterViaThread -<span style="color:blue;"   >&gt;</span> dwThreadId = GetCurrentThreadId();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>RegisterClassObject<span style="color:blue;"   >&lt;</span>CExeObj02_Factory<span style="color:blue;"   >&gt;</span></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>(CLSID_ExeObj02, &amp;(pStructRegisterViaThread -<span style="color: blue;"   >&gt;</span> dwCookie));</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>SetEvent(pStructRegisterViaThread -<span style="color:blue;"   >&gt;</span> hEventRegistered);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>Sleep(<span style="color:navy;"   >20000</span>); <i><span style="color:green;"   >/* Add Sleep() statement here. */</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><i><span style="color:green;"   >/* Main message loop: */</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >while</span> (GetMessage(&amp;msg, NULL, <span style="color:navy;"   >0</span>, <span style="color:navy;"   >0</span>))</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>TranslateMessage(&amp;msg);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>DispatchMessage(&amp;msg);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>}</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoUninitialize();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >return</span> <span style="color:navy;"   >0</span>;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >}</span></p>  </div><br><wbr><p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >We simply add a </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >Sleep()</span><span style="mso-bidi-font-size: 10.0pt;"   lang="EN-US"   >  statement right above the message loop. Compile the EXE COM server  again. Run the client in debug mode (so that you can observe what  happens when coclass </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > is instantiated as in the following call to </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CoCreateInstance()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >):</span></p>        <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoCreateInstance</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>(</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSID_ExeObj02,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>NULL,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>CLSCTX_LOCAL_SERVER,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>IID_IExeObj02,</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>(LPVOID*)&amp;pIExeObj02A </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>);</span></p>  </div>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >You  will note that this call will appear to hang. But hold on, if you had  patiently waited for about 20 seconds, the call will go through. What  happened? Well, turns out that because </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > is an STA object, the call to </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CoCreateInstance()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > resulted in a need to communicate with the message loop of the thread that registered the </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > class factory.</span></p>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >By blocking the thread with a </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >Sleep()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >  statement, the thread's message loop does not get serviced. The call to  create instance will not return in this case. But once the </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >Sleep()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > statement returns, the message loop is started and the create instance call is serviced and will return in time.</span></p>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Note therefore the importance of the message loop in a COM EXE Server STA thread.</span></p>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-outline-level: 3;background:white;"   align="left"   ><b><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >Variation 2</span></b></p>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >This time, let us modify the </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >ThreadFunc_RegisterExeObj02Factory()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > function as follows:</span></p>        <div style="mso-element:para-border-div;border:solid #FBEDBB 1.0pt;mso-border-alt: solid #FBEDBB .75pt;padding:5.0pt 5.0pt 5.0pt 5.0pt;background:#FBEDBB;"   >  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >DWORD WINAPI ThreadFunc_RegisterExeObj02Factory(LPVOID lpvParameter)</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >{</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>MSG msg;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>PStructRegisterViaThread pStructRegisterViaThread </span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>= (PStructRegisterViaThread)lpvParameter;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoInitializeEx(NULL, COINIT_MULTITHREADED);<i><span style="color:green;"   >/*1.Make this an MTA thread.*/</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>DisplayCurrentThreadId();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>pStructRegisterViaThread -<span style="color:blue;"   >&gt;</span> dwThreadId = GetCurrentThreadId();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>RegisterClassObject<span style="color:blue;"   >&lt;</span>CExeObj02_Factory<span style="color:blue;"   >&gt;</span></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp; </span>(CLSID_ExeObj02, &amp;(pStructRegisterViaThread -<span style="color: blue;"   >&gt;</span> dwCookie));</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>SetEvent(pStructRegisterViaThread -<span style="color:blue;"   >&gt;</span> hEventRegistered);</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>Sleep(INFINITE); <i><span style="color:green;"   >/* 2. Set to Sleep() infinitely. */</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><i><span style="color:green;"   >/* 3. Comment out Main message loop. */</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><i><span style="color:green;"   >/* while (GetMessage(&amp;msg, NULL, 0, 0))<span style="mso-spacerun:yes;"   >&nbsp; </span>*/</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><i><span style="color:green;"   >/* {<span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>*/</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><i><span style="color:green;"   >/*<span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>TranslateMessage(&amp;msg);<span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><i><span style="color:green;"   >/*<span style="mso-spacerun:yes;"   >&nbsp;&nbsp; </span>DispatchMessage(&amp;msg);<span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><i><span style="color:green;"   >/* }<span style="mso-spacerun:yes;"   >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></i></span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span>::CoUninitialize();</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   ><span style="mso-spacerun:yes;"   >&nbsp; </span><span style="color:blue;"   >return</span> <span style="color:navy;"   >0</span>;</span></p>  <p style="text-align:left;line-height:14.4pt; mso-pagination:widow-orphan;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; background:#FBEDBB;border:none;mso-border-alt:solid #FBEDBB .75pt;padding:0cm; mso-padding-alt:5.0pt 5.0pt 5.0pt 5.0pt;"   align="left"   ><span style="font-size: 10.0pt;mso-bidi-font-size:9.0pt;"   lang="EN-US"   >}</span></p>  </div>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >This time, we change the thread into an MTA thread, set </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >Sleep()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >'s parameter to </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >INFINITE</span><span style="mso-bidi-font-size: 10.0pt;"   lang="EN-US"   >, and comment out the message loop altogether.</span></p>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >You will find that the call to </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >::CoCreateInstance()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > on coclass </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size: 10.0pt;"   lang="EN-US"   > in the client will go through successfully albeit </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size: 10.0pt;"   lang="EN-US"   > is now an MTA object and the calls to its </span><span style="font-size:12.0pt;mso-bidi-font-size: 11.0pt;"   lang="EN-US"   >TestMethod1()</span><span style="mso-bidi-font-size: 10.0pt;"   lang="EN-US"   > method may display different thread IDs.</span></p>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >What we have shown clearly here is that as long as the MTA thread that registers a class factory remains alive (via </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >Sleep(INFINITE)</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >), calls to the class factory goes through (without the need for any message loop, by the way).</span></p>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Note that regardless of whether </span><span style="font-size:12.0pt; mso-bidi-font-size:11.0pt;"   lang="EN-US"   >ThreadFunc_RegisterExeObj02Factory()</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >  is an STA or MTA thread, if it had fallen through and exited after  registering its class factory, unpredictable results will occur when  coclass </span><span style="font-size:12.0pt;mso-bidi-font-size:11.0pt;"   lang="EN-US"   >CLSID_ExeObj02</span><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > is instantiated in the client.</span></p>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-outline-level: 2;background:white;"   align="left"   ><b><span style="font-size:14.0pt;mso-bidi-font-size: 13.0pt;"   lang="EN-US"   >In Conclusion</span></b></p>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >I  certainly hope that you have benefited from the explanatory text as  well as the example code of this long article. I have done my level best  to be as thorough and exhaustive as possible to lay a strong foundation  on the concepts of Single-Threaded Apartments.</span></p>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >In  this part one, I have demonstrated a few inter-apartment method calls  for which COM has already paved the way. We have also seen how COM  automatically arranges for objects to be created in the appropriate  apartment threads. Proxies and stubs are generated internally and the  marshalling of proxies are performed transparently without the  developers' knowledge.</span></p>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;background: white;"   align="left"   ><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >In  part two, we will touch on more advanced features of COM that pertain  to STAs. We shall show how to perform explicit marshaling of COM object  pointers from one apartment to another. We will also show how an object  can fire events from an external thread. Lower-level codes will be  explored.</span></p>        <p style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-outline-level: 2;background:white;"   align="left"   ><b><span style="font-size:14.0pt;mso-bidi-font-size: 13.0pt;"   lang="EN-US"   >Acknowledgements And References</span></b></p>        <ul type="disc"   ><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l4 level1 lfo5;tab-stops:list 36.0pt;background:white;"   ><b><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >The      Essence of COM, A Programmer's Workbook (3<sup>rd</sup> Edition)</span></b><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >      by David S. Platt. Published by Prentice Hall PTR. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l4 level1 lfo5;tab-stops:list 36.0pt;background:white;"   ><b><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Inside      COM</span></b><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > by Dale Rogerson. Published by Microsoft Press. </span></li><li style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;      text-align:left;line-height:14.4pt;mso-pagination:widow-orphan;mso-list:      l4 level1 lfo5;tab-stops:list 36.0pt;background:white;"   ><b><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   >Essential      COM</span></b><span style="mso-bidi-font-size:10.0pt;"   lang="EN-US"   > by Don Box. Published by Addison-Wesley. </span></li></ul>        <span style="font-size:10.5pt;mso-bidi-font-size:10.0pt;font-family: ;"   lang="EN-US"   >The example code in the <i>"Test Programs\VCTests\DemonstrateExeServerSTA\Implementation\ExeServerImpl"</i> subfolder uses two source files <i>REGISTRY.H</i> and <i>REGISTRY.CPP</i> which are taken from Dale Rogerson's book <b>"Inside COM"</b>.</span><br><span style="font-size:10.5pt;mso-bidi-font-size:10.0pt;font-family: ;"   lang="EN-US"   ></span>
</body></html>