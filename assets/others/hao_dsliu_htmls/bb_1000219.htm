<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：OpenSSL 内存管理分析笔记</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>OpenSSL 内存管理分析笔记</h2>
<p align="right">发布时间：2011-5-31 11:28
<br>分类名称：OpenSSL</p><br>
<p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:宋体;">面向开发者使用的最外层接口：</span><span style="font-family:Courier New;">    </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">OPENSSL_malloc<span style="color:navy;"><strong>(</strong><span style="color:black;">num<span style="color:navy;"><strong>)</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>&lt;===&gt;</strong><span style="color:black;">   CRYPTO_malloc<span style="color:navy;"><strong>((</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>)</strong><span style="color:black;">num<span style="color:navy;"><strong>,</strong><span style="color:black;">__FILE__<span style="color:navy;"><strong>,</strong><span style="color:black;">__LINE__<span style="color:navy;"><strong>) </strong></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">OPENSSL_realloc<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>,</strong><span style="color:black;">num<span style="color:navy;"><strong>)</strong><span style="color:black;">         </span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>&lt;===&gt;</strong><span style="color:black;">   CRYPTO_realloc<span style="color:navy;"><strong>((</strong><span style="color:#8000ff;">char<span style="color:black;">        <span style="color:navy;"><strong>*)</strong><span style="color:black;">addr<span style="color:navy;"><strong>, (</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>)</strong><span style="color:black;">num<span style="color:navy;"><strong>, </strong><span style="color:black;">__FILE__<span style="color:navy;"><strong>, </strong><span style="color:black;">__LINE__<span style="color:navy;"><strong>) </strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">OPENSSL_realloc_clean<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>,</strong><span style="color:black;">old_num<span style="color:navy;"><strong>,</strong><span style="color:black;">num<span style="color:navy;"><strong>)</strong><span style="color:black;">           </span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>&lt;===&gt;</strong><span style="color:black;">   CRYPTO_realloc_clean<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>,</strong><span style="color:black;">old_num<span style="color:navy;"><strong>,</strong><span style="color:black;">num<span style="color:navy;"><strong>,</strong><span style="color:black;">__FILE__<span style="color:navy;"><strong>,</strong><span style="color:black;">__LINE__<span style="color:navy;"><strong>) </strong></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">OPENSSL_remalloc<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>,</strong><span style="color:black;">num<span style="color:navy;"><strong>)</strong><span style="color:black;">         </span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>&lt;===&gt;</strong><span style="color:black;">   CRYPTO_remalloc<span style="color:navy;"><strong>((</strong><span style="color:#8000ff;">char<span style="color:black;">        <span style="color:navy;"><strong>**)</strong><span style="color:black;">addr<span style="color:navy;"><strong>,(</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>)</strong><span style="color:black;">num<span style="color:navy;"><strong>,</strong><span style="color:black;">__FILE__<span style="color:navy;"><strong>,</strong><span style="color:black;">__LINE__<span style="color:navy;"><strong>) </strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">OPENSSL_free<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>)</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>&lt;===&gt;</strong><span style="color:black;">   CRYPTO_free<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>) </strong></span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">OPENSSL_malloc_locked<span style="color:navy;"><strong>(</strong><span style="color:black;">num<span style="color:navy;"><strong>)</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>&lt;===&gt;</strong><span style="color:black;">   CRYPTO_malloc_locked<span style="color:navy;"><strong>((</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>)</strong><span style="color:black;">num<span style="color:navy;"><strong>,</strong><span style="color:black;">__FILE__<span style="color:navy;"><strong>,</strong><span style="color:black;">__LINE__<span style="color:navy;"><strong>) </strong></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">OPENSSL_free_locked<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>)</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>&lt;===&gt;</strong><span style="color:black;">   CRYPTO_free_locked<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>)</strong><span style="color:black;">        </span></span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:Courier New;">CRYPTO_XXXX </span><span style="font-family:宋体;">在</span><span style="font-family:Courier New;">Crypto<span style="color:navy;"><strong>.</strong><span style="color:black;">h</span></span></span><span style="font-family:宋体;">中声明，</span><span style="font-family:Courier New;">    </span><span style="font-family:宋体;">在</span><span style="font-family:Courier New;">Mem<span style="color:navy;"><strong>.</strong><span style="color:black;">c</span></span></span><span style="font-family:宋体;">来实现。</span><span style="font-family:Courier New;">Mem<span style="color:navy;"><strong>.</strong><span style="color:black;">c</span></span></span><span style="font-family:宋体;">中，使用了两类内存申请函数，</span><span style="font-family:Courier New;">    </span></span></p><p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:宋体;">一类为直接调用</span><span style="font-family:Courier New;">malloc</span><span style="font-family:宋体;">（</span><span style="font-family:Courier New;">default_XXXXX<span style="color:navy;"><strong>),</strong><span style="color:black;">      </span></span></span><span style="font-family:宋体;">一类为调用</span><span style="font-family:Courier New;">Mem_dbg<span style="color:navy;"><strong>.</strong><span style="color:black;">c</span></span></span><span style="font-family:宋体;">中的</span><span style="font-family:Courier New;">dbg</span><span style="font-family:宋体;">版本的函数（</span><span style="font-family:Courier New;">CRYPTO_dbg_XXXX<span style="color:navy;"><strong>)</strong></span></span><span style="color:black;"><span style="font-family:宋体;">。</span><span style="font-family:Courier New;">     </span></span></span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>================================================================================</strong><span style="color:black;">    </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">malloc_func<span style="color:navy;"><strong>,</strong><span style="color:black;"> malloc_ex_func<span style="color:navy;"><strong>,</strong><span style="color:black;"> realloc_func<span style="color:navy;"><strong>,</strong><span style="color:black;"> realloc_ex_func<span style="color:navy;"><strong>,</strong><span style="color:black;"> free_func </span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:Courier New;">malloc_locked_func<span style="color:navy;"><strong>,</strong><span style="color:black;"> malloc_locked_ex_func</span></span></span><span style="font-family:宋体;">，</span><span style="font-family:Courier New;">malloc_debug_func</span><span style="font-family:宋体;">，</span><span style="font-family:Courier New;">realloc_debug_func</span><span style="font-family:宋体;">，</span><span style="font-family:Courier New;">    </span></span></p><p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:Courier New;">free_debug_func</span><span style="font-family:宋体;">，</span><span style="font-family:Courier New;">set_debug_options_func</span><span style="font-family:宋体;">，</span><span style="font-family:Courier New;">get_debug_options_func </span></span></p><p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:宋体;">这些函数由，</span><span style="font-family:Courier New;">CRYPTO_XXXX </span><span style="font-family:宋体;">来调用（其内部首先判断</span><span style="font-family:Courier New;">Debug</span><span style="font-family:宋体;">版本的是否为</span><span style="font-family:Courier New;">NULL</span><span style="font-family:宋体;">，如果不为</span><span style="font-family:Courier New;">NULL</span><span style="font-family:宋体;">，</span><span style="font-family:Courier New;">    </span></span></p><p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:宋体;">则调用</span><span style="font-family:Courier New;">Debug</span><span style="font-family:宋体;">版本的，否则调用非</span><span style="font-family:Courier New;">Debug</span><span style="font-family:宋体;">版本的。</span><span style="font-family:Courier New;">Debug</span><span style="font-family:宋体;">版本的调用比较特殊，会调用两次。</span><span style="font-family:Courier New;">    </span></span></p><p style="background: white;"><span style="color:#ff8000; font-family:Courier New; font-size:10pt;">0<span style="color:navy;"><strong>:</strong><span style="color:black;"> called before the actual memory allocation has taken place </span></span></span></p><p style="background: white;"><span style="color:#ff8000; font-family:Courier New; font-size:10pt;">1<span style="color:navy;"><strong>:</strong><span style="color:black;"> called after the actual memory allocation has taken place </span></span></span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>================================================================================</strong><span style="color:black;">    </span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>*(*</strong><span style="color:black;">malloc_func<span style="color:navy;"><strong>)(</strong><span style="color:black;">size_t<span style="color:navy;"><strong>)</strong><span style="color:black;">             <span style="color:navy;"><strong>=</strong><span style="color:black;"> malloc<span style="color:navy;"><strong>;</strong><span style="color:black;">                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>*</strong><span style="color:black;">default_malloc_ex<span style="color:navy;"><strong>(</strong><span style="color:black;">size_t num<span style="color:navy;"><strong>,</strong><span style="color:black;">             <span style="color:#8000ff;">const<span style="color:black;">               <span style="color:#8000ff;">char<span style="color:black;">                 <span style="color:navy;"><strong>*</strong><span style="color:black;">file<span style="color:navy;"><strong>,</strong><span style="color:black;">                     <span style="color:#8000ff;">int<span style="color:black;"> line<span style="color:navy;"><strong>)</strong><span style="color:black;">                        </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:navy;"><strong>{</strong><span style="color:black;">      <span style="color:blue;"><strong>return</strong><span style="color:black;"> malloc_func<span style="color:navy;"><strong>(</strong><span style="color:black;">num<span style="color:navy;"><strong>);</strong><span style="color:black;">            <span style="color:navy;"><strong>}</strong><span style="color:black;">             </span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>*(*</strong><span style="color:black;">malloc_ex_func<span style="color:navy;"><strong>)(</strong><span style="color:black;">size_t<span style="color:navy;"><strong>,</strong><span style="color:black;">             <span style="color:#8000ff;">const<span style="color:black;">               <span style="color:#8000ff;">char<span style="color:black;">                 <span style="color:navy;"><strong>*</strong><span style="color:black;">file<span style="color:navy;"><strong>,</strong><span style="color:black;">                     <span style="color:#8000ff;">int<span style="color:black;"> line<span style="color:navy;"><strong>)</strong><span style="color:black;">                        </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:navy;"><strong>=</strong><span style="color:black;"> default_malloc_ex<span style="color:navy;"><strong>;</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>*(*</strong><span style="color:black;">realloc_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">void<span style="color:black;">            <span style="color:navy;"><strong>*,</strong><span style="color:black;"> size_t<span style="color:navy;"><strong>)=</strong><span style="color:black;"> realloc<span style="color:navy;"><strong>;</strong><span style="color:black;">                 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>*</strong><span style="color:black;">default_realloc_ex<span style="color:navy;"><strong>(</strong><span style="color:#8000ff;">void<span style="color:black;">            <span style="color:navy;"><strong>*</strong><span style="color:black;">str<span style="color:navy;"><strong>,</strong><span style="color:black;"> size_t num<span style="color:navy;"><strong>,</strong><span style="color:black;">                 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#8000ff;">const<span style="color:black;">      <span style="color:#8000ff;">char<span style="color:black;">        <span style="color:navy;"><strong>*</strong><span style="color:black;">file<span style="color:navy;"><strong>,</strong><span style="color:black;">            <span style="color:#8000ff;">int<span style="color:black;"> line<span style="color:navy;"><strong>)</strong><span style="color:black;">               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:navy;"><strong>{</strong><span style="color:black;">      <span style="color:blue;"><strong>return</strong><span style="color:black;"> realloc_func<span style="color:navy;"><strong>(</strong><span style="color:black;">str<span style="color:navy;"><strong>,</strong><span style="color:black;">num<span style="color:navy;"><strong>);</strong><span style="color:black;">              <span style="color:navy;"><strong>}</strong><span style="color:black;">               </span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>*(*</strong><span style="color:black;">realloc_ex_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">void<span style="color:black;">            <span style="color:navy;"><strong>*,</strong><span style="color:black;"> size_t<span style="color:navy;"><strong>,</strong><span style="color:black;">                <span style="color:#8000ff;">const<span style="color:black;">                  <span style="color:#8000ff;">char<span style="color:black;">                    <span style="color:navy;"><strong>*</strong><span style="color:black;">file<span style="color:navy;"><strong>,</strong><span style="color:black;">                        <span style="color:#8000ff;">int<span style="color:black;"> line<span style="color:navy;"><strong>)</strong><span style="color:black;">                           </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:navy;"><strong>=</strong><span style="color:black;"> default_realloc_ex<span style="color:navy;"><strong>;</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>(*</strong><span style="color:black;">free_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">void<span style="color:black;">            <span style="color:navy;"><strong>*)</strong><span style="color:black;">              <span style="color:navy;"><strong>=</strong><span style="color:black;"> free<span style="color:navy;"><strong>;</strong><span style="color:black;">                 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>*(*</strong><span style="color:black;">malloc_locked_func<span style="color:navy;"><strong>)(</strong><span style="color:black;">size_t<span style="color:navy;"><strong>)</strong><span style="color:black;">             <span style="color:navy;"><strong>=</strong><span style="color:black;"> malloc<span style="color:navy;"><strong>;</strong><span style="color:black;">                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>*</strong><span style="color:black;">default_malloc_locked_ex<span style="color:navy;"><strong>(</strong><span style="color:black;">size_t num<span style="color:navy;"><strong>,</strong><span style="color:black;">             <span style="color:#8000ff;">const<span style="color:black;">               <span style="color:#8000ff;">char<span style="color:black;">                 <span style="color:navy;"><strong>*</strong><span style="color:black;">file<span style="color:navy;"><strong>,</strong><span style="color:black;">                     <span style="color:#8000ff;">int<span style="color:black;"> line<span style="color:navy;"><strong>)</strong><span style="color:black;">                        </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:navy;"><strong>{</strong><span style="color:black;">      <span style="color:blue;"><strong>return</strong><span style="color:black;"> malloc_locked_func<span style="color:navy;"><strong>(</strong><span style="color:black;">num<span style="color:navy;"><strong>);</strong><span style="color:black;">            <span style="color:navy;"><strong>}</strong><span style="color:black;">             </span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>*(*</strong><span style="color:black;">malloc_locked_ex_func<span style="color:navy;"><strong>)(</strong><span style="color:black;">size_t<span style="color:navy;"><strong>,</strong><span style="color:black;">             <span style="color:#8000ff;">const<span style="color:black;">               <span style="color:#8000ff;">char<span style="color:black;">                 <span style="color:navy;"><strong>*</strong><span style="color:black;">file<span style="color:navy;"><strong>,</strong><span style="color:black;">                     <span style="color:#8000ff;">int<span style="color:black;"> line<span style="color:navy;"><strong>)</strong><span style="color:black;">                        </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:navy;"><strong>=</strong><span style="color:black;"> default_malloc_locked_ex<span style="color:navy;"><strong>;</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>(*</strong><span style="color:black;">free_locked_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">void<span style="color:black;">            <span style="color:navy;"><strong>*)</strong><span style="color:black;">              <span style="color:navy;"><strong>=</strong><span style="color:black;"> free<span style="color:navy;"><strong>;</strong><span style="color:black;">                 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>================================================================================</strong><span style="color:black;">    </span></span></p><p style="background: white;"><span style="color:#804000; font-family:Courier New; font-size:10pt;">#ifdef CRYPTO_MDEBUG </span></p><p style="background: white;"><span style="color:green; font-family:Courier New; font-size:10pt;">/* use default functions from mem_dbg.c */<span style="color:black;">    </span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>(*</strong><span style="color:black;">malloc_debug_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">void<span style="color:black;">            <span style="color:navy;"><strong>*,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>,</strong><span style="color:#8000ff;">const<span style="color:black;">                 <span style="color:#8000ff;">char<span style="color:black;">                   <span style="color:navy;"><strong>*,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>)</strong><span style="color:black;">                        </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:navy;"><strong>=</strong><span style="color:black;"> CRYPTO_dbg_malloc<span style="color:navy;"><strong>;</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>(*</strong><span style="color:black;">realloc_debug_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">void<span style="color:black;">            <span style="color:navy;"><strong>*,</strong><span style="color:#8000ff;">void<span style="color:black;">               <span style="color:navy;"><strong>*,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>,</strong><span style="color:#8000ff;">const<span style="color:black;">                    <span style="color:#8000ff;">char<span style="color:black;">                      <span style="color:navy;"><strong>*,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>)</strong><span style="color:black;">                           </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:navy;"><strong>=</strong><span style="color:black;"> CRYPTO_dbg_realloc<span style="color:navy;"><strong>;</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>(*</strong><span style="color:black;">free_debug_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">void<span style="color:black;">            <span style="color:navy;"><strong>*,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>)</strong><span style="color:black;">                <span style="color:navy;"><strong>=</strong><span style="color:black;"> CRYPTO_dbg_free<span style="color:navy;"><strong>;</strong><span style="color:black;">                   </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>(*</strong><span style="color:black;">set_debug_options_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">long<span style="color:navy;"><strong>)</strong><span style="color:black;">             <span style="color:navy;"><strong>=</strong><span style="color:black;"> CRYPTO_dbg_set_options<span style="color:navy;"><strong>;</strong><span style="color:black;">                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">long<span style="color:black;">       <span style="color:navy;"><strong>(*</strong><span style="color:black;">get_debug_options_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">void<span style="color:navy;"><strong>)</strong><span style="color:black;">             <span style="color:navy;"><strong>=</strong><span style="color:black;"> CRYPTO_dbg_get_options<span style="color:navy;"><strong>;</strong><span style="color:black;">                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#804000; font-family:Courier New; font-size:10pt;">#else </span></p><p style="background: white;"><span style="color:green; font-family:Courier New; font-size:10pt;">/* applications can use CRYPTO_malloc_debug_init() to select above case </span></p><p style="background: white;"><span style="color:green; font-family:Courier New; font-size:10pt;"> * at run-time */<span style="color:black;">    </span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>(*</strong><span style="color:black;">malloc_debug_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">void<span style="color:black;">            <span style="color:navy;"><strong>*,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>,</strong><span style="color:#8000ff;">const<span style="color:black;">                 <span style="color:#8000ff;">char<span style="color:black;">                   <span style="color:navy;"><strong>*,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>)</strong><span style="color:black;">                         <span style="color:navy;"><strong>=</strong><span style="color:black;">                           <span style="color:blue;"><strong>NULL<span style="color:navy;">;</span></strong><span style="color:black;">                            </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>(*</strong><span style="color:black;">realloc_debug_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">void<span style="color:black;">            <span style="color:navy;"><strong>*,</strong><span style="color:#8000ff;">void<span style="color:black;">               <span style="color:navy;"><strong>*,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>,</strong><span style="color:#8000ff;">const<span style="color:black;">                    <span style="color:#8000ff;">char<span style="color:black;">                      <span style="color:navy;"><strong>*,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>)</strong><span style="color:black;">                           </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:navy;"><strong>=</strong><span style="color:black;">      <span style="color:blue;"><strong>NULL<span style="color:navy;">;</span></strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>(*</strong><span style="color:black;">free_debug_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">void<span style="color:black;">            <span style="color:navy;"><strong>*,</strong><span style="color:#8000ff;">int<span style="color:navy;"><strong>)</strong><span style="color:black;">                <span style="color:navy;"><strong>=</strong><span style="color:black;">                  <span style="color:blue;"><strong>NULL<span style="color:navy;">;</span></strong><span style="color:black;">                   </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">void<span style="color:black;">       <span style="color:navy;"><strong>(*</strong><span style="color:black;">set_debug_options_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">long<span style="color:navy;"><strong>)</strong><span style="color:black;">             <span style="color:navy;"><strong>=</strong><span style="color:black;">               <span style="color:blue;"><strong>NULL<span style="color:navy;">;</span></strong><span style="color:black;">                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">static<span style="color:black;">     <span style="color:#8000ff;">long<span style="color:black;">       <span style="color:navy;"><strong>(*</strong><span style="color:black;">get_debug_options_func<span style="color:navy;"><strong>)(</strong><span style="color:#8000ff;">void<span style="color:navy;"><strong>)</strong><span style="color:black;">             <span style="color:navy;"><strong>=</strong><span style="color:black;">               <span style="color:blue;"><strong>NULL<span style="color:navy;">;</span></strong><span style="color:black;">                </span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:#804000; font-family:Courier New; font-size:10pt;">#endif </span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>================================================================================</strong><span style="color:black;">    </span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:宋体;">如何使用（使用最外层函数，也就俗称的接口，这里成为</span><span style="font-family:Courier New;">Openssl API</span><span style="font-family:宋体;">）：</span><span style="font-family:Courier New;">    </span></span></p><p style="background: white;"><span style="color:#ff8000; font-size:10pt;"><span style="font-family:Courier New;">1.<span style="color:black;">     </span></span><span style="font-family:宋体;">初始化</span><span style="color:black; font-family:Courier New;">    </span></span></p><p style="background: white;"><span style="color:#804000; font-family:Courier New; font-size:10pt;">#define CRYPTO_malloc_init()    CRYPTO_set_mem_functions(malloc, realloc, free) </span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:宋体;">如果编译</span><span style="font-family:Courier New;">Openssl</span><span style="font-family:宋体;">的时候定义了</span><span style="font-family:Courier New;">CRYPTO_MDEBUG </span><span style="font-family:宋体;">或</span><span style="font-family:Courier New;"> CRYPTO_MDEBUG_ALL  </span></span></p><p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:宋体;">或</span><span style="font-family:Courier New;"> CRYPTO_MDEBUG_TIME </span><span style="font-family:宋体;">或</span><span style="font-family:Courier New;"> CRYPTO_MDEBUG_THREAD</span><span style="font-family:宋体;">，则此函数无需调用，默认是被设置好的。详情见</span><span style="font-family:Courier New;">Mem.c</span><span style="font-family:宋体;">。</span><span style="font-family:Courier New;">    </span></span></p><p style="background: white;"><span style="color:#804000; font-family:Courier New; font-size:10pt;">#define CRYPTO_malloc_debug_init()  do {\ </span></p><p style="background: white;"><span style="color:#804000; font-family:Courier New; font-size:10pt;">    CRYPTO_set_mem_debug_functions(\ </span></p><p style="background: white;"><span style="color:#804000; font-family:Courier New; font-size:10pt;">        CRYPTO_dbg_malloc,\ </span></p><p style="background: white;"><span style="color:#804000; font-family:Courier New; font-size:10pt;">        CRYPTO_dbg_realloc,\ </span></p><p style="background: white;"><span style="color:#804000; font-family:Courier New; font-size:10pt;">        CRYPTO_dbg_free,\ </span></p><p style="background: white;"><span style="color:#804000; font-family:Courier New; font-size:10pt;">        CRYPTO_dbg_set_options,\ </span></p><p style="background: white;"><span style="color:#804000; font-family:Courier New; font-size:10pt;">        CRYPTO_dbg_get_options);\ </span></p><p style="background: white;"><span style="color:#804000; font-family:Courier New; font-size:10pt;">    } while(0) </span></p><p style="background: white;"><span style="color:#ff8000; font-size:10pt;"><span style="font-family:Courier New;">2.<span style="color:black;">     </span></span><span style="font-family:宋体;">配置选项</span><span style="color:black; font-family:Courier New;">    </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:green;">/* Adds time to the memory checking information */<span style="color:black;">     </span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#804000;">#define V_CRYPTO_MDEBUG_TIME    0x1 </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:green;">/* Adds thread number to the memory checking information */<span style="color:black;">     </span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#804000;">#define V_CRYPTO_MDEBUG_THREAD  0x2 </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#804000;">#define V_CRYPTO_MDEBUG_ALL (V_CRYPTO_MDEBUG_TIME | V_CRYPTO_MDEBUG_THREAD) </span></span></p><p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:Courier New;">     <span style="color:green;">// </span></span><span style="font-family:宋体;">设置显示信息，显示时间和</span><span style="color:green;"><span style="font-family:Courier New;">Thread ID</span><span style="font-family:宋体;">。</span><span style="color:black; font-family:Courier New;">     </span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">CRYPTO_set_mem_debug_options<span style="color:navy;"><strong>(</strong><span style="color:black;">V_CRYPTO_MDEBUG_ALL<span style="color:navy;"><strong>);</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;">     &nbsp;</p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">/* for applications */<span style="color:black;">     </span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#804000;">#define CRYPTO_MEM_CHECK_OFF        0x0 </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#804000;">#define CRYPTO_MEM_CHECK_ON         0x1 </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:green;">/* for libs*/<span style="color:black;">     </span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#804000;">#define CRYPTO_MEM_CHECK_ENABLE     0x2 </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#804000;">#define CRYPTO_MEM_CHECK_DISABLE    0x3 </span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:Courier New;">     <span style="color:green;">// </span></span><span style="font-family:宋体;">可以直接调用这个，也可以调用底下的接口函数</span><span style="color:green; font-family:Courier New;">    </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#8000ff;">int<span style="color:black;"> CRYPTO_mem_ctrl<span style="color:navy;"><strong>(</strong><span style="color:#8000ff;">int<span style="color:black;"> mode<span style="color:navy;"><strong>);</strong><span style="color:black;">          </span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#8000ff;">int<span style="color:black;"> CRYPTO_is_mem_check_on<span style="color:navy;"><strong>(</strong><span style="color:#8000ff;">void<span style="color:navy;"><strong>);</strong><span style="color:black;">         </span></span></span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:green;">/* for applications */<span style="color:black;">     </span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#804000;">#define MemCheck_start() CRYPTO_mem_ctrl(CRYPTO_MEM_CHECK_ON) </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#804000;">#define MemCheck_stop() CRYPTO_mem_ctrl(CRYPTO_MEM_CHECK_OFF) </span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:green;">/* for library-internal use */<span style="color:black;">     </span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#804000;">#define MemCheck_on()   CRYPTO_mem_ctrl(CRYPTO_MEM_CHECK_ENABLE) </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#804000;">#define MemCheck_off()  CRYPTO_mem_ctrl(CRYPTO_MEM_CHECK_DISABLE) </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#804000;">#define is_MemCheck_on() CRYPTO_is_mem_check_on() </span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"> &nbsp;</p><p style="background: white;">     &nbsp;</p><p style="background: white;"><span style="color:#ff8000; font-size:10pt;"><span style="font-family:Courier New;">3.<span style="color:black;">     </span></span><span style="font-family:宋体;">使用最外层接口</span><span style="color:black; font-family:Courier New;">    </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    OPENSSL_malloc<span style="color:navy;"><strong>(</strong><span style="color:black;">num<span style="color:navy;"><strong>)</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    OPENSSL_realloc<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>,</strong><span style="color:black;">num<span style="color:navy;"><strong>)</strong><span style="color:black;">         </span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    OPENSSL_realloc_clean<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>,</strong><span style="color:black;">old_num<span style="color:navy;"><strong>,</strong><span style="color:black;">num<span style="color:navy;"><strong>)</strong><span style="color:black;">           </span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    OPENSSL_remalloc<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>,</strong><span style="color:black;">num<span style="color:navy;"><strong>)</strong><span style="color:black;">         </span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    OPENSSL_free<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>)</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    OPENSSL_malloc_locked<span style="color:navy;"><strong>(</strong><span style="color:black;">num<span style="color:navy;"><strong>)</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    OPENSSL_free_locked<span style="color:navy;"><strong>(</strong><span style="color:black;">addr<span style="color:navy;"><strong>)</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="color:black; font-size:10pt;"><span style="font-family:宋体;">示例：</span><span style="font-family:Courier New;">    </span></span></p><p style="background: white;"><span style="color:#8000ff; font-family:Courier New; font-size:10pt;">int<span style="color:black;"> main<span style="color:navy;"><strong>()</strong><span style="color:black;">      </span></span></span></span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>{</strong><span style="color:black;">    </span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:#8000ff;">char<span style="color:black;">      <span style="color:navy;"><strong>*</strong><span style="color:black;">p <span style="color:navy;"><strong>=</strong><span style="color:black;">          <span style="color:blue;"><strong>NULL<span style="color:navy;">;</span></strong><span style="color:black;">           </span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    BIO <span style="color:navy;"><strong>*</strong><span style="color:black;">b <span style="color:navy;"><strong>=</strong><span style="color:black;">        <span style="color:blue;"><strong>NULL<span style="color:navy;">;</span></strong><span style="color:black;">         </span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    CRYPTO_malloc_debug_init<span style="color:navy;"><strong>();</strong><span style="color:black;">     </span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    CRYPTO_set_mem_debug_options<span style="color:navy;"><strong>(</strong><span style="color:black;">V_CRYPTO_MDEBUG_ALL<span style="color:navy;"><strong>);</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    CRYPTO_mem_ctrl<span style="color:navy;"><strong>(</strong><span style="color:black;">CRYPTO_MEM_CHECK_ON<span style="color:navy;"><strong>);</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    p <span style="color:navy;"><strong>=</strong><span style="color:black;">      <span style="color:navy;"><strong>(</strong><span style="color:#8000ff;">char<span style="color:navy;"><strong>*)</strong><span style="color:black;">OPENSSL_malloc<span style="color:navy;"><strong>(</strong><span style="color:#ff8000;">4<span style="color:navy;"><strong>);</strong><span style="color:black;">             </span></span></span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    CRYPTO_mem_ctrl<span style="color:navy;"><strong>(</strong><span style="color:black;">CRYPTO_MEM_CHECK_OFF<span style="color:navy;"><strong>);</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    b <span style="color:navy;"><strong>=</strong><span style="color:black;"> BIO_new_file<span style="color:navy;"><strong>(</strong><span style="color:gray;">"leak.log"<span style="color:navy;"><strong>,</strong><span style="color:gray;">"w"<span style="color:navy;"><strong>);</strong><span style="color:black;">           </span></span></span></span></span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    CRYPTO_mem_ctrl<span style="color:navy;"><strong>(</strong><span style="color:black;">CRYPTO_MEM_CHECK_ON<span style="color:navy;"><strong>);</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    CRYPTO_mem_leaks<span style="color:navy;"><strong>(</strong><span style="color:black;">b<span style="color:navy;"><strong>);</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    OPENSSL_free<span style="color:navy;"><strong>(</strong><span style="color:black;">p<span style="color:navy;"><strong>);</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    BIO_free<span style="color:navy;"><strong>(</strong><span style="color:black;">b<span style="color:navy;"><strong>);</strong><span style="color:black;">       </span></span></span></span></span></p><p style="background: white;"><span style="color:black; font-family:Courier New; font-size:10pt;">    <span style="color:blue;"><strong>return</strong><span style="color:black;">      <span style="color:#ff8000;">0<span style="color:navy;"><strong>;</strong><span style="color:black;">        </span></span></span></span></span></span></p><p style="background: white;"><span style="color:navy; font-family:Courier New; font-size:10pt;"><strong>}</strong><span style="color:black;">    </span></span></p><p style="background: white;"> &nbsp;</p><p style="background: white;"><span style="font-family:宋体; font-size:12pt;">所以，提取OpenSSL中部分代码，只需要重新定义</span><span style="color:black; font-size:10pt;"><span style="font-family:Courier New;">OPENSSL_XXXX</span><span style="font-family:宋体;">这几个宏即可。</span></span></p>
</body></html>