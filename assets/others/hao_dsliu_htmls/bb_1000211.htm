<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：[转]Windows 控制面板编程</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>[转]Windows 控制面板编程</h2>
<p align="right">发布时间：2011-6-16 12:06
<br>分类名称：windows</p><br>
<p><span style="font-family:宋体; font-size:12pt;"  ><span style="color:red;"  >说明：本文章为本人在做项目时查阅相关文章而写成，如有不当之处，请指出。</span>   </span></p><p><span style="font-family:宋体; font-size:12pt;"  ><span style="color:red;"  >mail: <a rel="nofollow" href="mailto:tomcui60000520@163.com"  ><span style="color:blue; text-decoration:underline;"  >tomcui60000520@163.com</span></a></span>   </span></p><p><span style="font-family:宋体; font-size:12pt;"  ><span style="color:red;"  >关键字：</span>   </span></p><p><span style="font-family:宋体; font-size:12pt;"  ><span style="color:black;"  >控制面板，控制面板应用程序，</span>   </span></p><p>&nbsp; &nbsp;</p><p style="margin-left: 21pt;"  ><span style="font-family:宋体; font-size:10pt;"  ><strong>一、</strong></span><span style="font-family:Times New Roman; font-size:7pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  ><strong>什么是控制面板</strong></span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 21pt;"  ><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >打开Windows的控制面板会看到类似的图像</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 21pt;"  ><img title="[转]Windows 控制面板编程 - Dsliu - Dspace"  src="pic/img767.ph.126.net_ppuuCl_ql5J34A9SSKYplg==_4915397518298514575.jpg"  alt=""  /><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p style="text-align: center; margin-left: 21pt;"  ><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >图一</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 21pt;"  ><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >双击其中的一个图标，会显示对话框，让用户来完成相应的软硬件设置工作。这就是我们看到的控制面板。那么如何开发控制面板程序呢？带着疑问在MSDN和google里搜索关键字"</span><span style="font-size:13pt;"  >Control Panel</span><span style="font-size:10pt;"  >"，就会找到相关的技术文章。这是我工作的方法：借鉴已有的资源。但实际情况是那样吗？我们可以跟着MSDN的讲述来一步一步深入下去。</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 21pt;"  ><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >经过挖掘，发现并不是exe文件（Windows Vista下支持exe的控制面板应用程序，并且微软建议做成exe文件），而是有着cpl后缀名的文件，在windows－&gt;system32下可以找到这样的文件。如果借助工具，Dependency Walker for Win32 (x86) 或dumpbin等就可以看到该文件导出了一些函数。</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 21pt;"  ><img title="[转]Windows 控制面板编程 - Dsliu - Dspace"  src="http://img.ph.126.net/DG34nuECAYTgOMMZObwGUQ==/2386626327530448009.jpg"  alt=""  /><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p style="text-align: center; margin-left: 21pt;"  ><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >图二</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 21pt;"  ><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >多观察几个这样的文件，发现导出的函数虽有差异，但其中都有CPLApplet函数被导出。这些特征与DLL的特征吻合。去MSDN上查阅CPLApplet函数的说明证明我们的猜测是正确的。可以说控制面板应该程序就是以CPL为后缀名并且一定要导出CPLApplet函数的dll文件。</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 21pt;"  ><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >对于具体的描述可以参考：</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 21pt;"  ><a rel="nofollow" href="http://msdn2.microsoft.com/en-us/library/bb776838%28VS.85%29.aspx"  ><span style="color:purple; font-family:宋体; font-size:10pt; text-decoration:underline;"  >http://msdn2.microsoft.com/en-us/library/bb776838(VS.85).aspx</span></a><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p style="margin-left: 21pt;"  ><span style="font-family:宋体; font-size:10pt;"  ><strong>二、</strong></span><span style="font-family:Times New Roman; font-size:7pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  ><strong>明确几个概念</strong></span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 42pt;"  ><span style="font-family:Wingdings; font-size:10pt;"  >?</span><span style="font-family:Times New Roman; font-size:7pt;"  >&nbsp; </span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  ><strong>控制面板管理程序：</strong>用于管理控制面板的程序，在桌面windows版本是CONTROL.EXE，在windows CE版本是CTLPNL.EXE，它们负责管理控制面板里的控制面板条目。简单的说，我们打开控制面板时，这些管理程序就在运行了。只不过我们看到的是挂上了Shell外观而已（<span style="color:red;"  >注：这是我的猜测，还没有找到依据</span>）。</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 42pt;"  ><span style="font-family:Wingdings; font-size:10pt;"  >?</span><span style="font-family:Times New Roman; font-size:7pt;"  >&nbsp; </span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  ><strong>控制面板条目（Control Panel Item）：</strong>在控制面板里看到的每个图标所对应的就是一个控制面板条目。</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 42pt;"  ><span style="font-family:Wingdings; font-size:10pt;"  >?</span><span style="font-family:Times New Roman; font-size:7pt;"  >&nbsp; </span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  ><strong>控制面板应用程序（Control Panel Application）：</strong>就是最终看到的CPL文件，一个控制面板应用程序可以实现几个控制面板条目。</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 21pt;"  >&nbsp; &nbsp;</p><p style="margin-left: 21pt;"  ><span style="font-family:宋体; font-size:10pt;"  ><strong>三、</strong></span><span style="font-family:Times New Roman; font-size:7pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  ><strong>控制面板应用程序的编写</strong></span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >编写控制面板应用程序，就是编写dll文件，在该文件中实现控制所需要的功能。这就涉及到一个不得不说的函数，没有它就无法完成控制面板程序的实现。该函数为CPLApplet。下面就该函数的参数等知识做些介绍。</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >函数：LONG CPLApplet（HWND hwndCPl<em>，</em>UINT msg, LPARAM lParam1, LPARAM lParam2）</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >函数CPLApplet是控制面板应用程序（Control Panel application）的入口点，它被控制面板管理程序（<span style="color:#4b4b4b;"  >control.exe 或</span>Ctlpnl.exe）自动调用，它是个回调函数（Callback），注意：CPL文件一定要把函数CPLApplet导出，这样控制面板才能找到程序的入口点。</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >当启动控制面板时，它会搜索Windows或System32或注册表的相应条目目录下的文件，并把以CPL作为扩展名的文件载入，它调用CPL文件的导出函数CPLApplet（），发送消息给该函数。所以，控制面板应用程序要处理控制面板发送过来的消息，即在函数CPLApplet中进行处理，该函数没有默认的行为。如果一个CPL文件中实现了多个控制面板程序，那么只会有一个CPLApplet函数，它负责所有的控制面板应用程序。</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >参数说明：</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >hwndCPl：控制面板管理程序或称为控制面板的窗口句柄，即为control.exe的窗口句柄。如果控制面板应用程序或其它窗口需要传递父窗口句柄，可以使用该参数。</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >Msg：发送到控制面板应用程序的消息，由控制面板管理程序发送。</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >lParam1：消息参数</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >lParam2：消息参数</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >函数的返回值依据消息的不同而不同。</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >应用程序要使用该函数需要包含头文件：cpl.h</span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p>&nbsp; &nbsp;</p><div><table style="border-collapse:collapse;"  border="0"  ><colgroup><col style="width:138px;"  /><col style="width:453px;"  /><tbody valign="top"  ><tr><td style="padding-left: 7px; padding-right: 7px; border-top:  solid black 1.0pt; border-left:  solid black 1.0pt; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-family:宋体; font-size:9pt;"  >消息名称</span></p></td><td style="padding-left: 7px; padding-right: 7px; border-top:  solid black 1.0pt; border-left:  none; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-family:宋体; font-size:9pt;"  >描述</span></p></td></tr><tr><td vAlign="middle"  style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid black 1.0pt; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="color:black; font-family:Arial Unicode MS; font-size:9pt;"  >CPL_INIT</span></p></td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-size:9pt;"  ><span style="font-family:Verdana;"  >&nbsp;</span><span style="font-family:宋体;"  >控制面板应用程序收到的第一个消息，通常在此处理全局初始化和内存分配。成功返回非</span><span style="font-family:Verdana;"  >0</span><span style="font-family:宋体;"  >，否则返回</span><span style="font-family:Verdana;"  >0</span><span style="font-family:宋体;"  >，此时控制面板管理程序终止和该应用程序的通信，并释放相应的</span><span style="font-family:Verdana;"  >CPL</span><span style="font-family:宋体;"  >文件。</span></span></p></td></tr><tr><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid black 1.0pt; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-family:Verdana; font-size:9pt;"  >CPL_GETCOUNT</span></p></td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-size:9pt;"  ><span style="font-family:宋体;"  >该消息紧接在</span><span style="font-family:Verdana;"  >CPL_INIT</span><span style="font-family:宋体;"  >消息之后被发送，它返回控制面板管理程序所能看到该</span><span style="font-family:Verdana;"  >CPL</span><span style="font-family:宋体;"  >文件中所包含的控制面板组件的数目，即该</span><span style="font-family:Verdana;"  >CPL</span><span style="font-family:宋体;"  >文件可以出现在控制面板中的图标的数目。</span></span></p></td></tr><tr><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid black 1.0pt; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-family:Verdana; font-size:9pt;"  >CPL_INQUIRE</span></p></td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-size:9pt;"  ><span style="font-family:宋体;"  >于</span><span style="font-family:Verdana;"  >CPL_GETCOUNT</span><span style="font-family:宋体;"  >之后被发送，为指定的控制面板条目提供信息。</span></span></p></td></tr><tr><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid black 1.0pt; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-family:Verdana; font-size:9pt;"  >CPL_NEWINQUIRE</span></p></td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-size:9pt;"  ><span style="font-family:宋体;"  >于</span><span style="font-family:Verdana;"  >CPL_GETCOUNT</span><span style="font-family:宋体;"  >之后被发送，与消息</span><span style="font-family:Verdana;"  >CPL_INQUIRE</span><span style="font-family:宋体;"  >完成的功能类似，只不过其实现要求<span style="color:#333333;"  >TNewCPLInfo结构指针，所包含的资源不提供缓存，所以控制面板启动的较慢，一般不建议处理该消息，除非特别必要，如要根据一定的条件动态的改变控制面板条目的图标、字符串等。</span></span></span></p></td></tr><tr><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid black 1.0pt; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-family:Verdana; font-size:9pt;"  >CPL_DBLCLK</span></p></td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-size:9pt;"  ><span style="font-family:宋体;"  >表明用户选定了一个控制面板条目，程序应该显示相应的对话框以便用户完成相应的任务。成功返回</span><span style="font-family:Verdana;"  >0</span><span style="font-family:宋体;"  >，否则，返回非</span><span style="font-family:Verdana;"  >0.</span></span></p></td></tr><tr><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid black 1.0pt; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-family:Verdana; font-size:9pt;"  >CPL_STOP</span></p></td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-size:9pt;"  ><span style="font-family:宋体;"  >控制面板管理程序关闭时被发送，控制面板应用程序在此时处理内存释放等动作。成功处理，返回</span><span style="font-family:Verdana;"  >0.</span></span></p></td></tr><tr><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid black 1.0pt; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-family:Verdana; font-size:9pt;"  >CPL_SELECT</span></p></td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-size:9pt;"  ><span style="font-family:宋体;"  >目前不被使用。只有</span><span style="font-family:Verdana;"  >Windows 95 </span><span style="font-family:宋体;"  >和</span><span style="font-family:Verdana;"  >Microsoft Windows NT 4.0</span><span style="font-family:宋体;"  >之前的系统使用。</span></span></p></td></tr><tr><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid black 1.0pt; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-family:Verdana; font-size:9pt;"  >CPL_STARTWPARMS</span></p></td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-size:9pt;"  ><span style="font-family:宋体;"  >该消息与</span><span style="font-family:Verdana;"  >CPL_DBLCLK</span><span style="font-family:宋体;"  >类似，但</span><span style="font-family:Verdana;"  >lParam<em>2</em></span><span style="font-family:宋体;"  ><em>指向</em></span><span style="font-family:Verdana;"  >LPCTSTR</span><span style="font-family:宋体;"  >，该消息在</span><span style="font-family:Verdana;"  >shell32.dll</span><span style="font-family:宋体;"  > version 5.0</span><span style="font-family:Verdana;"  >         </span><span style="font-family:宋体;"  >（</span><span style="font-family:Verdana;"  >Windows 2000 </span><span style="font-family:宋体;"  >，</span><span style="font-family:Verdana;"  >Windows Millennium Edition (Windows Me)</span><span style="font-family:宋体;"  >）及以后版本有效</span></span></p></td></tr><tr><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid black 1.0pt; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-family:Verdana; font-size:9pt;"  >CPL_EXIT</span></p></td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid black 1.0pt; border-right:  solid black 1.0pt;"  ><p><span style="font-size:9pt;"  ><span style="font-family:宋体;"  >于</span><span style="font-family:Verdana;"  >CPL_STOP</span><span style="font-family:宋体;"  >消息之后被发送，这是控制面板应用程序在释放资源的最后机会。成功处理返回</span><span style="font-family:Verdana;"  >0.</span></span></p></td></tr></table></div><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >CPL_INQUIRE：lParam1是以0为起点的整数，它是该CPL文件中所包含的控制面板条目的索引，lParam2参数要求一个CPLINFO结构的指针，用来填充所需的图标、字符串等信息。如果成功处理了该消息，应该返回0。</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >CPL_NEWINQUIRE：该消息与CPL_INQUIRE都是CPL_GETCOUNT之后被发送的消息，但并没有明确的先后顺序。所以程序里不要依赖它们的顺序来处理不同的事务。</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >编写控制面板应用程序的步骤：</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >1 选择适当的开发工具（如：Visual Studio 2008），建立DLL项目；</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >2 导出函数CPLApplet；</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >3 在函数CPLApplet的消息处理过程中完成你需要的工作；</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >一个简单的例子</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-size:10pt;"  ><span style="font-family:宋体;"  >开发工具：</span><span style="font-family:Arial Unicode MS;"  >Microsoft Visual Studio 2008</span></span><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p><span style="font-size:10pt;"  ><span style="font-family:宋体;"  >操作系统：</span><span style="font-family:Arial Unicode MS;"  >Windows XP SP2</span></span><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >步骤：</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-size:10pt;"  ><span style="font-family:Arial Unicode MS;"  >1 </span><span style="font-family:宋体;"  >新建</span><span style="font-family:Arial Unicode MS;"  >Win32 Project,</span><span style="font-family:宋体;"  >工程名为</span><span style="font-family:Arial Unicode MS;"  >CPLTest</span></span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >；</span><span style="font-size:12pt;"  >    </span></span></p><p><img title="[转]Windows 控制面板编程 - Dsliu - Dspace"  src="pic/img.ph.126.net_ox1Omh762u0tz6SksBPslg==_3390084619504572043.jpg"  alt=""  /><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p><span style="font-size:10pt;"  ><span style="font-family:Arial Unicode MS;"  >2 </span><span style="font-family:宋体;"  >应用程序类型选择</span><span style="font-family:Arial Unicode MS;"  >DLL</span><span style="font-family:宋体;"  >（</span><span style="font-family:Arial Unicode MS;"  >CPL</span><span style="font-family:宋体;"  >文件本质上是</span><span style="font-family:Arial Unicode MS;"  >DLL</span></span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >）；</span><span style="font-size:12pt;"  >    </span></span></p><p><img title="[转]Windows 控制面板编程 - Dsliu - Dspace"  src="pic/img.ph.126.net_YcLoQorSE_FFJKerTZGs8w==_3380795945273012593.jpg"  alt=""  /><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p><span style="font-family:Arial Unicode MS; font-size:10pt;"  >3 </span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >在项目中新增或导入一个图标文件和两个字符串资源，用于在控制面板管理程序中显示图标和提示；</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-size:10pt;"  ><span style="font-family:宋体;"  >在</span><span style="font-family:Arial Unicode MS;"  >Resource Files </span><span style="font-family:宋体;"  >上右键选择</span><span style="font-family:Arial Unicode MS;"  >Add</span><span style="font-family:宋体;"  >－</span><span style="font-family:Arial Unicode MS;"  >&gt;Resource</span><span style="font-family:宋体;"  >，然后选择</span><span style="font-family:Arial Unicode MS;"  >Icon</span><span style="font-family:宋体;"  >或</span><span style="font-family:Arial Unicode MS;"  >String Table</span></span><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p><span style="font-family:宋体;"  ><span style="color:blue; font-size:9pt;"  >以下为resource.h 的部分内容</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:微软雅黑; font-size:9pt;"  ><span style="color:blue;"  >#define</span>    <span style="color:#020002;"  >IDI_ICON1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 101 //图标标识</span><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p><span style="font-family:微软雅黑; font-size:9pt;"  ><span style="color:blue;"  >#define</span>    <span style="color:#020002;"  >IDS_STRING102</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 102 //字符串tom</span><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p><span style="font-family:微软雅黑; font-size:9pt;"  ><span style="color:blue;"  >#define</span>    <span style="color:#020002;"  >IDS_STRING103</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 103//字符串cui</span><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p><span style="font-size:10pt;"  ><span style="font-family:Arial Unicode MS;"  >4 </span><span style="font-family:宋体;"  >在</span><span style="font-family:Arial Unicode MS;"  >dllmain.cpp</span><span style="font-family:宋体;"  >文件中增加函数的导出</span><span style="font-family:Arial Unicode MS;"  >CPLApplet</span></span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >；</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  ><span style="color:blue;"  >extern</span>     <span style="color:#a31515;"  >"C"</span>     <span style="color:blue;"  >__declspec</span>(<span style="color:blue;"  >dllexport</span>) <span style="color:#020002;"  >LONG</span>&nbsp; <span style="color:#020002;"  >APIENTRY</span>     <span style="color:#020002;"  >CPlApplet</span>(<span style="color:#020002;"  >HWND</span>     <span style="color:#020002;"  >hwndCPL</span>, <span style="color:#020002;"  >UINT</span>     <span style="color:#020002;"  >uMsg</span>, <span style="color:#020002;"  >LPARAM</span>     <span style="color:#020002;"  >lParam1</span>, <span style="color:#020002;"  >LPARAM</span>     <span style="color:#020002;"  >lParam2</span>);</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >原则上可以按照上面的方式导出就可以了，但是请注意<span style="color:#020002;"  >CPlApplet的调用方式是APIENTRY，通过这样方式导出的函数会被改名，通过多次实验也不可行。你可能会上去掉APIENTRY，但这样编出来的CPL文件无法运行，查阅了相关文档，在<span style="color:black;"  >Windows Mobile Version 5.0 SDK的文档里指明了该函数的调用方式，windows CE 5.0 和Windows Shell and Controls没有指明这种调用方式。所以，只有加上<span style="color:#020002;"  >APIENTRY。</span></span></span></span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="color:#020002; font-size:10pt;"  >现在的问题是如何导出该函数？看来要通过DEF文件了，如果你的项目里没有产生DEF文件，可以通过Project-&gt;Properties-&gt;Linker-&gt;Module Definition File来指定或自己用记事本建立这样的文件，输入如下内容。</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >; CPLTest.def : Declares the module parameters for the DLL.</span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >LIBRARY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "CPLTest"</span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >EXPORTS</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp; ; Explicit exports can go here</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >CPlApplet</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-size:9pt;"  ><span style="font-family:Arial Unicode MS;"  >5 </span><span style="font-family:宋体;"  >在</span><span style="font-family:Arial Unicode MS;"  >dllmain.cpp</span><span style="font-family:宋体;"  >文件中增加函数</span><span style="font-family:Arial Unicode MS;"  >CPLApplet</span></span><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >的消息处理函数来完成指定的功能；</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-size:9pt;"  ><span style="font-family:宋体;"  >在</span><span style="font-family:Arial Unicode MS;"  >dllmain.cpp</span></span><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >中包含以上两个头文件</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:Arial Unicode MS; font-size:9pt;"  >#include "resource.h" //</span><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >资源标识</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:Arial Unicode MS; font-size:9pt;"  >#include &lt;Cpl.h&gt; //CPLApplet</span><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >函数要求的头文件</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-size:9pt;"  ><span style="font-family:宋体;"  >我的例子完成显示一个</span><span style="font-family:Arial Unicode MS;"  >MessageBox</span></span><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >的功能。</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:Arial Unicode MS; font-size:9pt;"  >dllmain.cpp</span><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >的完整代码：</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="color:green; font-size:9pt;"  >// dllmain.cpp : Defines the entry point for the DLL application.</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:微软雅黑; font-size:9pt;"  ><span style="color:blue;"  >#include</span>    <span style="color:#a31515;"  >"stdafx.h"</span></span><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p><span style="font-family:微软雅黑; font-size:9pt;"  ><span style="color:blue;"  >#include</span>    <span style="color:#a31515;"  >"resource.h"</span></span><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p><span style="font-family:微软雅黑; font-size:9pt;"  ><span style="color:blue;"  >#include</span>    <span style="color:#a31515;"  >&lt;Cpl.h&gt;</span></span><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:微软雅黑; font-size:9pt;"  ><span style="color:#020002;"  >LONG</span>&nbsp; <span style="color:#020002;"  >APIENTRY</span>    <span style="color:#020002;"  >CPlApplet</span>(<span style="color:#020002;"  >HWND</span>    <span style="color:#020002;"  >hwndCPL</span>, <span style="color:#020002;"  >UINT</span>    <span style="color:#020002;"  >uMsg</span>, <span style="color:#020002;"  >LPARAM</span>    <span style="color:#020002;"  >lParam1</span>, <span style="color:#020002;"  >LPARAM</span>    <span style="color:#020002;"  >lParam2</span>);</span><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:微软雅黑; font-size:9pt;"  ><span style="color:#020002;"  >BOOL</span>    <span style="color:#020002;"  >APIENTRY</span>    <span style="color:#020002;"  >DllMain</span>( <span style="color:#020002;"  >HMODULE</span>    <span style="color:#020002;"  >hModule</span>,</span><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#020002;"  >DWORD</span>&nbsp; <span style="color:#020002;"  >ul_reason_for_call</span>,</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#020002;"  >LPVOID</span>     <span style="color:#020002;"  >lpReserved</span></span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;)</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >{</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >switch</span> (<span style="color:#020002;"  >ul_reason_for_call</span>)</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >case</span>     <span style="color:#020002;"  >DLL_PROCESS_ATTACH</span>:</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >case</span>     <span style="color:#020002;"  >DLL_THREAD_ATTACH</span>:</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >case</span>     <span style="color:#020002;"  >DLL_THREAD_DETACH</span>:</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >case</span>     <span style="color:#020002;"  >DLL_PROCESS_DETACH</span>:</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >break</span>;</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >return</span>     <span style="color:#020002;"  >TRUE</span>;</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >}</span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:微软雅黑; font-size:9pt;"  ><span style="color:#020002;"  >LONG</span>    <span style="color:#020002;"  >APIENTRY</span>&nbsp; <span style="color:#020002;"  >CPlApplet</span>(<span style="color:#020002;"  >HWND</span>    <span style="color:#020002;"  >hwndCPL</span>, <span style="color:#020002;"  >UINT</span>    <span style="color:#020002;"  >uMsg</span>, <span style="color:#020002;"  >LPARAM</span>    <span style="color:#020002;"  >lParam1</span>, <span style="color:#020002;"  >LPARAM</span>    <span style="color:#020002;"  >lParam2</span>)</span><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >{</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >int</span>     <span style="color:#020002;"  >i</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#020002;"  >LPCPLINFO</span>     <span style="color:#020002;"  >lpCPlInfo</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#020002;"  >i</span> = (<span style="color:blue;"  >int</span>) <span style="color:#020002;"  >lParam1</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >switch</span> (<span style="color:#020002;"  >uMsg</span>) { </span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >case</span>     <span style="color:#020002;"  >CPL_INIT</span>: <span style="color:green;"  >// first message, sent once </span></span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >return</span>     <span style="color:#020002;"  >TRUE</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >case</span>     <span style="color:#020002;"  >CPL_GETCOUNT</span>: <span style="color:green;"  >// second message, sent once </span></span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >return</span> 1; </span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >break</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >case</span>     <span style="color:#020002;"  >CPL_INQUIRE</span>: <span style="color:green;"  >// third message, sent once per application </span></span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#020002;"  >lpCPlInfo</span> = (<span style="color:#020002;"  >LPCPLINFO</span>) <span style="color:#020002;"  >lParam2</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#020002;"  >lpCPlInfo</span>-&gt;<span style="color:#020002;"  >lData</span> = 0; </span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#020002;"  >lpCPlInfo</span>-&gt;<span style="color:#020002;"  >idIcon</span> = <span style="color:#020002;"  >IDI_ICON1</span>;</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#020002;"  >lpCPlInfo</span>-&gt;<span style="color:#020002;"  >idName</span> = <span style="color:#020002;"  >IDS_STRING102</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#020002;"  >lpCPlInfo</span>-&gt;<span style="color:#020002;"  >idInfo</span> = <span style="color:#020002;"  >IDS_STRING103</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >break</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >case</span>     <span style="color:#020002;"  >CPL_DBLCLK</span>: <span style="color:green;"  >// application icon double-clicked </span></span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#020002;"  >MessageBox</span>(<span style="color:#020002;"  >NULL</span>, <span style="color:#020002;"  >TEXT</span>(<span style="color:#a31515;"  >"Tom66"</span>), <span style="color:#020002;"  >TEXT</span>(<span style="color:#a31515;"  >"Cuei666"</span>), <span style="color:#020002;"  >MB_OK</span>);</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >break</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >case</span>     <span style="color:#020002;"  >CPL_STOP</span>: <span style="color:green;"  >// sent once per application before CPL_EXIT </span></span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >break</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >case</span>     <span style="color:#020002;"  >CPL_EXIT</span>: <span style="color:green;"  >// sent once before FreeLibrary is called </span></span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >break</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >default</span>: </span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >break</span>; </span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } </span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;"  >return</span> 0; </span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >}</span><span style="font-size:12pt;"  >    </span></span></p><p>&nbsp; &nbsp;</p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >6 编译</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="color:#020002; font-size:10pt;"  >Project-&gt;Properties-&gt;Linker-&gt;Output File修改输出文件的后缀名为CPL，也可以不修改，到最后把dll改为cpl也可以的。</span><span style="font-size:12pt;"  >    </span></span></p><p><img title="[转]Windows 控制面板编程 - Dsliu - Dspace"  src="http://img.ph.126.net/p__zteOJfhHc4OtRGd13aA==/2386626327530448041.jpg"  alt=""  /><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p style="margin-left: 21pt;"  ><span style="font-family:Arial Unicode MS; font-size:10pt;"  ><strong>四、</strong></span><span style="font-family:Times New Roman; font-size:7pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  ><strong>控制面板应用程序的安装与运行</strong></span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 42pt;"  ><span style="font-family:Wingdings; font-size:10pt;"  >??</span><span style="font-family:Times New Roman; font-size:7pt;"  >&nbsp;</span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >将cpl文件拷贝到Windows（Windows CE）或Windows\system32(桌面版本Windows)，可以在这里双击运行，也可以打开控制面板就可以看到该CPL文件所包含的控制面板条目，图标和文件就是你在CPLApplet里指定的，双击也可运行。</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 42pt;"  ><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >2 在命令行下运行rundll32 shell32.dll,Control_RunDLL CPLTest.cpl（CPL文件名）@1(数字指定运行第几个控制面板条目，一个CPL文件可以包含几个控制面板条目)。在windows CE下，在命令行输入<span style="color:black;"  >ctlpnl.exe \windows\cplmain.cpl,5，与桌面版本有些差异。</span></span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 42pt;"  ><span style="font-family:Times New Roman; font-size:7pt;"  >3 &nbsp;&nbsp; </span><span style="font-family:宋体; font-size:10pt;"  >在windows的注册表[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Control Panel\Cpls] 下新建字符串，并指定cpl所在的完整路径，然后就可以在控制面板里看到新增加的控制面板条目。通过写注册表的方式，是一些应用软件惯用的方式，安装时可以通过</span><span style="font-family:Arial Unicode MS; font-size:9pt;"  >InstallShield</span><span style="font-family:宋体;"  ><span style="font-size:9pt;"  >等安装制作工具将其添加到注册表，卸载时，删除注册表中相</span><span style="font-size:10pt;"  >关的项。</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 42pt;"  ><img title="[转]Windows 控制面板编程 - Dsliu - Dspace"  src="pic/img.ph.126.net_EvhPhmx7ZEJYofsE_omVrA==_3294101652446505997.jpg"  alt=""  /><span style="font-family:宋体; font-size:12pt;"  >   </span></p><p style="margin-left: 42pt;"  ><span style="font-family:Times New Roman; font-size:7pt;"  >4 &nbsp;</span><span style="font-size:10pt;"  ><span style="font-family:宋体;"  >通过拷贝的方式，直接删除相应的</span><span style="font-family:Arial Unicode MS;"  >CPL</span></span><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >文件就可以了。至于有没有更好的方式，我还没有发现。</span><span style="font-size:12pt;"  >    </span></span></p><p style="margin-left: 42pt;"  >&nbsp; &nbsp;</p><p style="margin-left: 21pt;"  ><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >五、参考资料：</span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体;"  ><span style="font-size:10pt;"  >1 <a rel="nofollow" href="http://msdn2.microsoft.com/en-us/library/aa926276.aspx"  ><span style="color:purple; text-decoration:underline;"  >http://msdn2.microsoft.com/en-us/library/aa926276.aspx</span></a></span><span style="font-size:12pt;"  >    </span></span></p><p><span style="font-family:宋体; font-size:10pt;"  >2 <a rel="nofollow" href="http://msdn2.microsoft.com/en-us/library/bb776392.aspx"  ><span style="color:purple; text-decoration:underline;"  >http://msdn2.microsoft.com/en-us/library/bb776392.aspx</span></a><br><br>Add by myself<br>&nbsp;&nbsp;&nbsp; 通过修改注册表的方式，来安装 控制面板应用程序（Control panel application），必须在CPlApplet中响应CPL_INQUIRE消息，并在其中加载图标。 （LPCPLINFO-&gt;IdIcon），否则打开控制面板时，所安装应用程序的图标无法加载，无法显示。<br>&nbsp;&nbsp;&nbsp; 而通过拷贝文件至System32目录，则可以响应CPL_INQUIRE或者CPL_NEWINQUIRE，可以在其中的任意一个响应函数中load图标。</span></p>
</body></html>