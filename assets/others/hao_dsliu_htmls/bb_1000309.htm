<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：Cryptography Functions</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>Cryptography Functions</h2>
<p align="right">发布时间：2010-3-15 15:34
<br>分类名称：PKI</p><br>
<p><b><span lang="EN-US"  ><span style=""  >Base Cryptography Functions</span></span></b></p>  <p><span lang="EN-US"  ><span style=""  >Base cryptographic functions provide the most flexible means of developing cryptography applications. All communication with a cryptographic service provider (CSP) occurs through these functions.</span></span></p>  <p><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p><span lang="EN-US"  ><span style=""  >Base cryptographic functions are in the following broad groups:</span></span></p>  <p style="margin-left:31.5pt;text-indent:-21.0pt;  mso-char-indent-count:0;mso-list:l0 level1 lfo1;"  ><span lang="EN-US"  ><span style=""  >l</span><span style="font:7.0pt "Times New Roman";"  ><font face="Arial"  ><span style=""  >&nbsp; </span></font></span></span><span lang="EN-US"  ><span style=""  >Service Provider Functions </span></span></p>  <p style="margin-left:31.5pt;text-indent:-21.0pt;  mso-char-indent-count:0;mso-list:l0 level1 lfo1;"  ><span lang="EN-US"  ><span style=""  >l</span><span style="font:7.0pt "Times New Roman";"  ><font face="Arial"  ><span style=""  >&nbsp; </span></font></span></span><span lang="EN-US"  ><span style=""  >Key Generation and Exchange Functions </span></span></p>  <p style="margin-left:31.5pt;text-indent:-21.0pt;  mso-char-indent-count:0;mso-list:l0 level1 lfo1;"  ><span lang="EN-US"  ><span style=""  >l</span><span style="font:7.0pt "Times New Roman";"  ><font face="Arial"  ><span style=""  >&nbsp; </span></font></span></span><span lang="EN-US"  ><span style=""  >Object Encoding and Decoding Functions </span></span></p>  <p style="margin-left:31.5pt;text-indent:-21.0pt;  mso-char-indent-count:0;mso-list:l0 level1 lfo1;"  ><span lang="EN-US"  ><span style=""  >l</span><span style="font:7.0pt "Times New Roman";"  ><font face="Arial"  ><span style=""  >&nbsp; </span></font></span></span><span lang="EN-US"  ><span style=""  >Da<wbr>ta Encryption and Decryption Functions </span></span></p>  <p style="margin-left:31.5pt;text-indent:-21.0pt;  mso-char-indent-count:0;mso-list:l0 level1 lfo1;"  ><span lang="EN-US"  ><span style=""  >l</span><span style="font:7.0pt "Times New Roman";"  ><font face="Arial"  ><span style=""  >&nbsp; </span></font></span></span><span lang="EN-US"  ><span style=""  >Hash and Digital Signature Functions</span></span></p>  <p><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p><span style=""  >以下只是我的注释，详细信息见</span><span lang="EN-US"  ><span style=""  >MSDN</span></span><span style=""  >。</span><span lang="EN-US"  ><span style=""  ></span></span></p>  <p><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p><b><span lang="EN-US"  ><span style=""  >Service Provider Functions </span></span></b></p>  <p><span style=""  >以下俩函数是关于</span><span lang="EN-US"  ><span style=""  >Context</span></span><span style=""  >（上下文）的</span><span lang="EN-US"  ><span style=""  ></span></span></p>  <p><b><span lang="EN-US"  ><span style=""  >CryptAcquireContext</span></span></b><b><span lang="EN-US"  ><span style=""  ></span></span></b></p>  <p><span style=""  >获取特定</span><span lang="EN-US"  ><span style=""  >CSP</span></span><span style=""  >中的当前用户的密钥容器的句柄。当然根据其参数不同，它还可以删除创建容器等操作。</span><span lang="EN-US"  ><span style=""  ></span></span></p>  <p><span lang="EN-US"  ><span style=""  >Flags : </span><span style="color:red;"  ><span style=""  >CRYPT_VERIFYCONTEXT, CRYPT_NEWKEYSET, CRYPT_DELETEKEYSET</span></span></span></p>  <p><span lang="EN-US"  style="color: red;"  ><span style=""  >&nbsp;</span></span></p>  <p><b><span lang="EN-US"  ><span style=""  >CryptReleaseContext </span></span></b></p>  <p><span style=""  >释放句柄，类似于</span><span lang="EN-US"  ><span style=""  >CloseHandle</span></span><span style=""  >的功能，有引用计数的功能。</span><span lang="EN-US"  ><span style=""  ></span></span></p>  <p><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p><span style=""  >以下三个函数和注册表相关</span><span lang="EN-US"  ><span style=""  ></span></span></p>  <p><b><span lang="EN-US"  ><span style=""  >CryptEnumProviderTypes</span></span></b><span lang="EN-US"  ><span style=""  ></span></span></p>  <p><b><span lang="EN-US"  ><span style=""  >CryptGetDefaultProvider</span></span></b></p>  <p><b><span lang="EN-US"  ><span style=""  >CryptEnumProviders </span></span></b><span style=""  >枚举系统中的</span><span lang="EN-US"  ><span style=""  >CSP</span></span><span style=""  >。系统</span><span lang="EN-US"  ><span style=""  >CSP</span></span><span style=""  >信息在注册表中保存，路径为</span><span lang="EN-US"  ><span style=""  >HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography\Defaults\ Provider</span></span><span style=""  >。同样，我们可以利用注册表函数来写个枚举</span><span lang="EN-US"  ><span style=""  >Csp</span></span><span style=""  >的函数。</span><span lang="EN-US"  ><span style=""  ></span></span></p>  <p><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p><span style=""  >以下用来获取和设置</span><span lang="EN-US"  ><span style=""  >CSP</span></span><span style=""  >信息的。</span><span lang="EN-US"  ><span style=""  ></span></span></p>  <p><b><span lang="EN-US"  ><span style=""  >CryptGetProvParam</span></span></b></p>  <p><span style=""  >获取 管理员</span><span lang="EN-US"  ><span style=""  >PIN</span></span><span style=""  >，当前</span><span lang="EN-US"  ><span style=""  >Csp</span></span><span style=""  >上下文容器名称，枚举</span><span lang="EN-US"  ><span style=""  >Csp</span></span><span style=""  >支持的算法，枚举容器名称，实现类型（硬件、软件、硬件和软件、可移动设备、未知），获取当期</span><span lang="EN-US"  ><span style=""  >Csp</span></span><span style=""  >名称，当前</span><span lang="EN-US"  ><span style=""  >Csp</span></span><span style=""  >类型，当前</span><span lang="EN-US"  ><span style=""  >Csp</span></span><span style=""  >版本，</span><span lang="EN-US"  ><span style=""  ></span></span></p>  <p><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p><b><span lang="EN-US"  ><span style=""  >CryptSetProvParam</span></span></b></p>  <p><span style=""  >类似</span><span lang="EN-US"  ><span style=""  >CryptGetProvParam</span></span></p>  <p><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p><b><span lang="EN-US"  ><span style=""  >Key Generation and Exchange Functions</span></span></b></p>  <p><b><span lang="EN-US"  ><span style=""  >CryptDeriveKey</span></span></b></p>  <p><span style=""  >用来生成</span><span lang="EN-US"  ><span style=""  >session key</span></span><span style=""  >（此密钥为对称密钥，用来做加密大量数据用的），此函数能保证，通过同样的</span><span lang="EN-US"  ><span style=""  >Csp</span></span><span style=""  >和同样的算法，使用同样的数据（如密码等）能生成相同的</span><span lang="EN-US"  ><span style=""  >session key</span></span><span style=""  >。与</span><span lang="EN-US"  ><span style=""  >CryptGenKey</span></span><span style=""  >不同，</span><span lang="EN-US"  ><span style=""  >CryptGenKey</span></span><span style=""  >生成的是一个随机</span><span lang="EN-US"  ><span style=""  >key</span></span><span style=""  >。</span></p>  <p><span style=""  >生成的</span><span lang="EN-US"  ><span style=""  >Key handle</span></span><span style=""  >通常传入</span><span lang="EN-US"  ><span style=""  >CryptEncrypt</span></span><span style=""  >函数来加密文件。</span></p>  <p><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p><b><span lang="EN-US"  ><span style=""  >CryptDuplicateKey</span></span></b></p>  <p><span style=""  >复制</span><span lang="EN-US"  ><span style=""  >key</span></span></p>  <p><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p><b><span lang="EN-US"  ><span style=""  >CryptExportKey</span></span></b></p>  <p><span lang="EN-US"  ><span style=""  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1. Export PUBLICKEYBLOB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style=""  >无需加密传输，因为本身就是公开的</span></p>  <p><span lang="EN-US"  ><span style=""  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2. Export PRIVATEKEYBLOB&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style=""  >用</span><span lang="EN-US"  ><span style=""  >Session Key</span></span><span style=""  >来加密传输</span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span lang="EN-US"  ><span style=""  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3. Export SESSIONKEYBLOB&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style=""  >用</span><span lang="EN-US"  ><span style=""  >key exchange public key </span></span><span style=""  >来加密传输，这样只有目标能够解密该文件。</span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><b><span lang="EN-US"  ><span style=""  >CryptImp<wbr>ortKey</span></span></b></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><b><span lang="EN-US"  ><span style=""  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></b><span lang="EN-US"  ><span style=""  >1. Imp<wbr>ort session key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style=""  >加密传输</span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span lang="EN-US"  ><span style=""  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2. Imp<wbr>ort public key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style=""  >无需加密传输</span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span lang="EN-US"  ><span style=""  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3. Imp<wbr>ort public/private key pair&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style=""  >加密传输</span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><b><span lang="EN-US"  ><span style=""  >CryptGenKey</span></span></b></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span style=""  >用来产生随机密钥（对），</span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><b><span lang="EN-US"  ><span style=""  >CryptGenRandom</span></span></b></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span style=""  >创建随机数</span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><b><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></b></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><b><span lang="EN-US"  ><span style=""  >CryptGetUserKey</span></span></b></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span style=""  >获取交换密钥对或签名密钥对的句柄，仅仅适用于与某</span><span lang="EN-US"  ><span style=""  >CSP</span></span><span style=""  >关联的容器存在。</span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><b><span lang="EN-US"  ><span style=""  >CryptGetKeyParam</span></span></b></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><b><span lang="EN-US"  ><span style=""  >CryptSetKeyParam</span></span></b></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><b><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></b></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><b><span lang="EN-US"  ><span style=""  >CryptEncrypt</span></span></b></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span lang="EN-US"  ><span style=""  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style=""  >加密数据。可以使用对称密钥和非对称密钥加密。密钥句柄由</span><span lang="EN-US"  ><span style=""  >CryptGenKey, CryptImp<wbr>ortkey, CryptGetUserKey</span></span><span style=""  >来获取。当使用的是非对称密钥对时，通常使用</span><span lang="EN-US"  ><span style=""  >key pair </span></span><span style=""  >中的</span><span lang="EN-US"  ><span style=""  >public key </span></span><span style=""  >加密数据。</span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span lang="EN-US"  ><span style=""  >&nbsp;</span></span></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><b><span lang="EN-US"  ><span style=""  >CryptDecrypt</span></span></b></p>  <p style="margin-left:21.0pt;text-indent:-21.0pt;"  ><span lang="EN-US"  ><span style=""  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style=""  >当使用的是非对称密钥对时，通常使用</span><span lang="EN-US"  ><span style=""  >key pair </span></span><span style=""  >中的</span><span lang="EN-US"  ><span style=""  >private key </span></span><span style=""  >解密数据。</span></p>
</body></html>