<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：[转] Openssl之BIO系列(1)</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>[转] Openssl之BIO系列(1)</h2>
<p align="right">发布时间：2010-5-28 16:11
<br>分类名称：OpenSSL</p><br>
<h2><span style="font-size: 14px; font-weight: normal; line-height: 22px; color: rgb(63, 63, 63);"><h2 style="line-height: 33px;"><span lang="EN-US" style="line-height: 33px;">1.BIO-</span><span style="line-height: 33px; font-family: 黑体;">抽象的</span><span lang="EN-US" style="line-height: 33px;">IO</span><span style="line-height: 33px; font-family: 黑体;">接口</span><span lang="EN-US" style="line-height: 33px;"><o p style="line-height: 33px;"></o:p></span></h2><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">其实包含了很多种接口，用通用的函数接口，主要控制在</span><span lang="EN-US" style="line-height: 22px;">BIO_METHOD</span><span style="line-height: 22px; font-family: 宋体;">中的不同实现函数控制，我初步估计了一下，大概有</span><span lang="EN-US" style="line-height: 22px;">14</span><span style="line-height: 22px; font-family: 宋体;">种，包括</span><span lang="EN-US" style="line-height: 22px;">4</span><span style="line-height: 22px; font-family: 宋体;">种</span><span lang="EN-US" style="line-height: 22px;">filter</span><span style="line-height: 22px; font-family: 宋体;">型和</span><span lang="EN-US" style="line-height: 22px;">10</span><span style="line-height: 22px; font-family: 宋体;">种</span><span lang="EN-US" style="line-height: 22px;">source/sink</span><span style="line-height: 22px; font-family: 宋体;">型。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">是在底层覆盖了许多类型</span><span lang="EN-US" style="line-height: 22px;">I/O</span><span style="line-height: 22px; font-family: 宋体;">接口细节的一种应用接口，如果你在程序中使用</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，那么就可以和</span><span lang="EN-US" style="line-height: 22px;">SSL</span><span style="line-height: 22px; font-family: 宋体;">、非加密的网络以及文件</span><span lang="EN-US" style="line-height: 22px;">IO</span><span style="line-height: 22px; font-family: 宋体;">进行透明的连接。有两种不通的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">接口，一种是</span><span lang="EN-US" style="line-height: 22px;">source/sink</span><span style="line-height: 22px; font-family: 宋体;">型，一种是</span><span lang="EN-US" style="line-height: 22px;">fileter</span><span style="line-height: 22px; font-family: 宋体;">型。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">顾名思义，</span><span lang="EN-US" style="line-height: 22px;">source/sink</span><span style="line-height: 22px; font-family: 宋体;">类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">是数据源或输入数据源（我不知道</span><span lang="EN-US" style="line-height: 22px;">sink</span><span style="line-height: 22px; font-family: 宋体;">该怎么翻译），例如，</span><span lang="EN-US" style="line-height: 22px;">sokect BIO</span><span style="line-height: 22px; font-family: 宋体;">和文件</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">。而</span><span lang="EN-US" style="line-height: 22px;">filter BIO</span><span style="line-height: 22px; font-family: 宋体;">就是把数据从一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">转换到另外一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">或应用接口，在转换过程中，这些数据可以不修改（如信息摘要</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">），也可以进行转换。例如在加密</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中，如果写操作，数据就会被加密，如果是读操作，数据就会被解密。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">可以连接在一起成为一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链（单个的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">就是一个环节的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链的特例），如下是</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的结构定义，可以看到它有上下环节的：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">struct bio_st<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">{<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO_METHOD *method;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">/* bio, mode, argp, argi, argl, ret */<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">long (*callback)(struct bio_st *,int,const char *,int, long,long);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">char *cb_arg; /* first argument for the callback */<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;">&nbsp;</o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int init;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int shutdown;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int flags; /* extra storage */<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int retry_reason;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int num;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">void *ptr;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">struct bio_st *next_bio; /* used by filter BIOs */BIO</span><span style="line-height: 22px; font-family: 宋体;">下联</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">struct bio_st *prev_bio; /* used by filter BIOs */BIO</span><span style="line-height: 22px; font-family: 宋体;">上联</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int references;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">unsigned long num_read;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">unsigned long num_write;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;">&nbsp;</o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">CRYPTO_EX_DATA ex_data;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 22px;">};<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链通常包括一个</span><span lang="EN-US" style="line-height: 22px;">source BIO</span><span style="line-height: 22px; font-family: 宋体;">和一个或多个</span><span lang="EN-US" style="line-height: 22px;">filter BIO</span><span style="line-height: 22px; font-family: 宋体;">，数据从第一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">读出或写入，然后经过一系列</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">变化到输出（通常是一个</span><span lang="EN-US" style="line-height: 22px;">source/sink BIO</span><span style="line-height: 22px; font-family: 宋体;">）。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h2 style="line-height: 33px;"><span lang="EN-US" style="line-height: 33px;">2.BIO</span><span style="line-height: 33px; font-family: 黑体;">结构介绍</span><span lang="EN-US" style="line-height: 33px;"><o p style="line-height: 33px;"></o:p></span></h2><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的结构定义和相关项解析如下：（包含在</span><span lang="EN-US" style="line-height: 22px;">bio.h</span><span style="line-height: 22px; font-family: 宋体;">文件中，其主文件为</span><span lang="EN-US" style="line-height: 22px;">bio_lib.c</span><span style="line-height: 22px; font-family: 宋体;">）</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">typedef struct bio_st BIO;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;">&nbsp;</o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">struct bio_st<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">{<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO_METHOD *method;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">/*BIO</span><span style="line-height: 22px; font-family: 宋体;">方法结构，是决定</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">类型和行为的重要参数，各种</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的不同之处主要也正在于此项。</span><span lang="EN-US" style="line-height: 22px;">*/<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">/* bio, mode, argp, argi, argl, ret */<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">long (*callback)(struct bio_st *,int,const char *,int, long,long); //BIO</span><span style="line-height: 22px; font-family: 宋体;">回调函数</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">char *cb_arg; /* first argument for the callback */ //</span><span style="line-height: 22px; font-family: 宋体;">回调函数的第一个参量</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;">&nbsp;</o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int init; //</span><span style="line-height: 22px; font-family: 宋体;">初始化标志，初始化了为</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，否则为</span><span lang="EN-US" style="line-height: 22px;">0<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int shutdown; //BIO</span><span style="line-height: 22px; font-family: 宋体;">开关标志，如果为</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，则处于关闭状态，如果为</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">，则处于打开的状态。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int flags; /* extra storage */<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int retry_reason;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int num;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">void *ptr;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">struct bio_st *next_bio; /* used by filter BIOs */BIO</span><span style="line-height: 22px; font-family: 宋体;">下联</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">struct bio_st *prev_bio; /* used by filter BIOs */BIO</span><span style="line-height: 22px; font-family: 宋体;">上联</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int references;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">unsigned long num_read;//</span><span style="line-height: 22px; font-family: 宋体;">读出的数据长度</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">unsigned long num_write;//</span><span style="line-height: 22px; font-family: 宋体;">写入的数据长度</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;">&nbsp;</o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">CRYPTO_EX_DATA ex_data;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 21pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 22px;">};<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">在</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的所用成员中，</span><span lang="EN-US" style="line-height: 22px;">method</span><span style="line-height: 22px; font-family: 宋体;">可以说是最关键的一个成员，它决定了</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的类型，可以看到，在声明一个新的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">结构时，总是使用下面的声明：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p align="center" style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-align: center;"><span lang="EN-US" style="line-height: 22px;">BIO* BIO_new(BIO_METHOD *type);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">在源代码可以看出，</span><span lang="EN-US" style="line-height: 22px;">BIO_new</span><span style="line-height: 22px; font-family: 宋体;">函数除了给一些初始变量赋值外，主要就是把</span><span lang="EN-US" style="line-height: 22px;">type</span><span style="line-height: 22px; font-family: 宋体;">中的各个变量赋值给</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">结构中的</span><span lang="EN-US" style="line-height: 22px;">method</span><span style="line-height: 22px; font-family: 宋体;">成员。一般来说，上述</span><span lang="EN-US" style="line-height: 22px;">type</span><span style="line-height: 22px; font-family: 宋体;">参数是以一个类型生成函数的形式提供的，如生成一个</span><span lang="EN-US" style="line-height: 22px;">mem</span><span style="line-height: 22px; font-family: 宋体;">型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">结构，就使用下面的语句：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p align="center" style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-align: center;"><span lang="EN-US" style="line-height: 22px;">BIO *mem = BIO_new(BIO_s_mem());<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">这样的函数有以下一些：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">2.1 source/sink</span><span style="line-height: 25px; font-family: 宋体;">型</span><span lang="EN-US" style="line-height: 25px;"><o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">1.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_s_accept()</span><span style="line-height: 22px; font-family: 宋体;">：是一个封装了类似</span><span lang="EN-US" style="line-height: 22px;">TCP/IP socket Accept</span><span style="line-height: 22px; font-family: 宋体;">规则的接口，并且使</span><span lang="EN-US" style="line-height: 22px;">TCP/IP</span><span style="line-height: 22px; font-family: 宋体;">操作对于</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">接口是透明的。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">2.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_s_bio()</span><span style="line-height: 22px; font-family: 宋体;">：封装了一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">对，数据从其中一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">写入，从另外一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">读出</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">3.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_s_connect()</span><span style="line-height: 22px; font-family: 宋体;">：是一个封装了类似</span><span lang="EN-US" style="line-height: 22px;">TCP/IP socket Connect</span><span style="line-height: 22px; font-family: 宋体;">规则的接口，并且使</span><span lang="EN-US" style="line-height: 22px;">TCP/IP</span><span style="line-height: 22px; font-family: 宋体;">操作对于</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">接口是透明的</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">4.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_s_fd()</span><span style="line-height: 22px; font-family: 宋体;">：是一个封装了文件描述符的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">接口，提供类似文件读写操作的功能</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">5.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_s_file()</span><span style="line-height: 22px; font-family: 宋体;">：封装了标准的文件接口的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，包括标志的输入输出设备如</span><span lang="EN-US" style="line-height: 22px;">stdin</span><span style="line-height: 22px; font-family: 宋体;">等</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">6.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_s_mem()</span><span style="line-height: 22px; font-family: 宋体;">：封装了内存操作的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">接口，包括了对内存的读写操作</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">7.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_s_null()</span><span style="line-height: 22px; font-family: 宋体;">：返回空的</span><span lang="EN-US" style="line-height: 22px;">sink</span><span style="line-height: 22px; font-family: 宋体;">型</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">接口，写入这种接口的所有数据读被丢弃，读的时候总是返回</span><span lang="EN-US" style="line-height: 22px;">EOF<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">8.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_s_socket()</span><span style="line-height: 22px; font-family: 宋体;">：封装了</span><span lang="EN-US" style="line-height: 22px;">socket</span><span style="line-height: 22px; font-family: 宋体;">接口的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">类型</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">2.2 filter</span><span style="line-height: 25px; font-family: 宋体;">型</span><span lang="EN-US" style="line-height: 25px;"><o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">1.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_f_base64()</span><span style="line-height: 22px; font-family: 宋体;">：封装了</span><span lang="EN-US" style="line-height: 22px;">base64</span><span style="line-height: 22px; font-family: 宋体;">编码方法的</span><span lang="EN-US" style="line-height: 22px;">BIO,</span><span style="line-height: 22px; font-family: 宋体;">写的时候进行编码，读的时候解码</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">2.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_f_buffer()</span><span style="line-height: 22px; font-family: 宋体;">：封装了缓冲区操作的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，写入该接口的数据一般是准备传入下一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">接口的，从该接口读出的数据一般也是从另一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">传过来的。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">3.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_f_cipher()</span><span style="line-height: 22px; font-family: 宋体;">：封装了加解密方法的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，写的时候加密，读的时候解密</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">4.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_f_md()</span><span style="line-height: 22px; font-family: 宋体;">：封装了信息摘要方法的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，通过该接口读写的数据都是已经经过摘要的。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">5.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_f_null()</span><span style="line-height: 22px; font-family: 宋体;">：一个不作任何事情的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，对它的操作都简单传到下一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">去了，相当于不存在。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">6.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_f_ssl()</span><span style="line-height: 22px; font-family: 宋体;">：封装了</span><span lang="EN-US" style="line-height: 22px;">openssl&nbsp;</span><span style="line-height: 22px; font-family: 宋体;">的</span><span lang="EN-US" style="line-height: 22px;">SSL</span><span style="line-height: 22px; font-family: 宋体;">协议的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">类型，也就是为</span><span lang="EN-US" style="line-height: 22px;">SSL</span><span style="line-height: 22px; font-family: 宋体;">协议增加了一些</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">操作方法。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 18pt;"><span style="line-height: 22px; font-family: 宋体;">上述各种类型的函数正是构成</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">强大功能的基本单元，所以，要了解</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的各种结构和功能，也就应该了解这些函数类型相关的操作函数。所有这些源文件，都基本上包含于</span><span lang="EN-US" style="line-height: 22px;">/crypto/bio/</span><span style="line-height: 22px; font-family: 宋体;">目录下的同名</span><span lang="EN-US" style="line-height: 22px;">.c</span><span style="line-height: 22px; font-family: 宋体;">文件（大部分是同名的）中。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 18pt;"><span style="line-height: 22px; font-family: 宋体;">在</span><span lang="EN-US" style="line-height: 22px;">BIO_METHOD</span><span style="line-height: 22px; font-family: 宋体;">里面，定义了一组行为函数，上述不同类型的</span><span lang="EN-US" style="line-height: 22px;">BIO_METHOD</span><span style="line-height: 22px; font-family: 宋体;">行为函数的定义是不同的，其结构如下（以非</span><span lang="EN-US" style="line-height: 22px;">16</span><span style="line-height: 22px; font-family: 宋体;">位系统为例）：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 18pt;"><span lang="EN-US" style="line-height: 22px;">typedef struct bio_method_st<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 18pt;"><span lang="EN-US" style="line-height: 22px;">{<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int type;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">const char *name;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int (*bwrite)(BIO *, const char *, int);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int (*bread)(BIO *, char *, int);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int (*bputs)(BIO *, const char *);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int (*bgets)(BIO *, char *, int);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">long (*ctrl)(BIO *, int, long, void *);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int (*create)(BIO *);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int (*destroy)(BIO *);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">long (*callback_ctrl)(BIO *, int, bio_info_cb *);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 22px;">} BIO_METHOD;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 18pt;"><span style="line-height: 22px; font-family: 宋体;">在</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的成员中，</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">也是比较重要的，它能够用于程序调试用或者自定义改变</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的行为。详细会在以后相关的部分介绍。</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的很多操作，都是</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">系列函数根据不同参数组成的宏定义来完成的。所以要了解</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的行为，了解</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">系列函数以及其各个参数的意义也是很重要的。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">2.3 BIO</span><span style="line-height: 25px; font-family: 宋体;">目录文件的简要说明</span><span lang="EN-US" style="line-height: 25px;"><o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">1.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">bio.h</span><span style="line-height: 22px; font-family: 宋体;">：主定义的头文件，包括了很多通用的宏的定义。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">2.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">bio_lib.c</span><span style="line-height: 22px; font-family: 宋体;">主要的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">操作定义文件，是比较上层的函数了。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">3.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">bss_*</span><span style="line-height: 22px; font-family: 宋体;">系列：是</span><span lang="EN-US" style="line-height: 22px;">soruce/sink</span><span style="line-height: 22px; font-family: 宋体;">型</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">具体的操作实现文件</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">4.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">bf_*</span><span style="line-height: 22px; font-family: 宋体;">系列：是</span><span lang="EN-US" style="line-height: 22px;">filter</span><span style="line-height: 22px; font-family: 宋体;">型</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">具体的操作实现文件</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">5.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">bio_err.c:</span><span style="line-height: 22px; font-family: 宋体;">是错误信息处理文件</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">6.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">bio_cb.c</span><span style="line-height: 22px; font-family: 宋体;">：是</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数的相关文件</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">7.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">b_print.c:</span><span style="line-height: 22px; font-family: 宋体;">是信息输出的处理函数文件</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">8.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">b_socket.c:</span><span style="line-height: 22px; font-family: 宋体;">是</span><span lang="EN-US" style="line-height: 22px;">Socket</span><span style="line-height: 22px; font-family: 宋体;">连接的一些相关信息处理文件</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">9.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">b_dump.c:</span><span style="line-height: 22px; font-family: 宋体;">是对内存内容的存储操作处理</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h2 style="line-height: 33px;"><span lang="EN-US" style="line-height: 33px;">3.BIO</span><span style="line-height: 33px; font-family: 黑体;">的声明和释放等基本操作</span><span lang="EN-US" style="line-height: 33px;"><o p style="line-height: 33px;"></o:p></span></h2><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">在</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的基本操作系列函数中，他们用来</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">分配和释放操作，其声明形式如下（</span><span lang="EN-US" style="line-height: 22px;">openssl/bio.h</span><span style="line-height: 22px; font-family: 宋体;">）：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO * BIO_new(BIO_METHOD *type);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_set(BIO *a,BIO_METHOD *type);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_free(BIO *a);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">void BIO_vfree(BIO *a);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">void BIO_free_all(BIO *a);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">下面分别对这些函数进行解释：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">3.1 BIO_new<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">这个函数创建并返回一个相应的新的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，并根据给定的</span><span lang="EN-US" style="line-height: 22px;">BIO_METHOD</span><span style="line-height: 22px; font-family: 宋体;">类型调用下述的</span><span lang="EN-US" style="line-height: 22px;">BIO_set()</span><span style="line-height: 22px; font-family: 宋体;">函数给</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">结构的</span><span lang="EN-US" style="line-height: 22px;">method</span><span style="line-height: 22px; font-family: 宋体;">成员赋值，如果创建或给</span><span lang="EN-US" style="line-height: 22px;">method</span><span style="line-height: 22px; font-family: 宋体;">赋值失败，则返回</span><span lang="EN-US" style="line-height: 22px;">NULL</span><span style="line-height: 22px; font-family: 宋体;">。创建一个</span><span lang="EN-US" style="line-height: 22px;">Memory</span><span style="line-height: 22px; font-family: 宋体;">类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">例子如下：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p align="center" style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-align: center;"><span lang="EN-US" style="line-height: 22px;">BIO* mem=BIO_new(BIO_s_mem());<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">有些类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">使用</span><span lang="EN-US" style="line-height: 22px;">BIO_new()</span><span style="line-height: 22px; font-family: 宋体;">函数之后就可以直接使用了，如</span><span lang="EN-US" style="line-height: 22px;">memory</span><span style="line-height: 22px; font-family: 宋体;">类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">；而有些</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">创建之后还需要一些初始化工作，如文件</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">。一般来说，也提供了这样的一些函数来创建和初始化这种类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">这是什么意思呢，举个简单的例子大家就明白了。比如创建一个文件</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，使用下面的代码：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO* in=NULL;<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">in=BIO_new(BIO_s_file());<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO_read_filename(in,"rsa512.pem");<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">这样，</span><span lang="EN-US" style="line-height: 22px;">BIO in</span><span style="line-height: 22px; font-family: 宋体;">才能使用，而如果是创建一个</span><span lang="EN-US" style="line-height: 22px;">memory</span><span style="line-height: 22px; font-family: 宋体;">类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，则只需要如下一句代码：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO* mem=BIO_new(BIO_s_mem());<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">然后就可以对该</span><span lang="EN-US" style="line-height: 22px;">BIO mem</span><span style="line-height: 22px; font-family: 宋体;">进行操作了。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">另外，需要补充的是（这个大家从前面两篇文章可能已经认识到了），对于</span><span lang="EN-US" style="line-height: 22px;">source/sink</span><span style="line-height: 22px; font-family: 宋体;">类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，其类型创建函数一般为</span><span lang="EN-US" style="line-height: 22px;">BIO_s_*</span><span style="line-height: 22px; font-family: 宋体;">的形式，对于</span><span lang="EN-US" style="line-height: 22px;">filter</span><span style="line-height: 22px; font-family: 宋体;">型的函数，其类型创建函数一般为</span><span lang="EN-US" style="line-height: 22px;">BIO_f_*</span><span style="line-height: 22px; font-family: 宋体;">的形式。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">3.2 BIO_set<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数功能比较简单，就是对一个已经存在的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">设置新的</span><span lang="EN-US" style="line-height: 22px;">BIO_METHOD</span><span style="line-height: 22px; font-family: 宋体;">类型。其实就是简单的对</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的各个成员进行初始化，并将参数</span><span lang="EN-US" style="line-height: 22px;">type</span><span style="line-height: 22px; font-family: 宋体;">赋值给该</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">。其实，</span><span lang="EN-US" style="line-height: 22px;">BIO_new</span><span style="line-height: 22px; font-family: 宋体;">函数在使用</span><span lang="EN-US" style="line-height: 22px;">OPENSSL_malloc</span><span style="line-height: 22px; font-family: 宋体;">给</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">分配了内存之后，就简单调用了</span><span lang="EN-US" style="line-height: 22px;">BIO_set</span><span style="line-height: 22px; font-family: 宋体;">函数进行初始化工作。所以一般来说，除非你要重新设置你已经存在的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，否则是不需要直接调用这个函数的。成功操作返回</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，否则返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">3.3 BIO_free<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数释放单个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的内存和资源，成功操作返回</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，失败返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的操作不仅仅是释放</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">结构所占用的资源，也会释放其下层的</span><span lang="EN-US" style="line-height: 22px;">I/O</span><span style="line-height: 22px; font-family: 宋体;">资源，比如关闭释放相关的文件符等，这对不同类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">是不一样的，详细的请参看各种类型</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">本身的说明文件和源文件。需要注意的是，</span><span lang="EN-US" style="line-height: 22px;">BIO_free</span><span style="line-height: 22px; font-family: 宋体;">只释放当前的一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，如果用来释放一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链，就可能会导致内存泄漏，这种情况应该使用下述的</span><span lang="EN-US" style="line-height: 22px;">BIO_free_all</span><span style="line-height: 22px; font-family: 宋体;">函数。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">3.4 BIO_vfree<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数功能与</span><span lang="EN-US" style="line-height: 22px;">BIO_free</span><span style="line-height: 22px; font-family: 宋体;">完全相同，只是没有返回值。事实上，它简单调用了</span><span lang="EN-US" style="line-height: 22px;">BIO_free</span><span style="line-height: 22px; font-family: 宋体;">函数，但不返回该函数的返回值，所以它的函数实现代码只有一个语句。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">3.5 BIO_free_all<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数释放这个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链，并且即使在这个过程中，如果释放其中一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">出错，释放过程也不会停止，会继续释放下面的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，这保证了尽量避免内存泄漏的出现。如果你非要调用这个函数释放单个的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，那么效果跟</span><span lang="EN-US" style="line-height: 22px;">BIO_free</span><span style="line-height: 22px; font-family: 宋体;">是一样的。事实上，该函数只是简单的遍历整个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链，并调用</span><span lang="EN-US" style="line-height: 22px;">BIO_free</span><span style="line-height: 22px; font-family: 宋体;">释放各个环节的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h2 style="line-height: 33px;"><span lang="EN-US" style="line-height: 33px;">4.BIO</span><span style="line-height: 33px; font-family: 黑体;">控制函数介绍</span><span lang="EN-US" style="line-height: 33px;"><o p style="line-height: 33px;"></o:p></span></h2><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">控制函数有许多，并且不同的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">类型还有不同的控制函数，这里只简单介绍一些通用的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">控制函数，至于某种类型</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的特定控制函数，则参考后续的文件。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的通用控制函数有以下几种，其声明如下（</span><span lang="EN-US" style="line-height: 22px;">openssl/bio.h</span><span style="line-height: 22px; font-family: 宋体;">）：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">long BIO_ctrl(BIO *bp,int cmd,long larg,void *parg);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">long BIO_callback_ctrl(BIO *b, int cmd, void (*fp)(struct bio_st *, int, const char *, int, long, long));<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">char * BIO_ptr_ctrl(BIO *bp,int cmd,long larg);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">long BIO_int_ctrl(BIO *bp,int cmd,long larg,int iarg);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;">&nbsp;</o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_reset(BIO *b);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_seek(BIO *b, int ofs);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_tell(BIO *b);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_flush(BIO *b);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_eof(BIO *b);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_set_close(BIO *b,long flag);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_get_close(BIO *b);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_pending(BIO *b);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_wpending(BIO *b);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">size_t BIO_ctrl_pending(BIO *b);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">size_t BIO_ctrl_wpending(BIO *b);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">其实，在这些函数中，除了</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 22px;">BIO_callback_ctrl</span><span style="line-height: 22px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 22px;">BIO_ptr_ctrl,BIO_int_ctrl</span><span style="line-height: 22px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl_pending</span><span style="line-height: 22px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl_wpending</span><span style="line-height: 22px; font-family: 宋体;">是真正的函数外，其它都是宏定义，而且，在这些函数中，除了</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 22px;">BIO_callback_ctrl</span><span style="line-height: 22px; font-family: 宋体;">，其它基本上都是简单的</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">输入不同的参数的调用。下面就一个一个介绍这些函数。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">4.1 BIO_ctrl<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">从上面的叙述可以知道，</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">是整个控制函数中最基本的函数，它支持不同的命令输入，从而产生不同的功能，由此，它也就衍生了许多其它函数，作为一个比较地层的控制函数，一般来说用户并不需要直接调用它，因为在它之上已经使用宏定义和函数调用的形式建造了许多直接面向用户的函数。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">filter</span><span style="line-height: 22px; font-family: 宋体;">型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">没有定义</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">功能，如果对他们调用这个函数，他们就简单的把命令传到</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链中的下一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">。也就是说，通常可以不用直接调用一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">函数，只需要在它所在的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链上调用该函数，那么</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链就会自动将该调用函数传到相应的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">上去。这样可能就会导致一些意想不到的结果，比如，在目前的</span><span lang="EN-US" style="line-height: 22px;">filter</span><span style="line-height: 22px; font-family: 宋体;">型</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中没有实现</span><span lang="EN-US" style="line-height: 22px;">BIO_seek()</span><span style="line-height: 22px; font-family: 宋体;">函数（大家待会就会明白</span><span lang="EN-US" style="line-height: 22px;">BIO_seek</span><span style="line-height: 22px; font-family: 宋体;">就是</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">的简单宏定义），但如果在这个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链上的末尾是一个文件或文件描述符型</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，那么这个调用也会返回成功的结果。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">对于</span><span lang="EN-US" style="line-height: 22px;">source/sink</span><span style="line-height: 22px; font-family: 宋体;">型</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">来说，如果他们不认得</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">所定义的操作，那么就返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">4.2 BIO_callback_ctrl<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">这个函数是这组控制函数中唯一一个不是通过调用</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">建立起来的，它有自己的实现函数，而且跟</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">毫不相干。跟</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">一样，它也是比较底层的控制函数，在它上面也定义了一些直接面向用户的控制函数，一般来说，用户不需要直接调用该函数。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">需要说明的是，该函数和</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">函数为了实现不同类型</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">具有不同的</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">控制功能，他们的操作基本上都是由各个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数来定义的。这是不同的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">能灵活实现不同功能的根本所在。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">4.3 BIO_ptr_ctrl</span><span style="line-height: 25px; font-family: 宋体;">和</span><span lang="EN-US" style="line-height: 25px;">BIO_int_ctrl<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">这两个函数都是简单的调用了</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">函数，不同的是，后者是输入了四个参数并传入到</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">函数中，简单返回了调用</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">返回的返回值；而前者只输入了三个参数，最后一个</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">参数是作为输出参数并作为返回值的。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">4.4 BIO_reset<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数是</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">的宏定义函数，为了大家对</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">的宏定义函数有一个感性的认识，我把这个宏定义写出来，如下：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p align="center" style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-align: center;"><span lang="EN-US" style="line-height: 22px;">#define BIO_reset(b) (int)BIO_ctrl(b,BIO_CTRL_RESET,0,NULL)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">这就是</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">的典型宏定义方式，它通过这种方式产生了大量的控制函数。顾名思义，</span><span lang="EN-US" style="line-height: 22px;">BIO_reset</span><span style="line-height: 22px; font-family: 宋体;">函数只是简单的将</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的状态设回到初始化的时候的状态，比如文件</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，调用该函数就是将文件指针指向文件开始位置。一般来说，调用成功的时候该函数返回</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，失败的时候返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">或－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">；但是文件</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">是一个例外，成功调用的时候返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">，失败的时候返回－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">4.5 BIO_seek<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数也是</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">的宏定义函数，其定义如下：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p align="center" style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-align: center;"><span lang="EN-US" style="line-height: 22px;">#define BIO_seek(b,ofs) (int)BIO_ctrl(b,BIO_C_FILE_SEEK,ofs,NULL)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数将文件相关的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">（文件和文件描述符类型）的文件指针知道距离开始位置</span><span lang="EN-US" style="line-height: 22px;">ofs(</span><span style="line-height: 22px; font-family: 宋体;">输入参数</span><span lang="EN-US" style="line-height: 22px;">)</span><span style="line-height: 22px; font-family: 宋体;">字节的位置上。调用成功的时候，返回文件的位置指针，否则返回－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">；但是文件</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">例外，成功的时候返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">，失败的时候返回－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">4.6 BIO_tell<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数也是</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">的宏定义函数，其定义如下：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p align="center" style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-align: center;"><span lang="EN-US" style="line-height: 22px;">#define BIO_tell(b) (int)BIO_ctrl(b,BIO_C_FILE_TELL,0,NULL)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数返回了文件相关</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的当前文件指针位置。跟</span><span lang="EN-US" style="line-height: 22px;">BIO_seek</span><span style="line-height: 22px; font-family: 宋体;">一样，调用成功的时候，返回文件的位置指针，否则返回－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">；但是文件</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">例外，成功的时候返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">，失败的时候返回－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">4.7 BIO_flush<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数也是</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">的宏定义函数，其定义如下：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p align="center" style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-align: center;"><span lang="EN-US" style="line-height: 22px;">#define BIO_flush(b) (int)BIO_ctrl(b,BIO_CTRL_FLUSH,0,NULL)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数用来将</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">内部缓冲区的数据都写出去，有些时候，也用于为了根据</span><span lang="EN-US" style="line-height: 22px;">EOF</span><span style="line-height: 22px; font-family: 宋体;">查看是否还有数据可以写。调用成功的时候该函数返回</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，失败的时候返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">或－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">。之所以失败的时候返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">或者－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，是为了标志该操作是否需要稍后以跟</span><span lang="EN-US" style="line-height: 22px;">BIO_write()</span><span style="line-height: 22px; font-family: 宋体;">相同的方式重试。这时候，应该调用</span><span lang="EN-US" style="line-height: 22px;">BIO_should_retry()</span><span style="line-height: 22px; font-family: 宋体;">函数，当然，正常的情况下该函数的调用应该是失败的。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">4.8 BIO_eof<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数也是</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">的宏定义函数，其定义如下</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p align="center" style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-align: center;"><span lang="EN-US" style="line-height: 22px;">#define BIO_eof(b) (int)BIO_ctrl(b,BIO_CTRL_EOF,0,NULL)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">如果</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">读到</span><span lang="EN-US" style="line-height: 22px;">EOF</span><span style="line-height: 22px; font-family: 宋体;">，该函数返回</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，至于</span><span lang="EN-US" style="line-height: 22px;">EOF</span><span style="line-height: 22px; font-family: 宋体;">的具体定义，根据</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的类型各不相同。如果没有读到</span><span lang="EN-US" style="line-height: 22px;">EOF</span><span style="line-height: 22px; font-family: 宋体;">，该函数返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">4.9 BIO_set_close<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数也是</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">的宏定义函数，其定义如下：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">#define BIO_set_close(b,c) (int)BIO_ctrl(b,BIO_CTRL_SET_CLOSE,(c),NULL)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数设置</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的关闭标志，该标志可以为</span><span lang="EN-US" style="line-height: 22px;">BIO_CLOSE</span><span style="line-height: 22px; font-family: 宋体;">或</span><span lang="EN-US" style="line-height: 22px;">BIO_NOCLOSE</span><span style="line-height: 22px; font-family: 宋体;">。一般来说，该标志是为了指示在</span><span lang="EN-US" style="line-height: 22px;">source/sink</span><span style="line-height: 22px; font-family: 宋体;">型</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">释放该</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的时候是否关闭其下层的</span><span lang="EN-US" style="line-height: 22px;">I/O</span><span style="line-height: 22px; font-family: 宋体;">流。该函数总是返回</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">4.10 BIO_get_close<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数也是</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">的宏定义函数，其定义如下：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">#define BIO_get_close(b) (int)BIO_ctrl(b,BIO_CTRL_GET_CLOSE,0,NULL)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数读取</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的关闭标志，返回</span><span lang="EN-US" style="line-height: 22px;">BIO_CLOSE</span><span style="line-height: 22px; font-family: 宋体;">或</span><span lang="EN-US" style="line-height: 22px;">BIO_NOCLOSE</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">4.11 BIO_pending</span><span style="line-height: 25px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 25px;">BIO_wpending</span><span style="line-height: 25px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 25px;">BIO_ctrl_pending</span><span style="line-height: 25px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 25px;">BIO_ctrl_wpending<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">这些函数都是用来得到</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中读缓存或写缓存中字符的数目的，返回相应缓存中字符的数目。前面两个函数也是</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">的宏定义函数，其定义如下：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">#define BIO_pending(b) (int)BIO_ctrl(b,BIO_CTRL_PENDING,0,NULL)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">#define BIO_wpending(b) (int)BIO_ctrl(b,BIO_CTRL_WPENDING,0,NULL)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">后两个函数功能跟他们是一样的，只不过他们是通过调用</span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl</span><span style="line-height: 22px; font-family: 宋体;">函数实现的，而不是宏定义。此外，前面两个函数返回的是</span><span lang="EN-US" style="line-height: 22px;">int</span><span style="line-height: 22px; font-family: 宋体;">型，而后面两个函数返回的是</span><span lang="EN-US" style="line-height: 22px;">size_t</span><span style="line-height: 22px; font-family: 宋体;">型。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">需要注意的是，</span><span lang="EN-US" style="line-height: 22px;">BIO_pending</span><span style="line-height: 22px; font-family: 宋体;">和</span><span lang="EN-US" style="line-height: 22px;">&nbsp;BIO_wpending</span><span style="line-height: 22px; font-family: 宋体;">并不是在所有情况下都能很可靠地得到缓存数据的数量，比如在文件</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中，有些数据可能在文件内部结构的缓存中是有效的，但是不可能简单的在</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中得到这些数据的数量。而在有些类型</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中，这两个函数可能还不支持。基于此，</span><span lang="EN-US" style="line-height: 22px;">Openssl</span><span style="line-height: 22px; font-family: 宋体;">作者本身也建议一般不要使用这两个函数，而是使用后面两个，除非你对你所做的操作非常清楚和了解。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h2 style="line-height: 33px;"><span lang="EN-US" style="line-height: 33px;">5.CallBack</span><span style="line-height: 33px; font-family: 黑体;">函数及其控制</span><span lang="EN-US" style="line-height: 33px;"><o p style="line-height: 33px;"></o:p></span></h2><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">通过前面的介绍大家已经知道，</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数是非常重要的，是实现</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">多态性的一个关键因素之一，</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">提供的</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">控制系列函数有五个，其实都是一些宏定义，下面是它的声明和定义（</span><span lang="EN-US" style="line-height: 22px;">openssl/bio.h</span><span style="line-height: 22px; font-family: 宋体;">）：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">#define BIO_set_callback(b,cb) ((b)-&gt;callback=(cb))<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">#define BIO_get_callback(b) ((b)-&gt;callback)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">#define BIO_set_callback_arg(b,arg) ((b)-&gt;cb_arg=(char *)(arg))<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">#define BIO_get_callback_arg(b) ((b)-&gt;cb_arg)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">其中，</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数本身的声明如下：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">typedef long callback(BIO *b, int oper, const char *argp, int argi, long argl, long retvalue);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">此外，还有一个用于调试目的的函数，其实声明如下：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">long BIO_debug_callback(BIO *bio,int cmd,const char *argp,int argi,long argl,long ret);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">如果要看具体的例子，那么在文件</span><span lang="EN-US" style="line-height: 22px;">crypto/bio/bio_cb.c</span><span style="line-height: 22px; font-family: 宋体;">的函数</span><span lang="EN-US" style="line-height: 22px;">BIO_debug_callback()</span><span style="line-height: 22px; font-family: 宋体;">本身就是一个非常好的例子。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">下面，我们从</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数本身开始分别简单介绍这些函数的作用。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">5.1 callback<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数在</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中非常重要，许多控制功能都是要通过</span><span lang="EN-US" style="line-height: 22px;">callbank</span><span style="line-height: 22px; font-family: 宋体;">函数协助完成的，比如</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">要执行释放的操作</span><span lang="EN-US" style="line-height: 22px;">BIO_free</span><span style="line-height: 22px; font-family: 宋体;">，那么其实它是先调用</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数设置下面的操作将是释放操作（控制码</span><span lang="EN-US" style="line-height: 22px;">:BIO_CB_FREE</span><span style="line-height: 22px; font-family: 宋体;">），然后才调用别的相关函数执行真正的操作，在后面我们会列出这些控制功能函数，并简单说明</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数是怎么在这些功能的实现中使用的。现在，我先简单介绍</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数的各个参数：（参数名字参看说明的函数的声明）</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">1.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span style="line-height: 22px; font-family: 宋体;">参数</span><span lang="EN-US" style="line-height: 22px;">-b</span><span style="line-height: 22px; font-family: 宋体;">：这是</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数的输入参数，也就是</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数对应的</span><span lang="EN-US" style="line-height: 22px;">BIO<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">2.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span style="line-height: 22px; font-family: 宋体;">参数</span><span lang="EN-US" style="line-height: 22px;">-oper</span><span style="line-height: 22px; font-family: 宋体;">：设置</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">将要执行的操作，有些操作，</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数将被调用两次，一次实在实际操作之前，一次实在实际操作之后，在后面的调用的时候，一般是将</span><span lang="EN-US" style="line-height: 22px;">oper</span><span style="line-height: 22px; font-family: 宋体;">和</span><span lang="EN-US" style="line-height: 22px;">BIO_CB_RETURN</span><span style="line-height: 22px; font-family: 宋体;">相或操作后作为参数的。也就是说，后一次调用的时候</span><span lang="EN-US" style="line-height: 22px;">oper</span><span style="line-height: 22px; font-family: 宋体;">参数应该使用</span><span lang="EN-US" style="line-height: 22px;">oper|BIO_CB_RETURN</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">3.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span style="line-height: 22px; font-family: 宋体;">参数</span><span lang="EN-US" style="line-height: 22px;">-argp</span><span style="line-height: 22px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 22px;">argi</span><span style="line-height: 22px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 22px;">argl</span><span style="line-height: 22px; font-family: 宋体;">：这些参数根据</span><span lang="EN-US" style="line-height: 22px;">oper</span><span style="line-height: 22px; font-family: 宋体;">定义的操作的不同而不一样，是在相应操作中要用到的参数。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">4.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span style="line-height: 22px; font-family: 宋体;">参数</span><span lang="EN-US" style="line-height: 22px;">-retvalue</span><span style="line-height: 22px; font-family: 宋体;">：这是默认的</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数返回值，也就是说，如果没有提供</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">没有提供相应的</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数，那么就会返回这个值。真正的返回值是</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数本身提供的。如果在实际的操作之前调用</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数，并且这时候</span><span lang="EN-US" style="line-height: 22px;">retvalue</span><span style="line-height: 22px; font-family: 宋体;">参数设置为</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，如果</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">的函数返回值无效，那么对</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数的调用就会导致程序立刻返回，</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的操作就不会执行。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 18pt;"><span style="line-height: 22px; font-family: 宋体;">一般情况下，</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数在执行完后都应该返回</span><span lang="EN-US" style="line-height: 22px;">retvalue</span><span style="line-height: 22px; font-family: 宋体;">的值，除非该操作有特别的目的要修改这个返回值。下面简单列出我们比较熟悉的一些跟</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数相关的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">函数使用</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数的情况：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">1.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_free(b)</span><span style="line-height: 22px; font-family: 宋体;">：在执行该操作之前，调用了</span><span lang="EN-US" style="line-height: 22px;">callback(b, BIO_CB_FREE, NULL,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="0" unitname="l" wst="on" style="line-height: 22px;">0L</st1:chmetcnv>,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="0" unitname="l" wst="on" style="line-height: 22px;">0L</st1:chmetcnv>,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="1" unitname="l" wst="on" style="line-height: 22px;">1L</st1:chmetcnv>)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">2.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_read(b,out,outl)</span><span style="line-height: 22px; font-family: 宋体;">：在执行该操作之前，调用了</span><span lang="EN-US" style="line-height: 22px;">callback(b, BIO_CB_READ, out, outl,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="0" unitname="l" wst="on" style="line-height: 22px;">0L</st1:chmetcnv>,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="1" unitname="l" wst="on" style="line-height: 22px;">1L</st1:chmetcnv>)</span><span style="line-height: 22px; font-family: 宋体;">，之后调用了</span><span lang="EN-US" style="line-height: 22px;">callback(b, BIO_CB_READ|BIO_CB_RETURN, out, outl,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="0" unitname="l" wst="on" style="line-height: 22px;">0L</st1:chmetcnv>,retvalue)</span><span style="line-height: 22px; font-family: 宋体;">，大家可以看到，这就是我们上面说明过的情况，即两次调用</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">的操作，后面一次</span><span lang="EN-US" style="line-height: 22px;">oper</span><span style="line-height: 22px; font-family: 宋体;">的参数需要或上</span><span lang="EN-US" style="line-height: 22px;">BIO_CB_RETURN</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">3.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_write(b,in,inl)</span><span style="line-height: 22px; font-family: 宋体;">：在执行该操作之前，调用了</span><span lang="EN-US" style="line-height: 22px;">callback(b, BIO_CB_WRITE, in, inl,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="0" unitname="l" wst="on" style="line-height: 22px;">0L</st1:chmetcnv>,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="1" unitname="l" wst="on" style="line-height: 22px;">1L</st1:chmetcnv>)</span><span style="line-height: 22px; font-family: 宋体;">，之后调用了</span><span lang="EN-US" style="line-height: 22px;">callback(b, BIO_CB_WRITE|BIO_CB_RETURN, in, inl,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="0" unitname="l" wst="on" style="line-height: 22px;">0L</st1:chmetcnv>, retvalue)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">4.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_gets(b,out,outl)</span><span style="line-height: 22px; font-family: 宋体;">：在执行该操作之前，调用了</span><span lang="EN-US" style="line-height: 22px;">callback(b, BIO_CB_GETS, out, outl,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="0" unitname="l" wst="on" style="line-height: 22px;">0L</st1:chmetcnv>,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="1" unitname="l" wst="on" style="line-height: 22px;">1L</st1:chmetcnv>)</span><span style="line-height: 22px; font-family: 宋体;">，之后调用了</span><span lang="EN-US" style="line-height: 22px;">callback(b, BIO_CB_GETS|BIO_CB_RETURN, out, outl,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="0" unitname="l" wst="on" style="line-height: 22px;">0L</st1:chmetcnv>, retvalue)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">5.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_puts(b, in)</span><span style="line-height: 22px; font-family: 宋体;">：在执行该操作之前，调用了</span><span lang="EN-US" style="line-height: 22px;">callback(b, BIO_CB_WRITE, in, 0,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="0" unitname="l" wst="on" style="line-height: 22px;">0L</st1:chmetcnv>,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="1" unitname="l" wst="on" style="line-height: 22px;">1L</st1:chmetcnv>)</span><span style="line-height: 22px; font-family: 宋体;">，之后调用了</span><span lang="EN-US" style="line-height: 22px;">callback(b, BIO_CB_WRITE|BIO_CB_RETURN, in, 0,&nbsp;<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="0" unitname="l" wst="on" style="line-height: 22px;">0L</st1:chmetcnv>,retvalue)<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 18pt; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: -18pt;"><span lang="EN-US" style="line-height: 22px;"><span style="line-height: 22px;">6.<span style="line-height: normal; font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span lang="EN-US" style="line-height: 22px;">BIO_ctrl(BIO *b, int cmd, long larg, void *parg)</span><span style="line-height: 22px; font-family: 宋体;">：在执行该操作之前，调用了</span><span lang="EN-US" style="line-height: 22px;">callback(b,BIO_CB_CTRL,parg,cmd,larg,<st1 chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue="1" unitname="l" wst="on" style="line-height: 22px;">1L</st1:chmetcnv>),</span><span style="line-height: 22px; font-family: 宋体;">之后调用了</span><span lang="EN-US" style="line-height: 22px;">callback(b,BIO_CB_CTRL|BIO_CB_RETURN,parg,cmd, larg,ret)<o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">5.2 BIO_set_callback</span><span style="line-height: 25px; font-family: 宋体;">和</span><span lang="EN-US" style="line-height: 25px;">BIO_get_callback<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">这两个函数用于设置和返回</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中的</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数，它们都是宏定义，根据前面的叙述我们已经知道，</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数在许多高层的操作中都使用了，因为它能用于调试跟踪的目的或更改</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的操作，具有很大的灵活性，所以这两个函数也就有用武之地了。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">5.3 BIO_set_callback_arg</span><span style="line-height: 25px; font-family: 宋体;">和</span><span lang="EN-US" style="line-height: 25px;">IO_get_callback_arg<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">顾名思义，这两个函数用了设置和得到</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">函数中的参数。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">5.4 BIO_debug_callback<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">这是一个标准的调试信息输出函数，它把相关</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">执行的所有操作信息都打印输出到制定的地方。如果</span><span lang="EN-US" style="line-height: 22px;">callback</span><span style="line-height: 22px; font-family: 宋体;">参数没有指定输出这些信息的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">口，那么就会默认使用</span><span lang="EN-US" style="line-height: 22px;">stderr</span><span style="line-height: 22px; font-family: 宋体;">作为信息输出端口。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h2 style="line-height: 33px;"><span lang="EN-US" style="line-height: 33px;">6.BIO</span><span style="line-height: 33px; font-family: 黑体;">的</span><span lang="EN-US" style="line-height: 33px;">IO</span><span style="line-height: 33px; font-family: 黑体;">操作函数</span><span lang="EN-US" style="line-height: 33px;"><o p style="line-height: 33px;"></o:p></span></h2><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">这些函数是</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的基本读写操作函数，包括四个，他们的定义如下（</span><span lang="EN-US" style="line-height: 22px;">openssl/bio.h</span><span style="line-height: 22px; font-family: 宋体;">）：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_read(BIO *b, void *buf, int len);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_gets(BIO *b,char *buf, int size);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_write(BIO *b, const void *buf, int len);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">int BIO_puts(BIO *b,const char *buf);<o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">6.1 BIO_read<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">从</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">接口中读出指定数量字节</span><span lang="EN-US" style="line-height: 22px;">len</span><span style="line-height: 22px; font-family: 宋体;">的数据并存储到</span><span lang="EN-US" style="line-height: 22px;">buf</span><span style="line-height: 22px; font-family: 宋体;">中。成功就返回真正读出的数据的长度，失败返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">或－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，如果该</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">没有实现本函数则返回－</span><span lang="EN-US" style="line-height: 22px;">2</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">6.2 BIO_gets<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数从</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中读取一行长度最大为</span><span lang="EN-US" style="line-height: 22px;">size</span><span style="line-height: 22px; font-family: 宋体;">的数据。通常情况下，该函数会以最大长度限制读取一行数据，但是也有例外，比如</span><span lang="EN-US" style="line-height: 22px;">digest</span><span style="line-height: 22px; font-family: 宋体;">型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，该函数会计算并返回整个</span><span lang="EN-US" style="line-height: 22px;">digest</span><span style="line-height: 22px; font-family: 宋体;">信息。此外，有些</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">可能不支持这个函数。成功就返回真正读出的数据的长度，失败返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">或－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，如果该</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">没有实现本函数则返回－</span><span lang="EN-US" style="line-height: 22px;">2</span><span style="line-height: 22px; font-family: 宋体;">。需要注意的时，如果相应的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">不支持这个函数，那么对该函数的调用可能导致</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链自动增加一个</span><span lang="EN-US" style="line-height: 22px;">buffer</span><span style="line-height: 22px; font-family: 宋体;">型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">6.3 BIO_write<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">往</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中写入长度为</span><span lang="EN-US" style="line-height: 22px;">len</span><span style="line-height: 22px; font-family: 宋体;">的数据。成功就返回真正写入的数据的长度，失败返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">或－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，如果该</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">没有实现本函数则返回－</span><span lang="EN-US" style="line-height: 22px;">2</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">6.4 BIO_puts<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">往</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中写入一个以</span><span lang="EN-US" style="line-height: 22px;">NULL</span><span style="line-height: 22px; font-family: 宋体;">为结束符的字符串，成功就返回真正写入的数据的长度，失败返回</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">或－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">，如果该</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">没有实现本函数则返回－</span><span lang="EN-US" style="line-height: 22px;">2</span><span style="line-height: 22px; font-family: 宋体;">。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">需要注意的是，返回指为</span><span lang="EN-US" style="line-height: 22px;">0</span><span style="line-height: 22px; font-family: 宋体;">或－</span><span lang="EN-US" style="line-height: 22px;">1</span><span style="line-height: 22px; font-family: 宋体;">的时候并不一定就是发生了错误。在非阻塞型的</span><span lang="EN-US" style="line-height: 22px;">source/sink</span><span style="line-height: 22px; font-family: 宋体;">型或其它一些特定类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中，这仅仅代表目前没有数据可以读取，需要稍后再进行该操作。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">有时候，你可能会使用了阻塞类型的</span><span lang="EN-US" style="line-height: 22px;">sokect</span><span style="line-height: 22px; font-family: 宋体;">使用的一些系统调用技术（如</span><span lang="EN-US" style="line-height: 22px;">select</span><span style="line-height: 22px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 22px;">poll</span><span style="line-height: 22px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 22px;">equivalent</span><span style="line-height: 22px; font-family: 宋体;">）来决定</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">中是否有有效的数据被</span><span lang="EN-US" style="line-height: 22px;">read</span><span style="line-height: 22px; font-family: 宋体;">函数读取，但建议不要在阻塞型的接口中使用这些技术，因为这样的情况下如果调用</span><span lang="EN-US" style="line-height: 22px;">BIO_read</span><span style="line-height: 22px; font-family: 宋体;">就会导致在底层的</span><span lang="EN-US" style="line-height: 22px;">IO</span><span style="line-height: 22px; font-family: 宋体;">中多次调用</span><span lang="EN-US" style="line-height: 22px;">read</span><span style="line-height: 22px; font-family: 宋体;">函数，从而导致端口阻塞。建议</span><span lang="EN-US" style="line-height: 22px;">select</span><span style="line-height: 22px; font-family: 宋体;">（或</span><span lang="EN-US" style="line-height: 22px;">equivalent</span><span style="line-height: 22px; font-family: 宋体;">）应该和非阻塞型的</span><span lang="EN-US" style="line-height: 22px;">IO</span><span style="line-height: 22px; font-family: 宋体;">一起使用，可以在失败之后能够重新读取该</span><span lang="EN-US" style="line-height: 22px;">IO</span><span style="line-height: 22px; font-family: 宋体;">，而不是阻塞住了。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">关于</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的</span><span lang="EN-US" style="line-height: 22px;">IO</span><span style="line-height: 22px; font-family: 宋体;">操作为什么会失败以及怎么处理这些情况请参加</span><span lang="EN-US" style="line-height: 22px;">BIO_should_retry()</span><span style="line-height: 22px; font-family: 宋体;">函数的说明文档。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h2 style="line-height: 33px;"><span lang="EN-US" style="line-height: 33px;">7.BIO</span><span style="line-height: 33px; font-family: 黑体;">链的操作</span><span lang="EN-US" style="line-height: 33px;"><o p style="line-height: 33px;"></o:p></span></h2><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">结构其实是一个链式结构，单个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">是只有一个环节的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链的特例，那么我们怎么构造或在一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链中增加一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，怎么从一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链中删除一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">呢，本节就是专门讲述这个问题的。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">在</span><span lang="EN-US" style="line-height: 22px;">Openssl</span><span style="line-height: 22px; font-family: 宋体;">中，针对</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链的操作还是很简单的，仅仅包括两个函数（</span><span lang="EN-US" style="line-height: 22px;">openssl/bio.h</span><span style="line-height: 22px; font-family: 宋体;">）：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO * BIO_push(BIO *b,BIO *append);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO * BIO_pop(BIO *b);<o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">7.1 BIO_push<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数把参数中名为</span><span lang="EN-US" style="line-height: 22px;">append</span><span style="line-height: 22px; font-family: 宋体;">的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">附加到名为</span><span lang="EN-US" style="line-height: 22px;">b</span><span style="line-height: 22px; font-family: 宋体;">的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">上，并返回</span><span lang="EN-US" style="line-height: 22px;">b</span><span style="line-height: 22px; font-family: 宋体;">。其实，</span><span lang="EN-US" style="line-height: 22px;">openssl</span><span style="line-height: 22px; font-family: 宋体;">作者本身也认识到，</span><span lang="EN-US" style="line-height: 22px;">BIO_push</span><span style="line-height: 22px; font-family: 宋体;">的函数名字可能会导致误会，因为</span><span lang="EN-US" style="line-height: 22px;">BIO_push</span><span style="line-height: 22px; font-family: 宋体;">函数其实只是将两个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">连接起来，而不是</span><span lang="EN-US" style="line-height: 22px;">Push</span><span style="line-height: 22px; font-family: 宋体;">的功能，应该是</span><span lang="EN-US" style="line-height: 22px;">join</span><span style="line-height: 22px; font-family: 宋体;">才对。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">我们举几个简单的例子说明</span><span lang="EN-US" style="line-height: 22px;">BIO_push</span><span style="line-height: 22px; font-family: 宋体;">的作用，假设</span><span lang="EN-US" style="line-height: 22px;">md1</span><span style="line-height: 22px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 22px;">md2</span><span style="line-height: 22px; font-family: 宋体;">是</span><span lang="EN-US" style="line-height: 22px;">digest</span><span style="line-height: 22px; font-family: 宋体;">类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，</span><span lang="EN-US" style="line-height: 22px;">b64</span><span style="line-height: 22px; font-family: 宋体;">是</span><span lang="EN-US" style="line-height: 22px;">Base64</span><span style="line-height: 22px; font-family: 宋体;">类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，而</span><span lang="EN-US" style="line-height: 22px;">f</span><span style="line-height: 22px; font-family: 宋体;">是</span><span lang="EN-US" style="line-height: 22px;">file</span><span style="line-height: 22px; font-family: 宋体;">类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，那么如果执行操作</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO_push(b64, f);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">那么就会形成一个</span><span lang="EN-US" style="line-height: 22px;">b64-f</span><span style="line-height: 22px; font-family: 宋体;">的链。然后再执行下面的操作：</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO_push(md2, b64);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO_push(md1, md2);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">那么就会形成</span><span lang="EN-US" style="line-height: 22px;">md1-md2-b64-f</span><span style="line-height: 22px; font-family: 宋体;">的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链，大家可以看到，在构造完一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">后，头一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">就代表了整个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链，这根链表的概念几乎是一样的。这时候，任何写往</span><span lang="EN-US" style="line-height: 22px;">md1</span><span style="line-height: 22px; font-family: 宋体;">的数据都会经过</span><span lang="EN-US" style="line-height: 22px;">md1</span><span style="line-height: 22px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 22px;">md2</span><span style="line-height: 22px; font-family: 宋体;">的摘要，然后经过</span><span lang="EN-US" style="line-height: 22px;">base64</span><span style="line-height: 22px; font-family: 宋体;">编码，最后写入文件</span><span lang="EN-US" style="line-height: 22px;">f</span><span style="line-height: 22px; font-family: 宋体;">。可以看到，构造一条好的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链后，操作是非常方便的，你不用再关心具体的事情了，整个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链会自动将数据进行指定操作的系列处理。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">需要注意的是，如果是读操作，那么数据会从相反的方向传递和处理，对于上面的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链，数据会从</span><span lang="EN-US" style="line-height: 22px;">f</span><span style="line-height: 22px; font-family: 宋体;">文件读出，然后经过</span><span lang="EN-US" style="line-height: 22px;">base64</span><span style="line-height: 22px; font-family: 宋体;">解码，然后经过</span><span lang="EN-US" style="line-height: 22px;">md1</span><span style="line-height: 22px; font-family: 宋体;">、</span><span lang="EN-US" style="line-height: 22px;">md2</span><span style="line-height: 22px; font-family: 宋体;">编码，最后读出。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><h3 style="line-height: 25px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"><span lang="EN-US" style="line-height: 25px;">7.2 BIO_pop<o p style="line-height: 25px;"></o:p></span></h3><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">该函数把名为</span><span lang="EN-US" style="line-height: 22px;">b</span><span style="line-height: 22px; font-family: 宋体;">的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">从一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链中移除并返回下一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，如果没有下一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，那么就返回</span><span lang="EN-US" style="line-height: 22px;">NULL</span><span style="line-height: 22px; font-family: 宋体;">。被移除的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">就成为一个单个的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，跟原来的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链就没有关系了，这样你可以把它释放或连接到另一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">上去。可以看到，如果是单个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">的时候，该操作是没有任何意义的。如果你执行操作</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span lang="EN-US" style="line-height: 22px;">BIO_pop(md2);<o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">那么返回值将为</span><span lang="EN-US" style="line-height: 22px;">b64</span><span style="line-height: 22px; font-family: 宋体;">，而</span><span lang="EN-US" style="line-height: 22px;">md2</span><span style="line-height: 22px; font-family: 宋体;">从上述的链中移除，形成一个新的</span><span lang="EN-US" style="line-height: 22px;">md1-b64-f</span><span style="line-height: 22px; font-family: 宋体;">的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">链，对于数据操作来说，还是往</span><span lang="EN-US" style="line-height: 22px;">md1</span><span style="line-height: 22px; font-family: 宋体;">读写，没有什么变化，但是底层处理过程已经发生变化了，这就是封装与透明的概念。可以看到，虽然</span><span lang="EN-US" style="line-height: 22px;">BIO_pop</span><span style="line-height: 22px; font-family: 宋体;">参数只是一个</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">，但该操作直接的后果会对该</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">所在的链产生影响，所以，当</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">所在的链不一样的时候，其结果是不一样的。</span><span lang="EN-US" style="line-height: 22px;"><o p style="line-height: 22px;"></o:p></span></p><p style="line-height: 22px; margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; text-indent: 21pt;"><span style="line-height: 22px; font-family: 宋体;">此外：</span><span lang="EN-US" style="line-height: 22px;">BIO_push</span><span style="line-height: 22px; font-family: 宋体;">和</span><span lang="EN-US" style="line-height: 22px;">BIO_pop</span><span style="line-height: 22px; font-family: 宋体;">操作还可能导致其它一些附加的结果，一些相关的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">可能会调用一些控制操作，这些具体的细节因为各个类型的</span><span lang="EN-US" style="line-height: 22px;">BIO</span><span style="line-height: 22px; font-family: 宋体;">不一样，在他们各自的说明中会有说明。</span></p></span></h2>
</body></html>