<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：[转]使用javascript计算string的utf-8编码字节数</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>[转]使用javascript计算string的utf-8编码字节数</h2>
<p align="right">发布时间：2012-6-12 14:03
<br>分类名称：Java</p><br>
<div id="blog_text"  ><p>From：http://hi.baidu.com/zlflashlight/blog/item/d7330546b9fdf60f6a63e585.html<br></p><p>产品的需求是按照后台的存储字节来的，一个汉字3个字节，一个英文1个字节，一个越南文，最多可能是4个字节。但是前端页面，一个汉字记为1，一个越南字记为1，一个英文字符也是记为1，所以<font color="#ff0000"  >需要在JavaScript中判断在UTF-8下存储的String的字节数</font></p> <p>编码格式为</p> <p>UTF-8 字节流(二进制)<br> 0000 - 007F 0xxxxxxx （1字节）<br> 0080 - 07FF 110xxxxx 10xxxxxx （2字节）<br> 0800 - FFFF 1110xxxx 10xxxxxx 10xxxxxx （3字节）</p> <p>代码如下：</p> <p>&lt;html xmlns="<a rel="nofollow" href="http://www.w3.org/1999/xhtml"  >http://www.w3.org/1999/xhtml</a>"&gt;<br> &lt;head&gt;<br> &lt;meta http-equiv="Content-Type" content="text/html; charset=<font color="#ff0000"  >utf-8</font>" /&gt;<br> &lt;/head&gt;<br> &lt;body&gt;<br> &lt;/body&gt;<br> &lt;script type="text/javascript"&gt;</p> <p><font color="#ff0000"  >String.prototype.length2 = function() {&nbsp;&nbsp;  <br> var totalLength = 0;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  var i;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  var charCode;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  for (i = 0; i &lt; this.length; i++) {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  charCode = this.charCodeAt(i);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if (charCode &lt; 0x007f) {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  totalLength = totalLength + 1;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  } else if ((0x0080 &lt;= charCode) &amp;&amp; (charCode &lt;= 0x07ff)) {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  totalLength += 2;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  } else if ((0x0800 &lt;= charCode) &amp;&amp; (charCode &lt;= 0xffff)) {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  totalLength += 3;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  //alert(totalLength);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  return totalLength;<br> }</font></p> <p>var str = "<font color="#ff00ff"  >jet' aime fairy</font>";&nbsp;&nbsp;  <br> alert(str) ;<br> alert("字符数:"+str.length);&nbsp;&nbsp;  <br> alert("byte数:"+str.length2());&nbsp;&nbsp;  <br> &lt;/script&gt; <br> &lt;/html&gt;</p> <p> </p> <p>紫色的部分可以任意修改为各个国家的文字</p></div>
</body></html>