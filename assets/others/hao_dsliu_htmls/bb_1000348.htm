<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：[转] RSA 算法</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>[转] RSA 算法</h2>
<p align="right">发布时间：2010-2-11 14:26
<br>分类名称：PKI</p><br>
<h2><span></span><span>一、算法基础</span></h2> <h3><span>1,RSA</span> <span>算法基础</span></h3> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>RSA</span>  <span>算法是非对称算法</span> <span>,</span>  <span>使用大数分解原理得到，主要过程主要用到费马小定理，详细数学证明见附加信息</span></p> <p><span>&nbsp; </span></p> <h3><span>2,RSA</span> <span>算法描述</span></h3> <p style="text-indent: 1.35pt; margin-left: 33.05pt;"  ><span>找两素数</span> <span>p</span> <span>和</span> <span>q  </span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>取</span>  <span>n=p*q </span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>取</span>  <span>t=(p-1)*(q-1) </span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>取任何一个数</span> <span>e,</span> <span>要求满足</span>  <span>e&lt;t</span> <span>并且</span> <span>e</span> <span>与</span> <span>t</span>  <span>互素（<span style="color: blue;"  >就是最大公因数</span> </span><span style="color: blue;"  >1</span> <span>）</span> <span></span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>取</span>  <span>d*e%t==1 &nbsp; </span><span style="color: blue;"  >即</span> <span style="color: blue;"  >(e * d) % ((p-1)*(q-1)) &nbsp; == 1</span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>&nbsp;</span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>这样最终得到三个数：</span> <span>n d e </span></p> <p style="text-indent: -15.75pt; margin-left: 36.75pt;"  ><span>&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>设消息为数</span> <span>M (M &lt;n) </span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>设</span>  <span>c=(M^d)%n</span> <span>就得到了加密后的消息</span> <span>c </span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>设</span>  <span>m=(c^e)%n</span> <span>则</span> <span>m == M</span> <span>，从而完成对</span>  <span>c</span> <span>的解密。</span> <span></span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>注：</span> <span>^</span> <span>表示次方</span> <span>,</span>  <span>上面两式中的</span> <span>d</span> <span>和</span> <span>e</span>  <span>可以互换。具体过程看证明</span> <span></span></p> <h3><span>3,RSA</span> <span>算法举例</span></h3> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>在非对称加密中：</span> <span></span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>n  d</span> <span>两个数构成公钥，可以告诉别人；</span> <span></span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>n  e</span> <span>两个数构成私钥，</span> <span>e</span> <span>自己保留，不让任何人知道。</span>  <span></span></p> <p style="margin-left: 34.45pt;"  ><span>给别人发送的信息使用</span>  <span>e</span> <span>加密，只要别人能用</span> <span>d</span>  <span>解开就证明信息是由你发送的，构成了签名机制。</span> <span></span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>别人给你发送信息时使用</span> <span>d</span> <span>加密，这样只有拥有</span>  <span>e</span> <span>的你能够对其解密。</span> <span></span></p> <p style="text-indent: -15.75pt; margin-left: 36.75pt;"  ><span>&nbsp;</span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>rsa</span> <span>的安全性在于对于一个大数</span> <span>n</span>  <span>，没有有效的方法能够将其分解</span> <span></span></p> <p style="text-indent: 13.5pt; margin-left: 21pt;"  ><span>从而在已知</span> <span>n d</span> <span>的情况下无法获得</span>  <span>e</span> <span>；同样在已知</span> <span>n e</span> <span>的情况下无法求得</span>  <span>d</span> <span>。</span></p> <p style="text-indent: 21pt;"  ><span style="font-size: 9pt;"  >&nbsp;</span></p> <h2><span>二、举例</span> <span>:</span></h2> <p style="text-indent: 21pt;"  ><span style="font-size: 12pt;"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>找两个素数</span> <span>:</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>p=47</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>q=59</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>这样</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>n=p*q=2773</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>t=(p-1)*(q-1)=2668</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>寻找</span>  <span>e </span><span>满足</span> <span>e&lt;t</span> <span>并且</span>  <span>e</span> <span>和</span> <span>t</span> <span>互素</span> <span>&nbsp;  </span><span>找到</span> <span>e=63</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>寻找</span>  <span>d </span><span>使</span> <span>e*d%t ==1 </span><span>得到</span>  <span>d=847</span></p> <p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>那么</span>  <span>n=2773&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d=847</span></p> <p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; n=2773&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  e=63</span></p> <p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>取加密</span>  <span><span>c</span> </span><span>＝</span> <span>465</span></p> <p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>测试</span> <span>(</span>  <span style="color: red;"  >请安装</span> <span style="color: red;"  >Active perl</span>  <span>)</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>加密</span>  <span>:</span></p> <p style="text-indent: 21pt; margin-left: 42pt;"  ><span>perl  -Mbigint -e "print 465**847%2773" </span><span>结果为</span> <span style="font-size: 9pt;"  >1118</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>使用解密结果</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  perl -Mbigint -e "print 1118**63%2773" </span><span>结果为</span>  <span>465</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>这里一般在加密过程之中</span> <span></span><span>取</span>  <span>d=65537</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>&nbsp;</span></p> <h2><span>三、应用</span> <span>OpenSSL</span> <span>库里的</span> <span>RSA</span>  <span>函数过程</span></h2> <h3><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1</span> <span>，加密分组</span></h3> <p style="text-indent: 21pt; margin-left: 21pt;"  ><strong><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><span>使用</span>  <span>RSA</span> <span>加密的分组长度为</span></p> <p style="text-indent: 21pt; margin-left: 63pt;"  ><span>modulusLen  = (publicKey-&gt;bits + 7) / 8 - 11;</span></p> <h3><span style="line-height: 173%; font-weight: normal;"  >&nbsp;&nbsp;&nbsp;&nbsp;  </span><span>2</span> <span>，数据补偿</span></h3> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RSA</span> <span>核心加密算法加密的数据长度为</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; modulusLen = (publicKey-&gt;bits + 7) /  8;</span></p> <p style="margin-left: 84pt;"  ><span>那么要补偿</span> <span>11</span>  <span>位的数据</span> <span>(</span> <strong><span>很多<span style="color: black;"  >算法加密结果不一样的原因大都是由这个原因引起的</span> </span></strong><span>)  </span></p> <p style="margin-left: 84pt;"  ><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span>其中第</span> <span>1</span> <span>，</span> <span>2</span>  <span>（为模式）</span></p> <p style="margin-left: 84pt;"  ><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span>以后的</span> <span>2</span> <span>－</span> <span>10</span>  <span>为</span> <span>0xff</span></p> <p style="margin-left: 84pt;"  ><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11</span>  <span>位为</span> <span>0</span></p> <p style="text-indent: 21pt; margin-left: 63pt;"  >&nbsp;</p> <h3><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3</span> <span>，核心算法</span></h3> <p style="text-indent: 21pt; margin-left: 63pt;"  ><strong><span>1</span> </strong><strong><span>，大数运算</span>  </strong><strong></strong></p> <p style="text-indent: 21pt; margin-left: 63pt;"  ><strong><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><span>大数的加减乘除方法</span></p> <p style="text-indent: 21pt; margin-left: 63pt;"  ><strong><span>2,  </span></strong><strong><span>高阶求模</span> </strong><strong><span>(m^e mod  n)</span> </strong></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><strong><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><span>a = (b  * c) % d &lt;==&gt; ( (a % d )*( c % d) ) % d</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>可以使用分解成</span> <span>(b  *c) % d </span></p> <p style="text-indent: 21pt; margin-left: 84pt;"  ><span>运算次数可以分解为</span> <span>log(c)</span></p> <p style="text-indent: 21pt; margin-left: 63pt;"  ><strong><span>3</span> </strong><strong><span>，加密运算</span>  </strong><strong></strong></p> <p><strong><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span></strong><strong><span>很简单</span> </strong><strong><span>,</span>  </strong><strong><span>请参看代码</span> </strong><strong></strong></p> <p style="text-indent: 21pt; margin-left: 63pt;"  ><strong><span>4</span> </strong><strong><span>，解密运算</span>  </strong><strong></strong></p> <p><strong><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1,</span>  </strong><span>一种方法是与加密过程类似解密</span> <span>使用解密密钥</span></p> <p><strong><span style="line-height: 240%; font-size: 22pt;"  ><br style="page-break-before: always;"  ></span></strong></p> <h1 style="text-align: center;"  ><span>附加数学证明</span></h1> <p style="text-indent: 21pt;"  ><strong><span>数学原理</span>  </strong></p> <p style="margin-left: 42pt;"  ><strong><span>命题</span>  <span>:</span> </strong></p> <p style="text-indent: 21pt; margin-left: 42pt;"  ><strong><span style="color: blue;"  >若</span> <span style="color: blue;"  >p, q  </span></strong><strong><span style="color: blue;"  >是相异质数</span> <span style="color: blue;"  >, rm == 1 mod (p-1)(q-1), </span></strong></p> <p style="text-indent: 21pt; margin-left: 42pt;"  ><strong><span style="color: blue;"  >a</span> </strong><strong><span style="color: blue;"  >是任意一个正整数</span> <span style="color: blue;"  >, b == a^m mod pq,  c == b^r mod pq, </span></strong></p> <p style="text-indent: 21pt; margin-left: 42pt;"  ><strong><span style="color: blue;"  >则</span> <span style="color: blue;"  >c == a mod pq</span>  </strong><span style="color: red;"  >&nbsp; </span><strong><span style="color: blue;"  >(</span> </strong><strong><span style="color: blue;"  >补充</span> <span style="color: blue;"  ></span></strong><strong><span style="color: blue;"  >如果</span>  <span style="color: blue;"  >pq&gt;=a &gt; 0 </span></strong><strong><span style="color: blue;"  >那么</span> <span style="color: blue;"  >c==a)</span>  </strong></p> <p style="margin-left: 42pt;"  ><strong><span>证明的过程</span>  <span>:</span> </strong></p> <p style="margin-left: 42pt;"  ><span>证明的过程</span> <span>,  </span><span>会用到费马小定理</span> <span>, </span><span>叙述如下</span> <span>:  </span></p> <p style="margin-left: 42pt;"  ><span>m </span><span>是任一质数</span>  <span>, n </span><span>是任一整数</span> <span>, </span><span>则</span> <span>n^m == n  mod m </span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span style="color: red;"  >注意注释</span> <span style="color: blue;"  >&nbsp; </span><span style="color: red;"  >写法的意思同</span> <span style="color: red;"  >( (n^m) mod m ) = (n  mod m ) )</span></p> <p style="text-indent: 21pt; margin-left: 21pt;"  ><span style="color: red;"  >&nbsp;</span></p> <p style="margin-left: 42pt;"  ><span style="color: rgb(255, 0, 0);"  ><span>(</span> <span>换另一句话说</span> <span>,  </span><span>如果</span> <span>n </span><span>和</span> <span>m  </span><span>互质</span> <span>, </span><span>则</span> <span>n^(m-1) == 1 mod m)  </span></span></p> <p style="margin-left: 42pt;"  ><span style="color: rgb(255, 0, 0);"  ><span>运用一些基本的群论的知识</span> <span>,  </span><span>就可以很容易地证出费马小定理的</span> <span>........ </span></span></p> <p style="margin-left: 42pt;"  ><span>&nbsp; </span></p> <p style="margin-left: 42pt;"  ><span>证明</span></p> <p style="margin-left: 42pt;"  ><span>因为</span> <span>rm == 1 mod  (p-1)(q-1), </span><span>所以</span> <span>rm = k(p-1)(q-1) + 1,  </span><span>其中</span> <span>k </span><span>是整数</span> <span></span></p> <p style="margin-left: 42pt;"  ><span>因为在</span> <span>modulo  </span><span>中是</span> <span>preserve </span><span>乘法的</span> <span></span></p> <p style="margin-left: 42pt;"  ><span>(x == y mod z&nbsp; and&nbsp; u == v  mod z&nbsp; =&gt;&nbsp; xu == yv mod z), </span></p> <p style="margin-left: 42pt;"  ><span>所以</span> <span>, c == b^r ==  (a^m)^r == a^(rm) == a^(k(p-1)(q-1)+1) mod pq </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp; </span></p> <p style="margin-left: 42pt;"  ><span>1. </span><span>如果</span>  <span>a </span><span>不是</span> <span>p </span><span>的倍数</span> <span>,  </span><span>也不是</span> <span>q </span><span>的倍数时</span> <span>, </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; </span><span>则</span>  <span>a^(p-1) == 1 mod p (</span> <span>费马小定理</span> <span>)&nbsp; =&gt;&nbsp;  a^(k(p-1)(q-1)) == 1 mod p </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a^(q-1) == 1 mod q  (</span> <span>费马小定理</span> <span>)&nbsp; =&gt;&nbsp; a^(k(p-1)(q-1)) == 1 mod q  </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; </span><span>所以</span>  <span>p, q </span><span>均能整除</span> <span>a^(k(p-1)(q-1)) - 1&nbsp; =&gt;&nbsp; pq |  a^(k(p-1)(q-1)) - 1 </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; </span><span>即</span>  <span>a^(k(p-1)(q-1)) == 1 mod pq </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; =&gt;&nbsp; c ==  a^(k(p-1)(q-1)+1) == a mod pq </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp; </span></p> <p style="margin-left: 42pt;"  ><span>2. </span><span>如果</span>  <span>a </span><span>是</span> <span>p </span><span>的倍数</span> <span>,  </span><span>但不是</span> <span>q </span><span>的倍数时</span> <span>, </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; </span><span>则</span>  <span>a^(q-1) == 1 mod q (</span> <span>费马小定理</span> <span>) </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; =&gt;&nbsp; a^(k(p-1)(q-1)) ==  1 mod q </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; =&gt;&nbsp; c ==  a^(k(p-1)(q-1)+1) == a mod q </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; =&gt;&nbsp; q | c - a  </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; </span><span>因</span>  <span>p | a </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; =&gt;&nbsp; c ==  a^(k(p-1)(q-1)+1) == 0 mod p </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; =&gt;&nbsp; p | c - a  </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; </span><span>所以</span>  <span>, pq | c - a&nbsp; =&gt;&nbsp; c == a mod pq </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp; </span></p> <p style="margin-left: 42pt;"  ><span>3. </span><span>如果</span>  <span>a </span><span>是</span> <span>q </span><span>的倍数</span> <span>,  </span><span>但不是</span> <span>p </span><span>的倍数时</span> <span>,  </span><span>证明同上</span> <span></span></p> <p style="margin-left: 42pt;"  ><span>&nbsp; </span></p> <p style="margin-left: 42pt;"  ><span>4. </span><span>如果</span>  <span>a </span><span>同时是</span> <span>p </span><span>和</span> <span>q  </span><span>的倍数时</span> <span>, </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; </span><span>则</span>  <span>pq | a </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; =&gt;&nbsp; c ==  a^(k(p-1)(q-1)+1) == 0 mod pq </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; =&gt;&nbsp; pq | c - a  </span></p> <p style="margin-left: 42pt;"  ><span>&nbsp;&nbsp; =&gt;&nbsp; c == a mod  pq</span></p>
</body></html>