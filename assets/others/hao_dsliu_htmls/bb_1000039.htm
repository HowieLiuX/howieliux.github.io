<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：[转] Windows下用Visual Studio编译x64平台的内联汇编</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>[转] Windows下用Visual Studio编译x64平台的内联汇编</h2>
<p align="right">发布时间：2014-6-27 13:17
<br>分类名称：windows</p><br>
<p style="margin-top: 0px; margin-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"   >原文地址：<a style="color: rgb(202, 0, 0); text-decoration: none;" rel="nofollow" href="http://blog.csdn.net/ariesjzj/article/details/7085138"   >http://blog.csdn.net/ariesjzj/article/details/7085138</a></p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"   >Linux下，GCC支持x86-32/64的内联汇编。Windows下，Visual Stdio支持x86-32的内联汇编，但不支持x64的内联汇编（至少到Visual Studio 2010是这样），而是提供了一些Intrinsics（一种类似于内联函数的东西）。MSDN给出了这些intrinsics的列表：<a style="color: rgb(202, 0, 0); text-decoration: none;" rel="nofollow" href="http://msdn.microsoft.com/en-us/library/26td21ds.aspx"   >http://msdn.microsoft.com/en-us/library/26td21ds.aspx</a>。</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"   >&nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"   >这些intrinsics可以让我们使用cpuid和rdstc这类底层特性，但终归有限的intrinsics是无法满足人民日益增长的开发需要的，于是我们需要能更方便写汇编代码的方法。这里讨论三种方法：</p><p dir="ltr"   style="margin-top: 0px; margin-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"   >*&nbsp;第一种是比较生猛的做法，直接把全部程序写成.S汇编文件，适合各类牛人及猛男，不多讨论。（Visual Studio相关配置例子见<a style="color: rgb(202, 0, 0); text-decoration: none;" rel="nofollow" href="http://www.deconflations.com/2011/masm-assembly-in-visual-studio-2010/"   >http://www.deconflations.com/2011/masm-assembly-in-visual-studio-2010/</a>）</p><p dir="ltr"   style="margin-top: 0px; margin-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"   >* 第二种比较柔和些，把需要写成汇编的函数写到.S汇编文件里，最后链接进来。（<a style="color: rgb(202, 0, 0); text-decoration: none;" rel="nofollow" href="http://www.lomont.org/Math/Papers/2009/Introduction%20to%20x64%20Assembly.pdf"   >http://www.lomont.org/Math/Papers/2009/Introduction%20to%20x64%20Assembly.pdf</a>里有一个简单例子）</p><p dir="ltr"   style="margin-top: 0px; margin-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"   >* 重点讨论第三种，首先安装Intel C++ Compiler XE，然后打开Parallel Studio XE 2011 with VS2010。</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"   >这是个以Intel C++ Compiler为后端的VS2010。Intel C++ Compiler本身支持Microsoft-style和GNU-like style的内联汇编（<a style="color: rgb(202, 0, 0); text-decoration: none;" rel="nofollow" href="http://software.intel.com/sites/products/documentation/hpc/compilerpro/en-us/cpp/lin/compiler_c/intref_cls/common/intref_data_align_ma_ia_linux_ia.htm"   >http://software.intel.com/sites/products/documentation/hpc/compilerpro/en-us/cpp/lin/compiler_c/intref_cls/common/intref_data_align_ma_ia_linux_ia.htm</a>&nbsp;），遗憾的是Linux和Windows平台上不完全相同（因为Linux下汇编代码是交给GNU assembler处理的，而Windows下是由内嵌assembler处理的），但至少可以让我们用到熟悉的内联汇编：</p><div style="font-family: Consolas, 'Courier New', Courier, mono, serif; border: 1px solid rgb(30, 73, 117); background-color: rgb(34, 37, 43); font-size: 12px; width: 936.53125px; overflow: auto; padding-top: 1px; color: rgb(192, 192, 192); line-height: 26px; margin: 18px 0px !important;"   ><ol start="1"   style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 5px; padding-bottom: 5px; border: none;position:inherit; list-style-position: initial; list-style-image: initial;"   ><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style: decimal-leading-zero outside; line-height: 13px; color: inherit;"   ><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;"   >__asm&nbsp;{&nbsp;&nbsp;</span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style: decimal-leading-zero outside; line-height: 13px;"   ><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;"   >&nbsp;&nbsp;</span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style: decimal-leading-zero outside; line-height: 13px; color: inherit;"   ><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;"   >&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;</span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style: decimal-leading-zero outside; line-height: 13px;"   ><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;"   >&nbsp;&nbsp;</span></li><li style="margin: 0px !important; padding: 0px 3px 0px 10px !important; border: none; list-style: decimal-leading-zero outside; line-height: 13px; color: inherit;"   ><span style="margin: 0px; padding: 0px; border: none; background-color: inherit;"   >}&nbsp;&nbsp;</span></li></ol></div><p style="margin-top: 0px; margin-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"   >&nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"   ><br></p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"   >有一种比较特殊的汇编用法是用byte直接写指令，这种用法在一些情况下是不可代替的。上面前两种方法中，可以用和Linux上通用的DB directive完成。第三种中可以和Visual Studio x86-32编译时一样用emit完成（<a style="color: rgb(202, 0, 0); text-decoration: none;" rel="nofollow" href="http://msdn.microsoft.com/en-us/library/1b80826t(v=vs.80).aspx"   >http://msdn.microsoft.com/en-us/library/1b80826t(v=vs.80).aspx</a>）。</p><wbr>
</body></html>