<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：【转】 Git 中一些问题</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>【转】 Git 中一些问题</h2>
<p align="right">发布时间：2012-7-8 09:10
<br>分类名称：Version control</p><br>
  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >在使用<span lang="EN-US"  >Git Push</span>代码到数据仓库时，提示如下错误<span lang="EN-US"  >:</span></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >[remote rejected] master -&gt; master (branch is currently checked out)</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >错误原型<span lang="EN-US"  ></span></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error: refusing to update checked out branch: refs/heads/master</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error: By default, updating the current branch in a non-bare repository</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error: is denied, because it will make the index and work tree inconsistent</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error: with what you pushed, and will require 'git reset --hard' to match</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error: the work tree to HEAD.</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error:</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error: You can set 'receive.denyCurrentBranch' configuration variable to</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error: 'ignore' or 'warn' in the remote repository to allow pushing into</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error: its current branch; however, this is not recommended unless you</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error: arranged to update its work tree to match what you pushed in some</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error: other way.</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error:</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error: To squelch this message and still keep the default behaviour, set</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >remote: error: 'receive.denyCurrentBranch' configuration variable to 'refuse'.</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >To git@192.168.1.X:/var/git.server/.../web</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >! [remote rejected] master -&gt; master (branch is currently checked out)</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >error: failed to push some refs to 'git@192.168.1.X:/var/git.server/.../web'</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><b><span style="font-size: 12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >解决办法<span lang="EN-US"  >:</span></span></b><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  lang="EN-US"  ></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >这是由于<span lang="EN-US"  >git</span>默认拒绝了<span lang="EN-US"  >push</span>操作，需要进行设置，修改<span lang="EN-US"  >.git/config</span>文件后面添加如下代码：<span lang="EN-US"  ></span></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:blue; mso-font-kerning:0pt;"  lang="EN-US"  >[receive]</span><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  lang="EN-US"  ><br> <span style="color:blue;"  >denyCurrentBranch = ignore</span></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >无法查看<span lang="EN-US"  >push</span>后的<span lang="EN-US"  >git</span>中文件的原因与解决方法<span lang="EN-US"  ></span></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >在初始化远程仓库时最好使用<span lang="EN-US"  ></span></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:blue; mso-font-kerning:0pt;"  lang="EN-US"  >git --bare init</span><span style="font-size: 12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  lang="EN-US"  ></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >而不要使用：<b><span lang="EN-US"  >git init</span></b><span lang="EN-US"  ></span></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >git init </span><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family: 宋体;mso-font-kerning:0pt;"  >和<span lang="EN-US"  >git --bare init </span>的具体区别<span lang="EN-US"  >:</span></span><span lang="EN-US"  ><a rel="nofollow" href="http://blog.haohtml.com/archives/12265"  ><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;color:blue;mso-font-kerning:0pt;"  >http://blog.haohtml.com/archives/12265</span></a></span><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体; mso-font-kerning:0pt;"  lang="EN-US"  ></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >=================================================</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >如果使用了<span lang="EN-US"  >git init</span>初始化，则远程仓库的目录下，也包含<span lang="EN-US"  >work tree</span>，当本地仓库向远程仓库<span lang="EN-US"  >push</span>时<span lang="EN-US"  >, </span>如果远程仓库正在<span lang="EN-US"  >push</span>的分支上（如果当时不在<span lang="EN-US"  >push</span>的分支，就没有问题）<span lang="EN-US"  >, </span>那么<span lang="EN-US"  >push</span>后的结果不会反应在<span lang="EN-US"  >work tree</span>上<span lang="EN-US"  >, &nbsp;</span>也即在远程仓库的目录下对应的文件还是之前的内容。<span lang="EN-US"  ></span></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><b><span style="font-size: 12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >解决方法：</span></b><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体; mso-font-kerning:0pt;"  lang="EN-US"  ></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >必须得使用命令<span lang="EN-US"  > git reset --hard </span>才能看到<span lang="EN-US"  >push</span>后的内容<span lang="EN-US"  >.</span></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >研究了很久不得其解，然后找到一条命令凑合着能用了：<span lang="EN-US"  ></span></span></p>  <p style="text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  >登录到<span style="color:blue;"  >远程</span>的那个文件夹，使用<span lang="EN-US"  ></span></span></p>  <p style="text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体; color:blue;mso-font-kerning:0pt;"  lang="EN-US"  >git config --bool core.bare true</span><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体; mso-font-kerning:0pt;"  lang="EN-US"  ></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >就搞定了。<span lang="EN-US"  ></span></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt; font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning:0pt;"  >贴一段参考文章：<span lang="EN-US"  ></span></span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >Create a bare GIT repository</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >A small rant: git is unable to create a normal bare repository by itself. Stupid git indeed.</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >To be precise,&nbsp;<b>it is not possible to clone empty repositories</b>. So an empty repository is a useless repository. Indeed, you normally create an empty repository and immediately fill it:</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >git init git add .</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >However,&nbsp;git add&nbsp;is not possible when you create a bare repository:</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >git --bare init git add .</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >gives an error "fatal: This operation must be run in a work tree".</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >You can't check it out either:</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >Initialized empty Git repository in /home/user/myrepos/.git/ fatal:&nbsp;</span><span lang="EN-US"  ><a rel="nofollow" href="http://repository.example.org/projects/myrepos.git/info/refs"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;color:blue; mso-font-kerning:0pt;"  >http://repository.example.org/projects/myrepos.git/info/refs</span></a></span><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体; mso-font-kerning:0pt;"  lang="EN-US"  >&nbsp;not found: did you run git update-server-info on the server? git --bare init git update-server-info # this creates the info/refs file chown -R &lt;user&gt;:&lt;group&gt; . # make sure others can update the repository</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >The solution is to create&nbsp;<i>another repository&nbsp;<b>elsewhere</b></i>, add a file in that repository and, push it to the bare repository.</span></p>  <p class="MsoNormal"  style="mso-margin-top-alt:auto;mso-margin-bottom-alt: auto;text-align:left;mso-pagination:widow-orphan;"  align="left"  ><span style="font-size:12.0pt;font-family:宋体;mso-bidi-font-family:宋体;mso-font-kerning: 0pt;"  lang="EN-US"  >mkdir temp; cd temp git init touch .gitignore git add .gitignore git commit -m "Initial commit" git push &lt;url or path of bare repository&gt; master cd ..; rm -rf temp</span></p>  <p><span lang="EN-US"  >&nbsp;</span></p>
</body></html>