<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf8"><title>163 blogs的博客：Shuttle中间件共享内存解析</title>
<style type="text/css">
a{color: #000000;text-decoration : none;font-size: 10pt;}
a:hover {color: red;text-decoration : underline;}
.replyBox{padding:4px;border:1px solid #D8D8D8;}
</style></head><body><h2>Shuttle中间件共享内存解析</h2>
<p align="right">发布时间：2011-2-27 16:32
<br>分类名称：Private</p><br>
   <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >名词：</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >GUIDs </FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >为中间件</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >oem_cfg.cpp</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >中定义的</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >g_Config. szGUID, </FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >形式诸如：</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >"0CD36B62-D173-42e7-8573-04D1A193E2E3"</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >。</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >中间件一共创建了</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >5</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >个共享内存。用来管理多进程，多</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >token</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >，</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >ToeknInfo</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >，以及公私有区。</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: -18pt; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0; mso-list: l0 level1 lfo1;"    align="left"   ><SPAN style="mso-fareast-font-family: Calibri; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: Calibri; mso-bidi-theme-font: minor-latin;"    lang="EN-US"   ><SPAN style="mso-list: Ignore;"    ><FONT face="Calibri"   >1.</FONT><SPAN style="FONT: 7pt 'Times New Roman';"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN></SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >Name</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >：</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >GUIDs_process_notify_shm</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >用来实现多进程通讯，在多用户的时候，会有多个进程同时运行，中间件的通信机制为：启动的第一个进程使用隐藏的窗口来监控设备拔插状态（例如响应</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >WM_DEVICECHANGE</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >），当此进程监控的设备拔插动作时，就通过将有用的信息写入此共享内存，然后通过全局的</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >Event</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >内核对象，来通知各个正在运行的进程。使得其他进程也能监控到设备的拔插等事件。</SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    ></SPAN><SPAN lang="EN-US"   >&nbsp;</SPAN></P>  <DIV><IMG title="Shuttle中间件共享内存解析 - Dsliu - Dspace"    alt="Shuttle中间件共享内存解析 - Dsliu - Dspace"    style="margin: 0px 10px 0px 0px;"    src="pic/img838.ph.126.net_QFV--LZbPAoKjK1j1cNmiw==_811492357858895301.png"    ></DIV>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   >&nbsp;</P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >此共享内存由</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >CProcessNotify</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >来维护，成员变量为：</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >CShareMemory m_ShareMemory</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >；前面附加的那</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >8</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >个字节的统计信息，就是在</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >CShareMemory</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >中附加上的，而</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >CShareMemory</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >使用的是</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >CShareMem</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >中的成员函数来创建共享内存。</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >CShareMem</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >不会附加任何信息。只是简单的封装了系统的创建共享内存的</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >API</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >。</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >常量：</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >// </FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >多进程之间通讯使用的共享内存大小（实际上创建的大小为</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >4096+2*sizeof(CK_ULONG)</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >）</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >#define <SPAN style="mso-tab-count: 1;"    >&nbsp; </SPAN>NOTIFY_SHARE_MEMORY_SIZE<SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>4096<SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >// 4096</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >大小被分为两块（</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >2048</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >），</SPAN><FONT face="Calibri"   > </FONT><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >前半块（</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >2048</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >）用来存储消息信息（最大为</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >2048</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >）</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >#define <SPAN style="mso-tab-count: 1;"    >&nbsp; </SPAN>NOTIFY_MESSAGE_MAX_SIZE<SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>2048<SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >// </FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >后半块（</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >2048</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >）用来存储当前运行进程</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >PID</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >，</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >500</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >是怎么算出来的呢？</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >// </FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >一个</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >PID</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >占用一个</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >CK_ULONG</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >（</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >4</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >字节），</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >2048 / 4 = 512. </FONT></SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >#define <SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp; </SPAN>NOTIFY_PROCESS_MAX_COUNT<SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp; </SPAN>500</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: -18pt; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0; mso-list: l0 level1 lfo1;"    align="left"   ><SPAN style="mso-fareast-font-family: Calibri; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: Calibri; mso-bidi-theme-font: minor-latin;"    lang="EN-US"   ><SPAN style="mso-list: Ignore;"    ><FONT face="Calibri"   >2.</FONT><SPAN style="FONT: 7pt 'Times New Roman';"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN></SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >GUIDs_slotmgr_shm</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >CSlotManager </FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >在</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >Initialize</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >成员函数里面创建此共享内存，用来统计当前插入的</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >Token</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >数目（</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >slot</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >数目）。例如。当检测到插入设备时，就会往此共享内存中写入一个新的</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >SHM_SLOT_LIST_ITEM</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >。当移除一个</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >Key</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >时，并没有删相应的</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >item</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >，而是将相应的</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >Item</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >成员中的</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >tokenPresent</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >设置为</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >false</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >。下次再次插入的时候，只需要更新此</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >Item</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >即可。</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P>&nbsp;</P>  <DIV><IMG title="Shuttle中间件共享内存解析 - Dsliu - Dspace"    alt="Shuttle中间件共享内存解析 - Dsliu - Dspace"    style="margin: 0px 10px 0px 0px;"    src="pic/img533.ph.126.net_kjknSflCFpRiNYk3Brv55A==_1279022294174406759.png"    ></DIV>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >SHM_SLOT_LIST_ITEM </FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >定义如下：</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >typedef struct SHM_SLOT_LIST_ITEM</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >{</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   ><SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>CK_SLOT_ID slotId;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   ><SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>CK_BBOOL tokenPresent;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   ><SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>WORD nextPubObjId;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   ><SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>WORD nextPrvObjId;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   ><SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>// </FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >缓存</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >PIN</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >相关，目前已经将其舍弃，可以屏蔽掉。免得出现漏洞</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   ><SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>// CK_BYTE userPinLen;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   ><SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>// CK_BYTE userPin[31];<SPAN style="mso-tab-count: 1;"    >&nbsp; </SPAN>// LV style. Length + Value. must encrypted.</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   ><SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>// CK_ULONG incUserPinCount;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   ><SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>CK_ULONG lastAccess;<SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp; </SPAN>// GetTicketCount().</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   ><SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>char slotName[64];<SPAN style="mso-spacerun: yes;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>//slotDescription</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   ><SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>char accessPath[MAX_PATH];// Symblic link or reader name.</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   ><SPAN style="mso-tab-count: 1;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>CK_ULONG ulReaderType;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >} SHM_SLOT_LIST_ITEM;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >下面三个共享内存都是由</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >CBuddyStore</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >来创建和维护的。在程序刚刚运行，会建立俩个共享内存，一个是</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >TokenInfo</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >共享区，一个是</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >Public</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >共享区。</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >常量：</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >#define TOKEN_INFO_STORAGE_SIZE<SPAN style="mso-tab-count: 2;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>(sizeof(SM_TOKEN_INFO) + 60*4 + 30*4) // </FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >定义的不严谨</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >#define PUB_TOTAL_OBJ_COUNT<SPAN style="mso-tab-count: 3;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>60</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >#define PRV_TOTAL_OBJ_COUNT<SPAN style="mso-tab-count: 3;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>30</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >#define BKG_READ_BASE_SIZE<SPAN style="mso-tab-count: 3;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>2048</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >#define TOKEN_INFO_STORAGE<SPAN style="mso-tab-count: 3;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>0</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >#define PKI_FILE_PUB_STORAGE<SPAN style="mso-tab-count: 3;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>1</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >#define PKI_FILE_PRV_STORAGE<SPAN style="mso-tab-count: 3;"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>2</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >&nbsp;</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: -18pt; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0; mso-list: l0 level1 lfo1;"    align="left"   ><SPAN style="mso-fareast-font-family: Calibri; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: Calibri; mso-bidi-theme-font: minor-latin;"    lang="EN-US"   ><SPAN style="mso-list: Ignore;"    ><FONT face="Calibri"   >3.</FONT><SPAN style="FONT: 7pt 'Times New Roman';"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN></SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >GUIDs_%X_%X(slotID, TOKEN_INFO_STORAGE)</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >，实际形式：</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >GUIDs_1_0</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN lang="EN-US"   ><FONT face="Calibri"   >TokenInfo</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >共享区，大小为</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >TOKEN_INFO_STORAGE_SIZE + 8</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >。</SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    ></SPAN>&nbsp;<IMG title="Shuttle中间件共享内存解析 - Dsliu - Dspace"    alt="Shuttle中间件共享内存解析 - Dsliu - Dspace"    style="margin: 0px 10px 0px 0px;"    src="pic/img533.ph.126.net_A2NhVEHTpIDiMxhMAlTa7w==_1279022294174406767.png"    ></P>  <P></P><FONT face="Calibri"   >  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN lang="EN-US"   >TOKEN_INFO_STORAGE_SIZE<SPAN style="mso-tab-count: 1;"    >&nbsp; </SPAN></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >被计算成：</SPAN><SPAN lang="EN-US"   >(sizeof(SM_TOKEN_INFO) + 60*4 + 30*4)</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >，其实应该是：</SPAN><SPAN lang="EN-US"   >&lt; xmlnamespace prefix ="o" ns ="urn:schemas-microsoft-com:office:office" /&gt;</SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN lang="EN-US"   >(sizeof(SM_TOKEN_INFO) + PUB_TOTAL_OBJ_COUNT * sizeof(CK_ULONG)<SPAN style="mso-spacerun: yes;"    >&nbsp; </SPAN>+ <SPAN style="mso-spacerun: yes;"    >&nbsp;</SPAN>PRV_TOTAL_OBJ_COUNT * sizeof(CK_ULONG)).</SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN lang="EN-US"   >offset-size,</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >用来表示每个</SPAN><SPAN lang="EN-US"   >obj</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >在</SPAN><SPAN lang="EN-US"   >Token</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >公私有文件中的偏移量及其大小事多少。</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN lang="EN-US"   >&nbsp;</SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: -18pt; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0; mso-list: l0 level1 lfo1;"    align="left"   ><SPAN style="mso-fareast-font-family: Calibri; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: Calibri; mso-bidi-theme-font: minor-latin;"    lang="EN-US"   ><SPAN style="mso-list: Ignore;"    >4.<SPAN style="FONT: 7pt 'Times New Roman';"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN></SPAN><SPAN lang="EN-US"   >GUIDs_%X_%X(slotID, PKI_FILE_PUB_STORAGE)</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >，实际形式：</SPAN><SPAN lang="EN-US"   >GUIDs_1_1</SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >公有区，大小为：上面的</SPAN><SPAN lang="EN-US"   >TokenInfo</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >中，成员变量</SPAN><SPAN lang="EN-US"   >ulTotalPublicMemory</SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >的值。</SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    ></SPAN>&nbsp;<IMG title="Shuttle中间件共享内存解析 - Dsliu - Dspace"    alt="Shuttle中间件共享内存解析 - Dsliu - Dspace"    style="margin: 0px 10px 0px 0px;"    src="pic/img616.ph.126.net_cRbEajeUMcJ_Pp56NC2hBw==_1990028085346523203.png"    ></P><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >  <P style="TEXT-ALIGN: left; TEXT-INDENT: -18pt; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0; mso-list: l0 level1 lfo1;"    align="left"   ><SPAN style="mso-fareast-font-family: Calibri; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: Calibri; mso-bidi-theme-font: minor-latin;"    lang="EN-US"   ><SPAN style="mso-list: Ignore;"    ><FONT face="Calibri"   >5.</FONT><SPAN style="FONT: 7pt 'Times New Roman';"    >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN></SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >GUIDs_%X_%X(slotID, PKI_FILE_PRV_STORAGE)</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >，实际形式：</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >GUIDs_1_2</FONT></SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >私有区，大小为：上面的</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >TokenInfo</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >中的，成员变量</SPAN><SPAN lang="EN-US"   ><FONT face="Calibri"   >ulTotalPrivateMemory</FONT></SPAN><SPAN style="FONT-FAMILY: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"    >的值。</SPAN><SPAN lang="EN-US"   ></SPAN></P>  <P style="TEXT-ALIGN: left; TEXT-INDENT: 0cm; MARGIN: 0cm 0cm 0pt 18pt; mso-char-indent-count: 0;"    align="left"   ></P></SPAN><SPAN lang="EN-US"   ></SPAN>&nbsp;<IMG title="Shuttle中间件共享内存解析 - Dsliu - Dspace"    alt="Shuttle中间件共享内存解析 - Dsliu - Dspace"    style="margin: 0px 10px 0px 0px;"    src="pic/img844.ph.126.net_b6ziPIJUcLIvBR1H2qQ8nA==_894527475988349050.png"    ></FONT>
</body></html>